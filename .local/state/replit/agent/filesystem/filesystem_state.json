{"file_contents":{"client/src/components/HowItWorksSection.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { CheckCircle2, MessageCircle, BarChart3, Lightbulb } from \"lucide-react\";\n\nconst steps = [\n  {\n    number: 1,\n    icon: CheckCircle2,\n    title: \"Share Your Story\",\n    description: \"Complete questionnaires, chat with AI, and write journal entries at your own pace.\"\n  },\n  {\n    number: 2,\n    icon: MessageCircle,\n    title: \"Ongoing Analysis\",\n    description: \"AI continuously analyzes your inputs, identifying patterns and building your personality profile.\"\n  },\n  {\n    number: 3,\n    icon: BarChart3,\n    title: \"Receive Insights\",\n    description: \"Get comprehensive analysis of your traits, behaviors, and emotional patterns.\"\n  },\n  {\n    number: 4,\n    icon: Lightbulb,\n    title: \"Grow & Transform\",\n    description: \"Use personalized recommendations to address blind spots and achieve meaningful growth.\"\n  }\n];\n\nexport function HowItWorksSection() {\n  return (\n    <section className=\"py-20 px-6 bg-muted/30\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"text-center mb-16\">\n          <h2 className=\"text-3xl md:text-4xl font-semibold mb-4\">\n            How It Works\n          </h2>\n          <p className=\"text-lg text-muted-foreground\">\n            Your journey to self-discovery in four simple steps\n          </p>\n        </div>\n        \n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {steps.map((step, index) => {\n            const Icon = step.icon;\n            return (\n              <Card key={index} className=\"relative\" data-testid={`card-step-${index}`}>\n                <CardContent className=\"pt-12 pb-6\">\n                  <div className=\"absolute -top-6 left-6 h-12 w-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xl font-bold shadow-lg\">\n                    {step.number}\n                  </div>\n                  <div className=\"mb-4\">\n                    <Icon className=\"h-8 w-8 text-primary\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold mb-2\">{step.title}</h3>\n                  <p className=\"text-muted-foreground\">{step.description}</p>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":2304,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/examples/Footer.tsx":{"content":"import { Footer } from '../Footer';\n\nexport default function FooterExample() {\n  return <Footer />;\n}\n","path":null,"size_bytes":102,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: AI Personality Analyzer\n\n## Design Approach\n\n**Reference-Based Strategy**: Drawing inspiration from wellness and productivity leaders - Calm's empathetic design, Notion's information clarity, Apple Health's data visualization, and therapy app trust-building aesthetics. This creates a safe, professional environment for deep self-reflection.\n\n**Core Design Principle**: Balance clinical professionalism with warm accessibility. Users are sharing intimate personal details, so the design must feel trustworthy, calming, and non-judgmental while maintaining analytical credibility.\n\n## Typography System\n\n**Primary Font**: Inter or DM Sans via Google Fonts\n- Hero/Display: 3xl to 5xl, font-semibold\n- Section Headers: 2xl to 3xl, font-semibold\n- Card Titles: xl to 2xl, font-medium\n- Body Text: base to lg, font-normal\n- UI Labels: sm to base, font-medium\n- Data/Metrics: lg to 3xl, font-bold (for personality scores)\n- Journal Prompts: lg, font-normal, italic\n\n**Secondary Font**: Crimson Pro or Lora (serif) for journal entries and reflective content only\n\n## Layout System\n\n**Spacing Primitives**: Use Tailwind units of 2, 4, 6, 8, 12, 16, and 20\n- Micro-spacing: p-2, gap-2\n- Component padding: p-4, p-6\n- Section spacing: py-12, py-16, py-20\n- Container margins: px-4, px-6, px-8\n\n**Grid System**: \n- Dashboard: 12-column responsive grid\n- Cards: 3-column on desktop (lg:grid-cols-3), 2-column tablet (md:grid-cols-2), single column mobile\n- Max width containers: max-w-7xl for full sections, max-w-4xl for content-focused areas\n\n## Component Library\n\n### Landing Page Components\n\n**Hero Section** (80vh):\n- Large headline with gradient text effect\n- Subheading explaining the transformative journey\n- Primary CTA: \"Start Your Journey\" + Secondary: \"See How It Works\"\n- Blurred background with hero image showing serene self-reflection imagery\n- Social proof indicator: \"Join 50,000+ people discovering themselves\"\n\n**Features Section** (3-column grid):\n- AI Chat Analysis card with message bubble icon\n- Personality Questionnaire card with clipboard icon\n- Journal Insights card with book icon\n- Each card: icon, title, 2-3 sentence description, subtle border\n\n**How It Works Timeline** (vertical on mobile, horizontal on desktop):\n- 4-step process with connecting lines\n- Step cards with number badges, icons, titles, descriptions\n- Visual progression showing user journey\n\n**Personality Insights Preview**:\n- Sample personality trait visualization (radar chart or bar chart)\n- Quote: \"The truth will set you free\" - emphasis on honest self-discovery\n- Example insight cards showing \"Blind Spots\" and \"Growth Opportunities\"\n\n**Testimonials** (2-column grid):\n- User photo placeholders, names, transformation stories\n- Star ratings and specific outcomes\n- Authentic, emotional testimonials about self-discovery\n\n**CTA Section**:\n- Dark background section\n- Compelling headline about starting the journey\n- Email signup OR direct \"Get Started\" button\n- Privacy reassurance text\n\n**Footer**:\n- Newsletter signup with benefit text\n- Links: About, Privacy, Terms, Contact\n- Social media icons\n- Copyright and trust badges\n\n### Application Dashboard Components\n\n**Top Navigation Bar**:\n- Logo/brand on left\n- Navigation: Dashboard, Chat, Journal, Insights, Profile\n- User avatar with dropdown menu on right\n- Progress indicator showing completion percentage\n\n**Dashboard Cards**:\n- Personality Score Overview (large card, top of dashboard)\n- Recent Insights card with bullet points\n- Current Streak tracker (gamification element)\n- Quick Action cards: \"Start Chat\", \"Write Journal Entry\", \"Take Assessment\"\n\n**Personality Profile Visualization**:\n- Circular or radar chart showing 5-8 key traits\n- Color-coded trait categories (no specific colors defined, just structure)\n- Interactive hover states revealing detailed descriptions\n- Comparison view: \"You vs. Average\" toggle\n\n**Insight Cards**:\n- Icon representing insight category\n- Insight title (bold, attention-grabbing)\n- Supporting explanation (2-3 sentences)\n- Action button: \"Explore This\" or \"Learn More\"\n- Timestamp showing when insight was discovered\n\n**Chat Interface**:\n- Clean messaging layout with clear user/AI message distinction\n- AI messages include thoughtful follow-up prompts\n- Suggested conversation starters as clickable bubbles\n- \"Save this conversation\" button\n- Typing indicator with calming animation\n\n**Journal Interface**:\n- Distraction-free writing area with generous padding\n- Floating toolbar: Format text, Add emotion tags, Save draft\n- Prompt suggestions sidebar\n- Previous entries list with date and preview text\n- Search and filter functionality\n\n**Questionnaire Interface**:\n- Progress bar at top showing completion\n- One question per screen approach (mobile-friendly)\n- Slider inputs for scale questions\n- Radio buttons for multiple choice\n- Large \"Continue\" button\n- Ability to skip questions with note\n\n**Trend Visualization**:\n- Line charts showing personality trait evolution over time\n- Month/Quarter/Year view toggles\n- Milestone markers for significant insights\n- Comparative overlays for multiple traits\n\n### Form Elements\n\n**Input Fields**:\n- Generous padding (p-4)\n- Clear focus states with border transitions\n- Label positioning: floating labels for cleaner look\n- Helper text below fields\n- Error states with inline validation messages\n\n**Buttons**:\n- Primary: Large, rounded, bold text (px-8, py-3)\n- Secondary: Outlined version with hover states\n- Tertiary: Text-only with underline on hover\n- Icon buttons: Circular with subtle shadows\n\n**Cards**:\n- Soft shadows for depth (shadow-sm to shadow-md)\n- Rounded corners (rounded-lg to rounded-xl)\n- Padding: p-6 to p-8\n- Hover state: subtle lift effect (transform transition)\n\n## Images\n\n**Hero Section**: Full-width background image showing peaceful self-reflection - person journaling by window, meditation scene, or abstract peaceful imagery. Image should be softly blurred with overlay for text legibility.\n\n**Feature Cards**: Icon-based, no images needed (use Heroicons or similar)\n\n**Testimonial Section**: Profile photo placeholders (circular, 64x64px)\n\n**Insights Preview**: Screenshot mockups of actual personality visualizations\n\n**About/How It Works**: Illustration of the analysis process - abstract representation of data flowing into insights\n\n## Accessibility & Interactions\n\n- All interactive elements have minimum 44x44px touch targets\n- Form inputs maintain consistent height and spacing\n- Focus indicators visible on all interactive elements\n- Skip navigation link for keyboard users\n- Semantic HTML throughout (proper heading hierarchy)\n\n## Animation Guidelines\n\n**Minimal, Purposeful Motion**:\n- Gentle fade-ins for insight cards appearing\n- Smooth transitions for navigation (200ms ease)\n- Progress indicators use subtle pulse animation\n- NO parallax, NO scroll-jacking, NO distracting effects\n- Loading states use simple spinner or skeleton screens\n\n## Special Considerations\n\n**Trust-Building Elements**:\n- Privacy reassurance text throughout\n- \"Your data is encrypted\" badges\n- Clear opt-out options for data collection\n- Transparent explanation of AI analysis process\n\n**Emotional Design**:\n- Generous whitespace to reduce cognitive load\n- Calming interface that doesn't feel clinical\n- Encouraging micro-copy throughout\n- Celebration moments for milestones and breakthroughs\n\n**Data Density Balance**:\n- Complex personality data presented in digestible chunks\n- Progressive disclosure: overview → details on demand\n- Visual hierarchy guides eye to most important insights first","path":null,"size_bytes":7576,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function stripMarkdownForSpeech(text: string): string {\n  return text\n    // Remove analytical format labels (trigger, action, consequence, etc.)\n    .replace(/\\s*\\(trigger\\)/gi, '')\n    .replace(/\\s*\\(action\\)/gi, '')\n    .replace(/\\s*\\(consequence\\)/gi, '')\n    .replace(/\\s*\\(appraisal\\)/gi, '')\n    .replace(/\\s*\\(emotional response\\)/gi, '')\n    .replace(/\\s*\\(regulation attempt\\)/gi, '')\n    .replace(/\\s*\\(response\\)/gi, '')\n    .replace(/\\s*\\(regulation\\)/gi, '')\n    // Remove square bracket analytical labels [TRIGGER], [ACTION], etc.\n    .replace(/\\s*\\[TRIGGER\\]/gi, '')\n    .replace(/\\s*\\[ACTION\\]/gi, '')\n    .replace(/\\s*\\[CONSEQUENCE\\]/gi, '')\n    .replace(/\\s*\\[APPRAISAL\\]/gi, '')\n    .replace(/\\s*\\[EMOTIONAL RESPONSE\\]/gi, '')\n    .replace(/\\s*\\[REGULATION ATTEMPT\\]/gi, '')\n    .replace(/\\s*\\[RESPONSE\\]/gi, '')\n    .replace(/\\s*\\[REGULATION\\]/gi, '')\n    // Remove bold/italic asterisks and underscores\n    .replace(/\\*\\*\\*(.+?)\\*\\*\\*/g, '$1')  // Bold+italic\n    .replace(/\\*\\*(.+?)\\*\\*/g, '$1')      // Bold\n    .replace(/\\*(.+?)\\*/g, '$1')          // Italic\n    .replace(/___(.+?)___/g, '$1')        // Bold+italic underscores\n    .replace(/__(.+?)__/g, '$1')          // Bold underscores\n    .replace(/_(.+?)_/g, '$1')            // Italic underscores\n    // Remove strikethrough\n    .replace(/~~(.+?)~~/g, '$1')\n    // Remove inline code backticks\n    .replace(/`(.+?)`/g, '$1')\n    // Remove links but keep text\n    .replace(/\\[(.+?)\\]\\(.+?\\)/g, '$1')\n    // Remove headers\n    .replace(/#{1,6}\\s+/g, '')\n    // Remove list markers\n    .replace(/^\\s*[-*+]\\s+/gm, '')\n    .replace(/^\\s*\\d+\\.\\s+/gm, '');\n}\n","path":null,"size_bytes":1808,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/Logo.tsx":{"content":"import logoPath from \"@assets/Chakrai-Logo-no-bg-8-28_1762163859231.png\";\n\ninterface LogoProps {\n  className?: string;\n  showText?: boolean;\n  size?: \"sm\" | \"md\" | \"lg\";\n}\n\nconst sizeMap = {\n  sm: \"h-6 w-6\",\n  md: \"h-8 w-8\",\n  lg: \"h-10 w-10\",\n};\n\nexport function Logo({ className = \"\", showText = true, size = \"md\" }: LogoProps) {\n  return (\n    <div className={`flex items-center gap-2 ${className}`}>\n      <img \n        src={logoPath} \n        alt=\"Mirror Logo\" \n        className={sizeMap[size]}\n      />\n      {showText && <span className=\"text-xl font-semibold\">Mirror</span>}\n    </div>\n  );\n}\n","path":null,"size_bytes":602,"size_tokens":null},"client/src/components/HeroSection.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowRight, Users } from \"lucide-react\";\nimport heroImage from \"@assets/generated_images/Hero-Background-image.png\";\n\nexport function HeroSection() {\n  return (\n    <section className=\"relative min-h-[80vh] flex items-center justify-center overflow-hidden\">\n      <div\n        className=\"absolute inset-0 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${heroImage})` }}\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-b from-black/60 via-black/50 to-black/70\" />\n      \n      <div className=\"relative z-10 max-w-4xl mx-auto px-4 sm:px-6 py-12 sm:py-16 md:py-20 text-center\">\n        <h1 className=\"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-semibold text-white mb-4 sm:mb-6 leading-tight\">\n          Discover the{\" \"}\n          <span className=\"bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent\">\n            Hard Truth\n          </span>\n          {\" \"}About Yourself\n        </h1>\n        <p className=\"text-base sm:text-lg md:text-xl text-white/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-2\">\n          The most in-depth AI personality analyzer. Uncover blind spots, understand patterns, and transform who you are through honest self-reflection.\n        </p>\n        \n        <div className=\"flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4 mb-8 sm:mb-12 px-4\">\n          <Button \n            size=\"lg\" \n            className=\"w-full sm:w-auto px-6 sm:px-8 py-5 sm:py-6 text-base sm:text-lg\"\n            data-testid=\"button-start-journey\"\n          >\n            Start Your Journey <ArrowRight className=\"ml-2 h-4 w-4 sm:h-5 sm:w-5\" />\n          </Button>\n          <Button \n            size=\"lg\" \n            variant=\"outline\" \n            className=\"w-full sm:w-auto px-6 sm:px-8 py-5 sm:py-6 text-base sm:text-lg backdrop-blur-sm bg-white/10 border-white/30 text-white hover:bg-white/20\"\n            data-testid=\"button-how-it-works\"\n          >\n            See How It Works\n          </Button>\n        </div>\n        \n        <div className=\"flex items-center justify-center gap-2 text-white/80 px-4\">\n          <Users className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n          <span className=\"text-xs sm:text-sm\">Join 50,000+ people discovering themselves</span>\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":2339,"size_tokens":null},"client/src/components/Footer.tsx":{"content":"import { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Mail, Twitter, Linkedin, Github } from \"lucide-react\";\n\nexport function Footer() {\n  return (\n    <footer className=\"border-t py-12 px-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8\">\n          <div>\n            <h3 className=\"font-semibold text-lg mb-4\">Mirror</h3>\n            <p className=\"text-sm text-muted-foreground\">\n              AI-powered personality analysis for deeper self-understanding and growth.\n            </p>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold mb-4\">Product</h4>\n            <ul className=\"space-y-2 text-sm\">\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">Features</a></li>\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">How It Works</a></li>\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">Pricing</a></li>\n            </ul>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold mb-4\">Company</h4>\n            <ul className=\"space-y-2 text-sm\">\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">About</a></li>\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">Privacy</a></li>\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">Terms</a></li>\n              <li><a href=\"#\" className=\"text-muted-foreground hover:text-foreground\">Contact</a></li>\n            </ul>\n          </div>\n          \n          <div>\n            <h4 className=\"font-semibold mb-4\">Stay Updated</h4>\n            <p className=\"text-sm text-muted-foreground mb-3\">\n              Get insights and tips for self-discovery\n            </p>\n            <div className=\"flex gap-2\">\n              <Input \n                type=\"email\" \n                placeholder=\"Enter email\" \n                className=\"text-sm\"\n                data-testid=\"input-newsletter-email\"\n              />\n              <Button size=\"icon\" data-testid=\"button-subscribe\">\n                <Mail className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"pt-8 border-t flex flex-col md:flex-row justify-between items-center gap-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            © 2024 Mirror. All rights reserved.\n          </p>\n          <div className=\"flex gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-social-twitter\">\n              <Twitter className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-social-linkedin\">\n              <Linkedin className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-social-github\">\n              <Github className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","path":null,"size_bytes":3131,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { OnboardingGuard } from \"@/components/OnboardingGuard\";\nimport Landing from \"@/pages/Landing\";\nimport Home from \"@/pages/Home\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Chat from \"@/pages/Chat\";\nimport Journal from \"@/pages/Journal\";\nimport Mood from \"@/pages/Mood\";\nimport Insights from \"@/pages/Insights\";\nimport PersonalityReflection from \"@/pages/PersonalityReflection\";\nimport IntakeAssessment from \"@/pages/IntakeAssessment\";\nimport Profile from \"@/pages/Profile\";\nimport CategoryOnboarding from \"@/pages/CategoryOnboarding\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  // Show landing page while loading or if not authenticated\n  if (isLoading || !isAuthenticated) {\n    return <Route path=\"/\" component={Landing} />;\n  }\n\n  // Show protected routes only for authenticated users\n  return (\n    <OnboardingGuard>\n      <Switch>\n        <Route path=\"/\" component={Home} />\n        <Route path=\"/onboarding\" component={CategoryOnboarding} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        <Route path=\"/chat\" component={Chat} />\n        <Route path=\"/journal\" component={Journal} />\n        <Route path=\"/mood\" component={Mood} />\n        <Route path=\"/insights\" component={Insights} />\n        <Route path=\"/reflection\" component={PersonalityReflection} />\n        <Route path=\"/personality\" component={PersonalityReflection} />\n        <Route path=\"/assessment\" component={IntakeAssessment} />\n        <Route path=\"/profile\" component={Profile} />\n        <Route component={NotFound} />\n      </Switch>\n    </OnboardingGuard>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2171,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    const prefersDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n    const initialTheme = savedTheme || (prefersDark ? \"dark\" : \"light\");\n    setTheme(initialTheme);\n    document.documentElement.classList.toggle(\"dark\", initialTheme === \"dark\");\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      aria-label=\"Toggle theme\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":1164,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/pages/Journal.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { JournalInterface } from \"@/components/JournalInterface\";\n\nexport default function Journal() {\n  return (\n    <div className=\"min-h-screen\">\n      <DashboardNav />\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-semibold mb-1 sm:mb-2\">Journal</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            Reflect on your thoughts and track your personal growth\n          </p>\n        </div>\n        <JournalInterface />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":653,"size_tokens":null},"client/src/components/examples/JournalInterface.tsx":{"content":"import { JournalInterface } from '../JournalInterface';\n\nexport default function JournalInterfaceExample() {\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto\">\n      <JournalInterface />\n    </div>\n  );\n}\n","path":null,"size_bytes":209,"size_tokens":null},"client/src/components/examples/HeroSection.tsx":{"content":"import { HeroSection } from '../HeroSection';\n\nexport default function HeroSectionExample() {\n  return <HeroSection />;\n}\n","path":null,"size_bytes":122,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { DashboardOverview } from \"@/components/DashboardOverview\";\n\nexport default function Dashboard() {\n  return (\n    <div className=\"min-h-screen\">\n      <DashboardNav />\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-semibold mb-1 sm:mb-2\">Welcome Back</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Continue your journey of self-discovery</p>\n        </div>\n        <DashboardOverview />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":623,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/JournalInterface.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Save, Lightbulb, Calendar, Pencil, Trash2, X, Volume2, VolumeX } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { JournalEntry } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTextToSpeech } from \"@/hooks/useTextToSpeech\";\nimport { stripMarkdownForSpeech } from \"@/lib/utils\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nconst prompts = [\n  \"What challenged you today?\",\n  \"What are you grateful for?\",\n  \"What did you learn about yourself?\",\n  \"What emotions did you experience?\"\n];\n\nexport function JournalInterface() {\n  const [entry, setEntry] = useState(\"\");\n  const [selectedPrompt, setSelectedPrompt] = useState<string | null>(null);\n  const [editingEntry, setEditingEntry] = useState<JournalEntry | null>(null);\n  const [editContent, setEditContent] = useState(\"\");\n  const [deletingEntry, setDeletingEntry] = useState<JournalEntry | null>(null);\n  const [speakingEntryId, setSpeakingEntryId] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const { speak, stop: stopSpeaking, isSpeaking } = useTextToSpeech({\n    onStart: () => {\n      // TTS started successfully\n    },\n    onEnd: () => {\n      setSpeakingEntryId(null);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Speech Error\",\n        description: \"Failed to play audio. Please try again.\",\n        variant: \"destructive\",\n      });\n      setSpeakingEntryId(null);\n    },\n  });\n\n  const { data: previousEntries = [] } = useQuery<JournalEntry[]>({\n    queryKey: [\"/api/journal-entries\"],\n  });\n\n  const saveEntryMutation = useMutation({\n    mutationFn: async () => {\n      const wordCount = entry.split(/\\s+/).filter(w => w).length;\n      const res = await apiRequest(\"POST\", \"/api/journal-entries\", {\n        userId: \"default-user-id\",\n        content: entry,\n        prompt: selectedPrompt,\n        wordCount\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/journal-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/insights\"] });\n      toast({\n        title: \"Entry saved\",\n        description: \"Your journal entry has been saved and analyzed.\"\n      });\n      setEntry(\"\");\n      setSelectedPrompt(null);\n    }\n  });\n\n  const updateEntryMutation = useMutation({\n    mutationFn: async ({ id, content }: { id: string; content: string }) => {\n      const wordCount = content.split(/\\s+/).filter(w => w).length;\n      const res = await apiRequest(\"PUT\", `/api/journal-entries/${id}`, {\n        content,\n        wordCount\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/journal-entries\"] });\n      toast({\n        title: \"Entry updated\",\n        description: \"Your journal entry has been updated.\"\n      });\n      setEditingEntry(null);\n      setEditContent(\"\");\n    }\n  });\n\n  const deleteEntryMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/journal-entries/${id}`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/journal-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      toast({\n        title: \"Entry deleted\",\n        description: \"Your journal entry has been deleted.\"\n      });\n      setDeletingEntry(null);\n    }\n  });\n\n  const handleSave = () => {\n    if (!entry.trim()) return;\n    saveEntryMutation.mutate();\n  };\n\n  const handleSpeakEntry = (entryId: string, content: string) => {\n    // If clicking the same entry that's currently speaking, stop it\n    if (speakingEntryId === entryId) {\n      stopSpeaking();\n      setSpeakingEntryId(null);\n      return;\n    }\n    \n    // Start speaking this entry\n    setSpeakingEntryId(entryId);\n    speak(stripMarkdownForSpeech(content), true); // Mark as user-initiated\n  };\n\n  return (\n    <div className=\"grid lg:grid-cols-3 gap-4 sm:gap-6\">\n      <div className=\"lg:col-span-2 space-y-4 sm:space-y-6\">\n        <Card data-testid=\"card-journal-editor\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 p-4 sm:p-6\">\n            <CardTitle className=\"flex items-center gap-2 text-base sm:text-lg\">\n              <Calendar className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n              <span className=\"hidden sm:inline\">Today's Entry</span>\n              <span className=\"sm:hidden\">Entry</span>\n            </CardTitle>\n            <div className=\"flex gap-2\">\n              <Button\n                size=\"sm\"\n                onClick={handleSave}\n                disabled={!entry.trim() || saveEntryMutation.isPending}\n                data-testid=\"button-save-entry\"\n              >\n                <Save className=\"sm:mr-2 h-4 w-4\" />\n                <span className=\"hidden sm:inline\">{saveEntryMutation.isPending ? \"Saving...\" : \"Save Entry\"}</span>\n                <span className=\"sm:hidden\">{saveEntryMutation.isPending ? \"...\" : \"Save\"}</span>\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 sm:space-y-4 p-4 sm:p-6\">\n            <Textarea\n              value={entry}\n              onChange={(e) => setEntry(e.target.value)}\n              placeholder=\"What's on your mind? Write freely about your thoughts, feelings, and experiences...\"\n              className=\"min-h-[300px] sm:min-h-[400px] resize-none font-serif text-sm sm:text-base\"\n              data-testid=\"textarea-journal-entry\"\n            />\n            <div className=\"flex justify-between items-center text-xs sm:text-sm text-muted-foreground flex-wrap gap-2\">\n              <span data-testid=\"text-word-count\">{entry.split(/\\s+/).filter(w => w).length} words</span>\n              {selectedPrompt && (\n                <Badge variant=\"secondary\" className=\"text-xs\" data-testid=\"badge-active-prompt\">\n                  Prompt: {selectedPrompt}\n                </Badge>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      <div className=\"space-y-4 sm:space-y-6\">\n        <Card data-testid=\"card-journal-prompts\">\n          <CardHeader className=\"p-4 sm:p-6\">\n            <CardTitle className=\"text-sm sm:text-base flex items-center gap-2\">\n              <Lightbulb className=\"h-4 w-4\" />\n              Writing Prompts\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2 p-4 sm:p-6\">\n            {prompts.map((prompt, index) => (\n              <Button\n                key={index}\n                variant=\"outline\"\n                className=\"w-full justify-start text-left h-auto py-2 sm:py-3 text-xs sm:text-sm\"\n                onClick={() => {\n                  setSelectedPrompt(prompt);\n                  setEntry(entry ? entry + \"\\n\\n\" + prompt + \"\\n\" : prompt + \"\\n\");\n                }}\n                data-testid={`button-prompt-${index}`}\n              >\n                {prompt}\n              </Button>\n            ))}\n          </CardContent>\n        </Card>\n        \n        <Card data-testid=\"card-previous-entries\">\n          <CardHeader className=\"p-4 sm:p-6\">\n            <CardTitle className=\"text-sm sm:text-base\">Previous Entries</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-4 sm:p-6\">\n            <ScrollArea className=\"h-[250px] sm:h-[300px]\">\n              <div className=\"space-y-2 sm:space-y-3\">\n                {previousEntries.map((prev) => (\n                  <Card\n                    key={prev.id}\n                    className=\"hover-elevate\"\n                    data-testid={`card-entry-${prev.id}`}\n                  >\n                    <CardContent className=\"pt-3 sm:pt-4 pb-2 sm:pb-3 px-3 sm:px-4\">\n                      <div className=\"flex justify-between items-start mb-1.5 sm:mb-2 gap-2\">\n                        <p className=\"text-xs sm:text-sm font-semibold\">\n                          {new Date(prev.createdAt).toLocaleDateString()}\n                        </p>\n                        <div className=\"flex items-center gap-1 shrink-0\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {prev.wordCount}w\n                          </Badge>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            className=\"h-7 w-7 sm:h-8 sm:w-8\"\n                            onClick={() => handleSpeakEntry(prev.id, prev.content)}\n                            data-testid={`button-speak-${prev.id}`}\n                            title={speakingEntryId === prev.id ? \"Stop reading\" : \"Read aloud\"}\n                          >\n                            {speakingEntryId === prev.id && isSpeaking ? (\n                              <VolumeX className=\"h-3 w-3\" />\n                            ) : (\n                              <Volume2 className=\"h-3 w-3\" />\n                            )}\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            className=\"h-7 w-7 sm:h-8 sm:w-8\"\n                            onClick={() => {\n                              setEditingEntry(prev);\n                              setEditContent(prev.content);\n                            }}\n                            data-testid={`button-edit-${prev.id}`}\n                          >\n                            <Pencil className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            className=\"h-7 w-7 sm:h-8 sm:w-8\"\n                            onClick={() => setDeletingEntry(prev)}\n                            data-testid={`button-delete-${prev.id}`}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                      <p className=\"text-xs sm:text-sm text-muted-foreground line-clamp-2\">\n                        {prev.content.substring(0, 100)}...\n                      </p>\n                    </CardContent>\n                  </Card>\n                ))}\n                {previousEntries.length === 0 && (\n                  <p className=\"text-xs sm:text-sm text-muted-foreground text-center py-4\">\n                    No previous entries yet\n                  </p>\n                )}\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Edit Dialog */}\n      <Dialog open={!!editingEntry} onOpenChange={(open) => !open && setEditingEntry(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Edit Journal Entry</DialogTitle>\n            <DialogDescription>\n              {editingEntry && new Date(editingEntry.createdAt).toLocaleDateString()}\n            </DialogDescription>\n          </DialogHeader>\n          <Textarea\n            value={editContent}\n            onChange={(e) => setEditContent(e.target.value)}\n            className=\"min-h-[300px] resize-none font-serif text-base\"\n            data-testid=\"textarea-edit-entry\"\n          />\n          <div className=\"text-sm text-muted-foreground\">\n            {editContent.split(/\\s+/).filter(w => w).length} words\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setEditingEntry(null)}\n              data-testid=\"button-cancel-edit\"\n            >\n              <X className=\"mr-2 h-4 w-4\" />\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                if (editingEntry && editContent.trim()) {\n                  updateEntryMutation.mutate({\n                    id: editingEntry.id,\n                    content: editContent\n                  });\n                }\n              }}\n              disabled={!editContent.trim() || updateEntryMutation.isPending}\n              data-testid=\"button-save-edit\"\n            >\n              <Save className=\"mr-2 h-4 w-4\" />\n              {updateEntryMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={!!deletingEntry} onOpenChange={(open) => !open && setDeletingEntry(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Journal Entry</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this journal entry from{\" \"}\n              {deletingEntry && new Date(deletingEntry.createdAt).toLocaleDateString()}?\n              This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deletingEntry) {\n                  deleteEntryMutation.mutate(deletingEntry.id);\n                }\n              }}\n              className=\"bg-destructive hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteEntryMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14426,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/CTASection.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowRight, Shield } from \"lucide-react\";\n\nexport function CTASection() {\n  return (\n    <section className=\"py-20 px-6 bg-primary text-primary-foreground\">\n      <div className=\"max-w-4xl mx-auto text-center\">\n        <h2 className=\"text-3xl md:text-4xl font-semibold mb-6\">\n          Ready to See Your True Self?\n        </h2>\n        <p className=\"text-lg mb-8 opacity-90\">\n          Start your journey to self-discovery today. No commitments, just honest insights.\n        </p>\n        \n        <Button \n          size=\"lg\" \n          variant=\"secondary\"\n          className=\"px-8 py-6 text-lg mb-8\"\n          data-testid=\"button-get-started\"\n        >\n          Get Started Free <ArrowRight className=\"ml-2 h-5 w-5\" />\n        </Button>\n        \n        <div className=\"flex items-center justify-center gap-2 text-sm opacity-80\">\n          <Shield className=\"h-4 w-4\" />\n          <span>Your data is private and encrypted. Cancel anytime.</span>\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":1059,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/DashboardOverview.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { MessageSquare, BookOpen, ClipboardCheck, Flame, ArrowRight, AlertCircle, Lightbulb, RefreshCw, Target, TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport type { PersonalityInsight, UserSelectedCategory, CategoryInsight } from \"@shared/schema\";\nimport { Link } from \"wouter\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { CategoryTrendChart } from \"@/components/CategoryTrendChart\";\n\ninterface Stats {\n  conversationCount: number;\n  journalEntryCount: number;\n  insightCount: number;\n  streak: number;\n  profileCompletion: number;\n}\n\ninterface PersonalityAnalysis {\n  traits: {\n    openness: number;\n    conscientiousness: number;\n    extraversion: number;\n    agreeableness: number;\n    emotionalStability: number;\n  };\n  corePatterns: string[];\n  blindSpots: string[];\n  strengths: string[];\n}\n\nfunction CategorySection({ categoryId, categoryName }: { categoryId: string; categoryName: string }) {\n  const { data: weeklyScoreData } = useQuery<any[]>({\n    queryKey: [`/api/category-scores/${categoryId}?period=weekly&limit=1`],\n  });\n\n  const { data: insights = [] } = useQuery<CategoryInsight[]>({\n    queryKey: [`/api/category-insights/${categoryId}`],\n  });\n\n  const latestWeeklyScore = weeklyScoreData?.[0];\n  const latestInsight = insights[0];\n\n  return (\n    <div className=\"space-y-4\" data-testid={`div-category-section-${categoryId}`}>\n      {/* Trend Chart */}\n      <CategoryTrendChart categoryId={categoryId} categoryName={categoryName} />\n\n      {/* Weekly Score Summary */}\n      {latestWeeklyScore && (\n        <Card data-testid={`card-weekly-summary-${categoryId}`}>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">This Week's Performance</CardTitle>\n            <CardDescription>Weekly score for {categoryName}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-4xl font-bold text-primary mb-1\">\n                  {latestWeeklyScore.score}\n                  <span className=\"text-xl text-muted-foreground\">/100</span>\n                </div>\n                <Badge variant={latestWeeklyScore.confidenceLevel === \"high\" ? \"default\" : \"secondary\"}>\n                  {latestWeeklyScore.confidenceLevel} confidence\n                </Badge>\n              </div>\n              {latestWeeklyScore.reasoning && (\n                <div className=\"flex-1 ml-6\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    {latestWeeklyScore.reasoning}\n                  </p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Key Insights */}\n      {latestInsight && (\n        <Card data-testid={`card-key-insights-${categoryId}`}>\n          <CardHeader>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                <Lightbulb className=\"h-5 w-5 text-primary\" />\n              </div>\n              <div className=\"flex-1\">\n                <CardTitle className=\"text-lg\">Key Insights</CardTitle>\n                <CardDescription>{latestInsight.timeframe}</CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <p className=\"text-sm mb-3\">{latestInsight.summary}</p>\n              \n              {latestInsight.keyPatterns && latestInsight.keyPatterns.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h4 className=\"text-sm font-semibold\">Patterns Detected:</h4>\n                  <ul className=\"space-y-1\">\n                    {latestInsight.keyPatterns.map((pattern, i) => (\n                      <li key={i} className=\"text-sm text-muted-foreground flex items-start gap-2\">\n                        <span className=\"text-primary\">•</span>\n                        <span>{pattern}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {latestInsight.recommendedActions && latestInsight.recommendedActions.length > 0 && (\n                <div className=\"mt-4 space-y-2\">\n                  <h4 className=\"text-sm font-semibold\">Recommended Actions:</h4>\n                  <ul className=\"space-y-1\">\n                    {latestInsight.recommendedActions.map((action, i) => (\n                      <li key={i} className=\"text-sm text-muted-foreground flex items-start gap-2\">\n                        <span className=\"text-primary\">→</span>\n                        <span>{action}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\nexport function DashboardOverview() {\n  const { toast } = useToast();\n  \n  const { data: stats } = useQuery<Stats>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  const { data: insights = [] } = useQuery<PersonalityInsight[]>({\n    queryKey: [\"/api/insights\"],\n  });\n\n  const { data: analysis } = useQuery<PersonalityAnalysis>({\n    queryKey: [\"/api/analyze-personality\"],\n    enabled: (stats?.conversationCount ?? 0) > 0 || (stats?.journalEntryCount ?? 0) > 0,\n    retry: false,\n  });\n\n  const { data: userCategories = [] } = useQuery<UserSelectedCategory[]>({\n    queryKey: [\"/api/user-categories\"],\n  });\n\n  const { data: categories = [] } = useQuery<any[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const analyzePersonalityMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/analyze-personality\", {});\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/analyze-personality\"] });\n      toast({\n        title: \"Analysis updated\",\n        description: \"Your personality profile has been refreshed with the latest insights.\"\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Analysis failed\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const blindSpots = insights.filter(i => i.insightType === \"blind_spot\");\n  const growthOpportunities = insights.filter(i => i.insightType === \"growth_opportunity\");\n  \n  const traits = analysis?.traits || {\n    openness: 50,\n    conscientiousness: 50,\n    extraversion: 50,\n    agreeableness: 50,\n    emotionalStability: 50\n  };\n\n  const selectedCategoriesData = userCategories.map((uc) => {\n    const category = categories.find((c: any) => c.id === uc.categoryId);\n    return {\n      ...uc,\n      categoryName: category?.name || \"Unknown Category\",\n    };\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Category Tracking Section */}\n      {selectedCategoriesData.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5 text-primary\" />\n            <h2 className=\"text-xl font-semibold\" data-testid=\"text-category-tracking-header\">\n              Your Focus Areas\n            </h2>\n          </div>\n          <div className=\"grid gap-6\">\n            {selectedCategoriesData.map((selectedCategory) => (\n              <CategorySection\n                key={selectedCategory.categoryId}\n                categoryId={selectedCategory.categoryId}\n                categoryName={selectedCategory.categoryName}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        <Card data-testid=\"card-profile-completion\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Profile Completion</CardTitle>\n            <ClipboardCheck className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold mb-2\">{stats?.profileCompletion || 0}%</div>\n            <Progress value={stats?.profileCompletion || 0} className=\"mb-2\" />\n            <p className=\"text-xs text-muted-foreground\">\n              Keep chatting and journaling for deeper insights\n            </p>\n          </CardContent>\n        </Card>\n        \n        <Card data-testid=\"card-current-streak\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Current Streak</CardTitle>\n            <Flame className=\"h-4 w-4 text-destructive\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold mb-2\">\n              {stats?.streak || 0} {(stats?.streak || 0) === 1 ? 'Day' : 'Days'}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Keep journaling daily to maintain your streak\n            </p>\n          </CardContent>\n        </Card>\n        \n        <Card data-testid=\"card-insights-discovered\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Insights Discovered</CardTitle>\n            <Lightbulb className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold mb-2\">{stats?.insightCount || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              AI-generated personality insights\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n      \n      <Card data-testid=\"card-personality-score\">\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0\">\n          <div>\n            <CardTitle>Your Personality Overview</CardTitle>\n            <CardDescription>\n              Based on {stats?.conversationCount || 0} conversations and {stats?.journalEntryCount || 0} journal entries\n            </CardDescription>\n          </div>\n          {((stats?.conversationCount ?? 0) > 0 || (stats?.journalEntryCount ?? 0) > 0) && (\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => analyzePersonalityMutation.mutate()}\n              disabled={analyzePersonalityMutation.isPending}\n              data-testid=\"button-refresh-analysis\"\n            >\n              <RefreshCw className={`h-4 w-4 ${analyzePersonalityMutation.isPending ? 'animate-spin' : ''}`} />\n            </Button>\n          )}\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Openness to Experience</span>\n              <span className=\"font-semibold\">{traits.openness}%</span>\n            </div>\n            <Progress value={traits.openness} />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Conscientiousness</span>\n              <span className=\"font-semibold\">{traits.conscientiousness}%</span>\n            </div>\n            <Progress value={traits.conscientiousness} />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Extraversion</span>\n              <span className=\"font-semibold\">{traits.extraversion}%</span>\n            </div>\n            <Progress value={traits.extraversion} />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Agreeableness</span>\n              <span className=\"font-semibold\">{traits.agreeableness}%</span>\n            </div>\n            <Progress value={traits.agreeableness} />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Emotional Stability</span>\n              <span className=\"font-semibold\">{traits.emotionalStability}%</span>\n            </div>\n            <Progress value={traits.emotionalStability} />\n          </div>\n          \n          {analysis && analysis.corePatterns && analysis.corePatterns.length > 0 && (\n            <div className=\"pt-4 border-t\">\n              <h4 className=\"text-sm font-semibold mb-2\">Core Patterns Detected</h4>\n              <ul className=\"space-y-1\">\n                {analysis.corePatterns.slice(0, 3).map((pattern, i) => (\n                  <li key={i} className=\"text-sm text-muted-foreground\">• {pattern}</li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n      \n      <div className=\"grid md:grid-cols-2 gap-6\">\n        {blindSpots.length > 0 && (\n          <Card className=\"border-l-4 border-l-destructive\" data-testid=\"card-recent-insight-blind-spot\">\n            <CardHeader>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"h-10 w-10 rounded-lg bg-destructive/10 flex items-center justify-center flex-shrink-0\">\n                  <AlertCircle className=\"h-5 w-5 text-destructive\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <CardTitle className=\"text-lg\">{blindSpots[0].title}</CardTitle>\n                    <Badge variant=\"destructive\" className=\"text-xs\">New</Badge>\n                  </div>\n                  <CardDescription className=\"text-base\">\n                    {blindSpots[0].description}\n                  </CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-explore-blind-spot\">\n                Explore This <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n        \n        {growthOpportunities.length > 0 && (\n          <Card className=\"border-l-4 border-l-primary\" data-testid=\"card-recent-insight-growth\">\n            <CardHeader>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Lightbulb className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <CardTitle className=\"text-lg\">{growthOpportunities[0].title}</CardTitle>\n                    <Badge className=\"text-xs\">Actionable</Badge>\n                  </div>\n                  <CardDescription className=\"text-base\">\n                    {growthOpportunities[0].description}\n                  </CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-explore-growth\">\n                Learn More <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n        \n        {insights.length === 0 && (\n          <Card className=\"md:col-span-2\">\n            <CardContent className=\"pt-6 text-center\">\n              <p className=\"text-muted-foreground\">\n                Start chatting and journaling to receive AI-generated personality insights\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n      \n      <Card data-testid=\"card-quick-actions\">\n        <CardHeader>\n          <CardTitle>Quick Actions</CardTitle>\n          <CardDescription>Continue building your personality profile</CardDescription>\n        </CardHeader>\n        <CardContent className=\"grid md:grid-cols-3 gap-4\">\n          <Link href=\"/chat\">\n            <Button className=\"h-auto py-6 flex-col gap-2 w-full\" data-testid=\"button-start-chat\">\n              <MessageSquare className=\"h-6 w-6\" />\n              <span>Start a Chat</span>\n            </Button>\n          </Link>\n          <Link href=\"/journal\">\n            <Button className=\"h-auto py-6 flex-col gap-2 w-full\" data-testid=\"button-write-journal\">\n              <BookOpen className=\"h-6 w-6\" />\n              <span>Write Journal Entry</span>\n            </Button>\n          </Link>\n          <Link href=\"/assessment\">\n            <Button className=\"h-auto py-6 flex-col gap-2 w-full\" data-testid=\"button-take-assessment\">\n              <ClipboardCheck className=\"h-6 w-6\" />\n              <span>Take Assessment</span>\n            </Button>\n          </Link>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":17153,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertMessageSchema, insertJournalEntrySchema, insertMoodEntrySchema, type Message } from \"@shared/schema\";\nimport OpenAI from \"openai\";\nimport { memoryService } from \"./memory-service\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { comprehensiveAnalytics } from \"./comprehensive-analytics\";\nimport { z } from \"zod\";\n\n// Initialize OpenAI client - prioritize direct API for unfiltered access\nconst apiKey = process.env.OPENAI_API_KEY ?? process.env.AI_INTEGRATIONS_OPENAI_API_KEY;\nif (!apiKey) {\n  console.error(\"ERROR: No OpenAI API key configured. Set either OPENAI_API_KEY or AI_INTEGRATIONS_OPENAI_API_KEY\");\n  throw new Error(\"OpenAI API key not configured\");\n}\n\nconst openai = new OpenAI({\n  apiKey,\n  // Only use baseURL if using Replit integration (AI_INTEGRATIONS_OPENAI_API_KEY)\n  baseURL: process.env.OPENAI_API_KEY ? undefined : process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nasync function triggerCategoryScoring(userId: string) {\n  try {\n    const selectedCategories = await storage.getUserSelectedCategories(userId);\n    \n    if (selectedCategories.length === 0) {\n      return;\n    }\n\n    for (const userCategory of selectedCategories) {\n      const { categoryId } = userCategory;\n      \n      const { generateAndPersistCategoryScore } = await import(\"./category-scoring\");\n      \n      generateAndPersistCategoryScore(\n        userId,\n        categoryId,\n        \"daily\",\n        7\n      ).catch(err => {\n        console.error(`Background category scoring failed for ${categoryId}:`, err.message);\n      });\n    }\n  } catch (error: any) {\n    console.error(\"Error triggering category scoring:\", error.message);\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup Replit Auth\n  await setupAuth(app);\n\n  // Auth endpoint - check if user is authenticated\n  app.get('/api/auth/user', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error: any) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n  \n  // Protected routes - all require authentication\n  app.post(\"/api/conversations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const conversation = await storage.createConversation(userId);\n      \n      // Create initial welcome message in database for persistence\n      await storage.createMessage({\n        conversationId: conversation.id,\n        role: \"assistant\",\n        content: \"Hello! I'm here to help you explore your thoughts and feelings. What would you like to talk about today?\"\n      });\n      \n      res.json(conversation);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/conversations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const conversations = await storage.getConversationsByUserId(userId);\n      res.json(conversations);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertMessageSchema.parse(req.body);\n      \n      // Verify conversation belongs to authenticated user\n      const conversation = await storage.getConversation(validatedData.conversationId);\n      if (!conversation || conversation.userId !== userId) {\n        return res.status(403).json({ error: \"Forbidden: conversation not found or access denied\" });\n      }\n      \n      const userMessage = await storage.createMessage(validatedData);\n      \n      triggerCategoryScoring(userId).catch(err =>\n        console.error(\"Error triggering category scoring after message:\", err)\n      );\n      \n      const conversationHistory = await storage.getMessagesByConversationId(validatedData.conversationId);\n      \n      const memoryContext = await memoryService.getMemoryContext(userId);\n      \n      const systemPrompt = `You are a direct, insightful AI personality analyst. Your role is to help users gain deeper self-understanding. You are:\n1. Empathetic but honest - provide clear observations without minimizing\n2. Pattern-focused - actively identify contradictions, recurring themes, and behavioral patterns\n3. Direct when appropriate - if you notice avoidance, people-pleasing, or self-deception, point it out clearly but kindly\n4. Curious about root causes - dig deeper into \"why\" behind behaviors and beliefs\n5. Growth-oriented - always connect insights to actionable improvements\n\nYour style:\n- Ask probing questions that challenge assumptions\n- Point out contradictions you notice: \"Earlier you said X, but now you're saying Y. What's really going on?\"\n- Name patterns directly: \"I'm noticing a pattern where you...\"\n- Balance clarity with compassion - be direct and supportive\n- Keep responses 2-4 sentences with one meaningful question\n\nYour goal is to be the honest mirror users need for genuine self-awareness.\n\n${memoryContext}\n\nUse these established facts to provide deeper, more personalized insights. Reference specific patterns or details you know about the user.`;\n\n      const messages = [\n        { role: \"system\" as const, content: systemPrompt },\n        ...conversationHistory.map(msg => ({\n          role: msg.role as \"user\" | \"assistant\",\n          content: msg.content\n        }))\n      ];\n\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages,\n        temperature: 0.8,\n        max_tokens: 500,\n      });\n\n      const aiResponse = completion.choices[0].message.content || \"I'm here to listen. Please continue.\";\n      \n      const aiMessage = await storage.createMessage({\n        conversationId: validatedData.conversationId,\n        role: \"assistant\",\n        content: aiResponse\n      });\n\n      memoryService.extractFactsFromMessages(userId, conversationHistory).catch(err => \n        console.error(\"Error extracting facts from messages:\", err)\n      );\n\n      res.json({ userMessage, aiMessage });\n    } catch (error: any) {\n      console.error(\"Error in /api/messages:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/messages/:conversationId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Verify conversation belongs to authenticated user\n      const conversation = await storage.getConversation(req.params.conversationId);\n      if (!conversation || conversation.userId !== userId) {\n        return res.status(403).json({ error: \"Forbidden: conversation not found or access denied\" });\n      }\n      \n      const messages = await storage.getMessagesByConversationId(req.params.conversationId);\n      res.json(messages);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/journal-entries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertJournalEntrySchema.parse(req.body);\n      const entry = await storage.createJournalEntry({ \n        ...validatedData, \n        userId\n      });\n      \n      triggerCategoryScoring(userId).catch(err =>\n        console.error(\"Error triggering category scoring after journal save:\", err)\n      );\n      \n      const allEntries = await storage.getJournalEntriesByUserId(userId);\n      const conversations = await storage.getConversationsByUserId(userId);\n      \n      if (allEntries.length >= 1) {  // Generate insights even with just one entry for faster feedback\n        const entriesText = allEntries.slice(0, 10).map(e => \n          `[${new Date(e.createdAt).toLocaleDateString()}] ${e.content}`\n        ).join(\"\\n\\n---\\n\\n\");\n        \n        let conversationContext = \"\";\n        if (conversations.length > 0) {\n          const recentConv = conversations[conversations.length - 1];\n          const messages = await storage.getMessagesByConversationId(recentConv.id);\n          conversationContext = `\\n\\nRecent conversation themes:\\n${messages.slice(-10).map(m => \n            `${m.role}: ${m.content}`\n          ).join(\"\\n\")}`;\n        }\n        \n        const analysisPrompt = `You are a personality analyst examining someone's inner world. Analyze these journal entries and conversation patterns to identify ONE significant personality insight.\n\nJournal Entries:\n${entriesText}${conversationContext}\n\nLook for:\n1. Recurring patterns (behavioral, emotional, relational)\n2. Contradictions between stated values and actions\n3. Blind spots - what they can't see about themselves\n4. Defense mechanisms or avoidance patterns\n5. Strengths they underutilize\n6. Core beliefs driving behavior\n\nProvide a JSON response with:\n{\n  \"insightType\": \"blind_spot\" or \"growth_opportunity\",\n  \"title\": \"Brief, direct title (max 8 words)\",\n  \"description\": \"Specific, honest insight with concrete examples from their writing (2-3 sentences). Be direct but compassionate.\",\n  \"priority\": \"high\" (affects relationships/wellbeing), \"medium\" (limits growth), or \"low\" (minor optimization)\n}\n\nFocus on insights that would genuinely surprise them or help them see something they've been avoiding.`;\n\n        try {\n          const analysis = await openai.chat.completions.create({\n            model: \"gpt-4o\",\n            messages: [{ role: \"user\", content: analysisPrompt }],\n            temperature: 0.8,\n            response_format: { type: \"json_object\" }\n          });\n\n          const insight = JSON.parse(analysis.choices[0].message.content || \"{}\");\n          \n          if (insight.title && insight.description) {\n            await storage.createPersonalityInsight({\n              userId,\n              insightType: insight.insightType || \"growth_opportunity\",\n              title: insight.title,\n              description: insight.description,\n              priority: insight.priority || \"medium\"\n            });\n          }\n        } catch (analysisError) {\n          console.error(\"Error generating insight:\", analysisError);\n        }\n      }\n      \n      memoryService.extractFactsFromJournal(userId, entry).catch(err => \n        console.error(\"Error extracting facts from journal:\", err)\n      );\n      \n      res.json(entry);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/journal-entries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const entries = await storage.getJournalEntriesByUserId(userId);\n      res.json(entries);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/journal-entries/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id } = req.params;\n      \n      // Verify ownership\n      const entry = await storage.getJournalEntriesByUserId(userId).then(entries => \n        entries.find(e => e.id === id)\n      );\n      \n      if (!entry) {\n        return res.status(404).json({ error: \"Journal entry not found\" });\n      }\n      \n      const validatedData = insertJournalEntrySchema.partial().parse(req.body);\n      const updatedEntry = await storage.updateJournalEntry(id, validatedData);\n      res.json(updatedEntry);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/journal-entries/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id } = req.params;\n      \n      // Verify ownership\n      const entry = await storage.getJournalEntriesByUserId(userId).then(entries => \n        entries.find(e => e.id === id)\n      );\n      \n      if (!entry) {\n        return res.status(404).json({ error: \"Journal entry not found\" });\n      }\n      \n      await storage.deleteJournalEntry(id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/insights\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const insights = await storage.getPersonalityInsightsByUserId(userId);\n      res.json(insights);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/analyze-personality\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const conversations = await storage.getConversationsByUserId(userId);\n      const journalEntries = await storage.getJournalEntriesByUserId(userId);\n      \n      if (conversations.length === 0 && journalEntries.length === 0) {\n        return res.status(400).json({ error: \"Not enough data for analysis. Chat or journal first.\" });\n      }\n      \n      let allMessages: Message[] = [];\n      for (const conv of conversations) {\n        const msgs = await storage.getMessagesByConversationId(conv.id);\n        allMessages = allMessages.concat(msgs);\n      }\n      \n      const conversationText = allMessages.slice(-20).map(m => \n        `${m.role}: ${m.content}`\n      ).join(\"\\n\");\n      \n      const journalText = journalEntries.slice(0, 10).map(e => \n        `[${new Date(e.createdAt).toLocaleDateString()}] ${e.content.substring(0, 500)}`\n      ).join(\"\\n\\n---\\n\\n\");\n      \n      const analysisPrompt = `You are conducting a comprehensive personality analysis. Analyze this person's conversations and journal entries to provide honest insights about their personality.\n\nRecent Conversations:\n${conversationText}\n\nJournal Entries:\n${journalText}\n\nProvide a detailed JSON analysis with:\n{\n  \"traits\": {\n    \"openness\": 0-100 (intellectual curiosity, creativity, openness to new experiences),\n    \"conscientiousness\": 0-100 (organization, responsibility, self-discipline),\n    \"extraversion\": 0-100 (social energy, assertiveness, enthusiasm),\n    \"agreeableness\": 0-100 (compassion, cooperation, trust),\n    \"emotionalStability\": 0-100 (resilience, emotional regulation, confidence)\n  },\n  \"corePatterns\": [\n    \"Pattern 1: specific behavioral/emotional pattern you observe\",\n    \"Pattern 2: ...\",\n    \"Pattern 3: ...\"\n  ],\n  \"blindSpots\": [\n    \"Blind spot 1: what they can't see about themselves\",\n    \"Blind spot 2: ...\"\n  ],\n  \"strengths\": [\n    \"Strength 1: underutilized strength\",\n    \"Strength 2: ...\"\n  ]\n}\n\nBe specific and reference their actual words/behaviors. Don't be generic - give them insights they couldn't get from a buzzfeed quiz.`;\n\n      const analysis = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [{ role: \"user\", content: analysisPrompt }],\n        temperature: 0.7,\n        response_format: { type: \"json_object\" }\n      });\n\n      const result = JSON.parse(analysis.choices[0].message.content || \"{}\");\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"Error in personality analysis:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const conversations = await storage.getConversationsByUserId(userId);\n      const journalEntries = await storage.getJournalEntriesByUserId(userId);\n      const insights = await storage.getPersonalityInsightsByUserId(userId);\n      \n      const sortedEntries = [...journalEntries].sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n      let streak = 0;\n      if (sortedEntries.length > 0) {\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        \n        for (let i = sortedEntries.length - 1; i >= 0; i--) {\n          const entryDate = new Date(sortedEntries[i].createdAt);\n          entryDate.setHours(0, 0, 0, 0);\n          \n          const daysDiff = Math.floor((today.getTime() - entryDate.getTime()) / (1000 * 60 * 60 * 24));\n          \n          if (daysDiff === streak) {\n            streak++;\n          } else {\n            break;\n          }\n        }\n      }\n      \n      res.json({\n        conversationCount: conversations.length,\n        journalEntryCount: journalEntries.length,\n        insightCount: insights.length,\n        streak,\n        profileCompletion: Math.min(100, (conversations.length * 5) + (journalEntries.length * 10))\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Mood entry endpoints\n  app.post(\"/api/mood-entries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertMoodEntrySchema.parse(req.body);\n      const entry = await storage.createMoodEntry({ ...validatedData, userId });\n      res.json(entry);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/mood-entries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const entries = await storage.getMoodEntriesByUserId(userId);\n      res.json(entries);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Background job processor for personality reflection generation\n  async function processPersonalityReflection(reflectionId: string, userId: string, tier: 'free' | 'standard' | 'premium') {\n    console.log('[PERSONALITY-REFLECTION] Background job started:', { reflectionId, userId, tier });\n    \n    try {\n      // Update status to processing\n      await storage.updatePersonalityReflection(reflectionId, {\n        status: 'processing',\n        progress: 5,\n        currentSection: 'Initializing analysis...'\n      });\n      \n      // Generate comprehensive profile with tier and progress callback\n      const profile = await comprehensiveAnalytics.generatePersonalityProfile(\n        userId, \n        tier,\n        async (progress: number, currentSection: string) => {\n          // Update progress in database\n          await storage.updatePersonalityReflection(reflectionId, {\n            progress,\n            currentSection\n          });\n        }\n      );\n      \n      if (!profile) {\n        await storage.updatePersonalityReflection(reflectionId, {\n          status: 'failed',\n          errorMessage: 'Not enough data for comprehensive analysis. Continue journaling, chatting, and tracking moods to build your profile.',\n          progress: 0\n        });\n        return;\n      }\n      \n      // Update with completed analysis\n      await storage.updatePersonalityReflection(reflectionId, {\n        status: 'completed',\n        progress: 100,\n        currentSection: null,\n        summary: profile.summary,\n        coreTraits: profile.coreTraits,\n        behavioralPatterns: profile.behavioralPatterns || [],\n        emotionalPatterns: profile.emotionalPatterns || [],\n        relationshipDynamics: profile.relationshipDynamics || [],\n        copingMechanisms: profile.copingMechanisms || [],\n        growthAreas: profile.growthAreas || [],\n        strengths: profile.strengths || [],\n        blindSpots: profile.blindSpots || [],\n        valuesAndBeliefs: profile.valuesAndBeliefs || [],\n        therapeuticInsights: profile.therapeuticInsights || [],\n        holyShitMoment: profile.holyShitMoment || null,\n        growthLeveragePoint: profile.growthLeveragePoint || null,\n        statistics: profile.statistics,\n      });\n      \n      console.log('[PERSONALITY-REFLECTION] Background job completed:', reflectionId);\n      \n    } catch (error: any) {\n      console.error('[PERSONALITY-REFLECTION] Background job failed:', error);\n      \n      let errorMessage = error.message || 'Unknown error occurred';\n      \n      // Handle OpenAI-specific errors\n      if (error.status === 429 || error.code === 'insufficient_quota') {\n        errorMessage = 'OpenAI API quota exceeded. Please check your OpenAI account billing and usage limits.';\n      }\n      \n      await storage.updatePersonalityReflection(reflectionId, {\n        status: 'failed',\n        errorMessage,\n        progress: 0\n      });\n    }\n  }\n\n  // Comprehensive personality reflection endpoint with async job support\n  app.post(\"/api/personality-reflection\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { tier } = req.body as { tier?: 'free' | 'standard' | 'premium' };\n      \n      console.log('[PERSONALITY-REFLECTION] Request received:', { userId, requestedTier: tier });\n      \n      // Default to free tier if not specified\n      const analysisTier = tier || 'free';\n      \n      // Validate tier\n      if (!['free', 'standard', 'premium'].includes(analysisTier)) {\n        return res.status(400).json({ error: \"Invalid tier. Must be 'free', 'standard', or 'premium'\" });\n      }\n      \n      // Check if there's already an active generation for this user (per-user lock)\n      const activeReflection = await storage.getActivePersonalityReflection(userId);\n      if (activeReflection) {\n        console.log('[PERSONALITY-REFLECTION] Active job found, returning existing:', activeReflection.id);\n        return res.json(activeReflection);\n      }\n      \n      // Create a pending reflection record\n      const reflection = await storage.createPersonalityReflection({\n        userId,\n        tier: analysisTier,\n        status: 'pending',\n        progress: 0,\n        currentSection: 'Queued for processing...',\n        summary: '',\n        coreTraits: {},\n        behavioralPatterns: [],\n        emotionalPatterns: [],\n        relationshipDynamics: [],\n        copingMechanisms: [],\n        growthAreas: [],\n        strengths: [],\n        blindSpots: [],\n        valuesAndBeliefs: [],\n        therapeuticInsights: [],\n        holyShitMoment: null,\n        growthLeveragePoint: null,\n        statistics: null,\n      });\n      \n      console.log('[PERSONALITY-REFLECTION] Created pending job:', reflection.id);\n      \n      // Kick off background processing (don't await - fire and forget)\n      processPersonalityReflection(reflection.id, userId, analysisTier).catch(err => {\n        console.error('[PERSONALITY-REFLECTION] Background job error:', err);\n      });\n      \n      // Return the pending reflection immediately\n      res.json(reflection);\n      \n    } catch (error: any) {\n      console.error(\"Error creating personality reflection job:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get personality reflection by ID (for polling)\n  app.get(\"/api/personality-reflection/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reflectionId = req.params.id;\n      \n      const reflection = await storage.getPersonalityReflection(reflectionId);\n      \n      if (!reflection) {\n        return res.status(404).json({ error: \"Personality reflection not found.\" });\n      }\n      \n      // Verify ownership\n      if (reflection.userId !== userId) {\n        return res.status(403).json({ error: \"Access denied.\" });\n      }\n      \n      res.json(reflection);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get latest personality reflection (completed only)\n  app.get(\"/api/personality-reflection\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reflection = await storage.getLatestPersonalityReflection(userId);\n      \n      if (!reflection) {\n        return res.status(404).json({ error: \"No personality reflection found. Generate one first.\" });\n      }\n\n      res.json(reflection);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/text-to-speech\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { text, voiceId } = req.body;\n\n      console.log(\"[TTS] Request received, text length:\", text?.length, \"voiceId:\", voiceId);\n\n      if (!text) {\n        return res.status(400).json({ error: \"Text is required\" });\n      }\n\n      if (!process.env.ELEVENLABS_API_KEY) {\n        console.error(\"[TTS] Eleven Labs API key not configured\");\n        return res.status(500).json({ error: \"Eleven Labs API key not configured\" });\n      }\n\n      const voice = voiceId || \"21m00Tcm4TlvDq8ikWAM\"; // Default to Rachel voice\n\n      console.log(\"[TTS] Calling Eleven Labs API with voice:\", voice);\n\n      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voice}`, {\n        method: \"POST\",\n        headers: {\n          \"Accept\": \"audio/mpeg\",\n          \"Content-Type\": \"application/json\",\n          \"xi-api-key\": process.env.ELEVENLABS_API_KEY,\n        },\n        body: JSON.stringify({\n          text,\n          model_id: \"eleven_monolingual_v1\",\n          voice_settings: {\n            stability: 0.5,\n            similarity_boost: 0.5,\n          },\n        }),\n      });\n\n      console.log(\"[TTS] Eleven Labs response status:\", response.status);\n\n      if (!response.ok) {\n        const error = await response.text();\n        console.error(\"[TTS] Eleven Labs API error:\", response.status, error);\n        return res.status(response.status).json({ error: \"Failed to generate speech\" });\n      }\n\n      const audioBuffer = await response.arrayBuffer();\n      console.log(\"[TTS] Audio buffer received, size:\", audioBuffer.byteLength, \"bytes\");\n      \n      res.setHeader(\"Content-Type\", \"audio/mpeg\");\n      res.send(Buffer.from(audioBuffer));\n    } catch (error: any) {\n      console.error(\"[TTS] Text-to-speech error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== CATEGORY TRACKING ENDPOINTS =====\n  \n  // Validation schemas for category endpoints\n  const selectCategorySchema = z.object({\n    categoryId: z.string().min(1),\n    goalScore: z.number().int().min(0).max(100).optional().nullable(),\n    baselineScore: z.number().int().min(0).max(100).optional().nullable()\n  });\n\n  const generateScoreSchema = z.object({\n    periodType: z.enum(['daily', 'weekly']).optional().default('daily'),\n    lookbackDays: z.number().int().min(1).max(30).optional().default(7)\n  });\n\n  const getCategoryScoresSchema = z.object({\n    period: z.enum(['daily', 'weekly']).optional(),\n    limit: z.coerce.number().int().min(1).max(365).optional().default(30)\n  });\n\n  // GET /api/categories - List all categories with tier metadata\n  app.get(\"/api/categories\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { getAllCategories } = await import(\"./categories\");\n      const categories = getAllCategories();\n      res.json(categories);\n    } catch (error: any) {\n      console.error(\"Error fetching categories:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // GET /api/user-categories - Get user's selected categories with latest scores\n  app.get(\"/api/user-categories\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const selectedCategories = await storage.getUserSelectedCategories(userId);\n      \n      // Enrich with latest scores\n      const enrichedCategories = await Promise.all(\n        selectedCategories.map(async (cat) => {\n          const latestDaily = await storage.getLatestCategoryScore(userId, cat.categoryId, 'daily');\n          const latestWeekly = await storage.getLatestCategoryScore(userId, cat.categoryId, 'weekly');\n          return {\n            ...cat,\n            latestDailyScore: latestDaily,\n            latestWeeklyScore: latestWeekly\n          };\n        })\n      );\n\n      res.json(enrichedCategories);\n    } catch (error: any) {\n      console.error(\"Error fetching user categories:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // POST /api/user-categories - Select a category to track\n  app.post(\"/api/user-categories\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Validate request body\n      const validation = selectCategorySchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors });\n      }\n\n      const { categoryId, goalScore, baselineScore } = validation.data;\n\n      // Check if category exists\n      const { getCategoryById } = await import(\"./categories\");\n      const category = getCategoryById(categoryId);\n      if (!category) {\n        return res.status(404).json({ error: \"Category not found\" });\n      }\n\n      // TODO: Add plan limit enforcement (Free=1, Premium tiers unlock more)\n      // For MVP, allow unlimited selections\n\n      const selected = await storage.selectCategory({\n        userId,\n        categoryId,\n        status: 'active',\n        baselineScore: baselineScore ?? null,\n        goalScore: goalScore ?? null\n      });\n\n      res.status(201).json(selected);\n    } catch (error: any) {\n      console.error(\"Error selecting category:\", error);\n      if (error.message?.includes('duplicate') || error.message?.includes('unique')) {\n        return res.status(409).json({ error: \"Category already selected\" });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // DELETE /api/user-categories/:categoryId - Unselect a category\n  app.delete(\"/api/user-categories/:categoryId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { categoryId } = req.params;\n\n      await storage.unselectCategory(userId, categoryId);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error unselecting category:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // POST /api/category-scores/:categoryId/generate - Generate and persist new score\n  app.post(\"/api/category-scores/:categoryId/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { categoryId } = req.params;\n      \n      // Validate request body\n      const validation = generateScoreSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors });\n      }\n\n      const { periodType, lookbackDays } = validation.data;\n\n      // Verify user has this category selected\n      const selectedCategories = await storage.getUserSelectedCategories(userId);\n      const isSelected = selectedCategories.some(cat => cat.categoryId === categoryId);\n      \n      if (!isSelected) {\n        return res.status(403).json({ error: \"Category not selected. Select it first.\" });\n      }\n\n      const { generateAndPersistCategoryScore } = await import(\"./category-scoring\");\n      const result = await generateAndPersistCategoryScore(\n        userId,\n        categoryId,\n        periodType,\n        lookbackDays\n      );\n\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"Error generating category score:\", error);\n      \n      // Handle insufficient data error\n      if (error.message?.includes('Insufficient data')) {\n        return res.status(400).json({ error: error.message });\n      }\n      \n      // Handle duplicate score error (from unique constraint)\n      if (error.message?.includes('duplicate') || error.message?.includes('unique')) {\n        return res.status(409).json({ error: \"Score already exists for this period. Retrieve existing score instead.\" });\n      }\n      \n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // GET /api/category-scores/:categoryId - Get score history for a category\n  app.get(\"/api/category-scores/:categoryId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { categoryId } = req.params;\n      \n      // Validate query parameters\n      const validation = getCategoryScoresSchema.safeParse(req.query);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors });\n      }\n\n      const { period, limit } = validation.data;\n\n      const scores = await storage.getCategoryScores(userId, categoryId, period, limit);\n      res.json(scores);\n    } catch (error: any) {\n      console.error(\"Error fetching category scores:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // GET /api/category-insights/:categoryId - Get insights for a category\n  app.get(\"/api/category-insights/:categoryId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { categoryId } = req.params;\n      const limit = parseInt(req.query.limit as string) || 10;\n\n      const insights = await storage.getCategoryInsights(userId, categoryId, limit);\n      res.json(insights);\n    } catch (error: any) {\n      console.error(\"Error fetching category insights:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":33258,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/examples/DashboardNav.tsx":{"content":"import { DashboardNav } from '../DashboardNav';\n\nexport default function DashboardNavExample() {\n  return <DashboardNav />;\n}\n","path":null,"size_bytes":126,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/Chat.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { ChatInterface } from \"@/components/ChatInterface\";\n\nexport default function Chat() {\n  return (\n    <div className=\"min-h-screen\">\n      <DashboardNav />\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-semibold mb-1 sm:mb-2\">AI Chat</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            Have an open conversation about anything on your mind\n          </p>\n        </div>\n        <ChatInterface />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":639,"size_tokens":null},"client/src/components/ChatInterface.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Send, Sparkles, Plus, Mic, MicOff, Volume2, VolumeX, VolumeOff } from \"lucide-react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Message, Conversation } from \"@shared/schema\";\nimport { useSpeechRecognition } from \"@/hooks/useSpeechRecognition\";\nimport { useTextToSpeech } from \"@/hooks/useTextToSpeech\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { stripMarkdownForSpeech } from \"@/lib/utils\";\n\nconst suggestedPrompts = [\n  \"What's been on your mind lately?\",\n  \"Tell me about a recent challenge you faced\",\n  \"How do you handle stress?\",\n  \"What are your current goals?\"\n];\n\nexport function ChatInterface() {\n  const [conversationId, setConversationId] = useState<string | null>(() => {\n    return sessionStorage.getItem(\"currentConversationId\");\n  });\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [speakingMessageId, setSpeakingMessageId] = useState<string | null>(null);\n  const [pendingMessageId, setPendingMessageId] = useState<string | null>(null);\n  const [autoPlayEnabled, setAutoPlayEnabled] = useState<boolean>(() => {\n    const saved = localStorage.getItem(\"autoPlayEnabled\");\n    // Default to true if never set before\n    return saved === null ? true : saved === \"true\";\n  });\n  const [needsUserInteraction, setNeedsUserInteraction] = useState(false);\n  const [hasUserInteracted, setHasUserInteracted] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const latestAiMessageRef = useRef<string | null>(null);\n  const { toast } = useToast();\n\n  const {\n    isListening,\n    transcript,\n    interimTranscript,\n    isSupported: isSpeechRecognitionSupported,\n    error: speechError,\n    startListening,\n    stopListening,\n    resetTranscript,\n  } = useSpeechRecognition();\n\n  const { speak, stop: stopSpeaking, isSpeaking, unlockAudio } = useTextToSpeech({\n    onStart: () => {\n      // When playback actually starts, update the speaking message ID\n      if (pendingMessageId) {\n        setSpeakingMessageId(pendingMessageId);\n        setPendingMessageId(null);\n      }\n      \n      // Clear the \"needs interaction\" banner since playback started successfully\n      setNeedsUserInteraction(false);\n      \n      // Stop listening when playback starts to prevent feedback\n      if (isListening) {\n        stopListening();\n      }\n    },\n    onEnd: () => {\n      setSpeakingMessageId(null);\n      setPendingMessageId(null);\n    },\n    onError: (error) => {\n      console.log('TTS onError triggered', { autoPlayEnabled, hasUserInteracted, error });\n      // Only show error for non-autoplay issues\n      // Autoplay blocks are handled silently with the banner\n      if (autoPlayEnabled && !hasUserInteracted) {\n        console.log('Setting needsUserInteraction to true');\n        setNeedsUserInteraction(true);\n      } else {\n        console.log('Showing error toast instead of banner');\n        toast({\n          title: \"Speech Error\",\n          description: \"Failed to generate speech. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n      setSpeakingMessageId(null);\n      setPendingMessageId(null);\n    },\n  });\n\n  // Save auto-play preference to localStorage\n  useEffect(() => {\n    localStorage.setItem(\"autoPlayEnabled\", String(autoPlayEnabled));\n  }, [autoPlayEnabled]);\n\n  // Show toast when speech recognition errors occur\n  useEffect(() => {\n    if (speechError) {\n      const errorMessages: Record<string, string> = {\n        'not-allowed': 'Microphone permission denied. Please allow microphone access.',\n        'no-speech': 'No speech detected. Please try again.',\n        'audio-capture': 'No microphone found. Please check your device.',\n        'network': 'Network error. Please check your connection.',\n      };\n      \n      toast({\n        title: \"Voice Input Error\",\n        description: errorMessages[speechError] || 'Speech recognition failed. Please try again.',\n        variant: \"destructive\",\n      });\n    }\n  }, [speechError, toast]);\n\n  // Initialize latestAiMessageRef when messages load or auto-play is toggled on\n  useEffect(() => {\n    if (messages.length === 0) return;\n\n    // Find the most recent assistant message\n    for (let i = messages.length - 1; i >= 0; i--) {\n      if (messages[i].role === \"assistant\") {\n        // Update the ref when:\n        // 1. It's not set yet (initial load)\n        // 2. Auto-play is enabled (sync to latest when toggled on)\n        // This prevents replaying old messages when loading or re-enabling auto-play\n        if (!latestAiMessageRef.current || autoPlayEnabled) {\n          latestAiMessageRef.current = messages[i].id;\n        }\n        break;\n      }\n    }\n  }, [messages, autoPlayEnabled]);\n\n  // Auto-play AI messages when enabled\n  useEffect(() => {\n    if (!autoPlayEnabled || messages.length === 0) return;\n\n    // Find the latest message\n    const latestMessage = messages[messages.length - 1];\n    \n    // Only auto-play if it's an AI message and we haven't played it yet\n    if (\n      latestMessage.role === \"assistant\" && \n      latestMessage.id !== latestAiMessageRef.current &&\n      !isSpeaking &&\n      !pendingMessageId\n    ) {\n      latestAiMessageRef.current = latestMessage.id;\n      setPendingMessageId(latestMessage.id);\n      speak(stripMarkdownForSpeech(latestMessage.content));\n    }\n  }, [messages, autoPlayEnabled, isSpeaking, pendingMessageId, speak]);\n\n  // Handle user interaction to enable auto-play\n  const handleEnableAutoPlay = async () => {\n    // Unlock audio context first\n    await unlockAudio();\n    \n    setHasUserInteracted(true);\n    setNeedsUserInteraction(false);\n    \n    // Try to play the latest AI message\n    const latestAiMessage = messages.filter(m => m.role === \"assistant\").pop();\n    if (latestAiMessage) {\n      // Mark as user-initiated so it unlocks audio\n      setPendingMessageId(latestAiMessage.id);\n      speak(stripMarkdownForSpeech(latestAiMessage.content), true);\n    }\n  };\n\n  const { data: conversations, isLoading } = useQuery<Conversation[]>({\n    queryKey: [\"/api/conversations\"]\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      const res = await apiRequest(\"POST\", \"/api/messages\", {\n        conversationId,\n        role: \"user\",\n        content\n      });\n      return res.json();\n    },\n    onSuccess: (data: any) => {\n      setMessages(prev => [...prev, data.aiMessage]);\n    },\n    onError: (error: any) => {\n      console.error(\"Error sending message:\", error);\n      toast({\n        title: \"AI Response Failed\",\n        description: \"The AI couldn't generate a response. Please try rephrasing your message or try again later.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, sendMessageMutation.isPending]);\n\n  // Reset initialization when component unmounts to allow reload on remount\n  useEffect(() => {\n    return () => {\n      setIsInitialized(false);\n    };\n  }, []);\n\n  useEffect(() => {\n    const loadOrCreateConversation = async () => {\n      if (!conversations || isInitialized) return;\n\n      // Priority 1: Check if we have a stored conversation ID that still exists\n      const storedId = sessionStorage.getItem(\"currentConversationId\");\n      if (storedId && conversations.some(c => c.id === storedId)) {\n        setConversationId(storedId);\n        \n        const messagesRes = await fetch(`/api/messages/${storedId}`);\n        const loadedMessages: Message[] = await messagesRes.json();\n        setMessages(loadedMessages);\n      } else if (conversations.length > 0) {\n        // Priority 2: Load most recent conversation if no valid stored ID\n        const mostRecent = conversations[0];\n        setConversationId(mostRecent.id);\n        sessionStorage.setItem(\"currentConversationId\", mostRecent.id);\n        \n        const messagesRes = await fetch(`/api/messages/${mostRecent.id}`);\n        const loadedMessages: Message[] = await messagesRes.json();\n        setMessages(loadedMessages);\n      } else {\n        // Priority 3: Create new conversation only if absolutely none exist\n        const response = await fetch(\"/api/conversations\", { method: \"POST\" });\n        const data = await response.json();\n        setConversationId(data.id);\n        sessionStorage.setItem(\"currentConversationId\", data.id);\n        \n        // Fetch messages (including the persisted welcome message)\n        const messagesRes = await fetch(`/api/messages/${data.id}`);\n        const loadedMessages: Message[] = await messagesRes.json();\n        setMessages(loadedMessages);\n      }\n      \n      setIsInitialized(true);\n    };\n\n    if (conversations !== undefined && !isInitialized) {\n      loadOrCreateConversation();\n    }\n  }, [conversations, isInitialized]);\n\n  useEffect(() => {\n    if (isListening) {\n      const fullTranscript = (transcript + ' ' + interimTranscript).trim();\n      setInput(fullTranscript);\n    }\n  }, [transcript, interimTranscript, isListening]);\n\n  const handleSend = () => {\n    if (!input.trim() || !conversationId) return;\n    \n    const userMessage: Message = {\n      id: Date.now().toString(),\n      conversationId,\n      role: \"user\",\n      content: input,\n      createdAt: new Date()\n    };\n    \n    setMessages(prev => [...prev, userMessage]);\n    setInput(\"\");\n    if (isListening) {\n      stopListening();\n      resetTranscript();\n    }\n    sendMessageMutation.mutate(input);\n  };\n\n  const toggleVoiceInput = () => {\n    if (isListening) {\n      stopListening();\n    } else {\n      if (!isSpeechRecognitionSupported) {\n        toast({\n          title: \"Not Supported\",\n          description: \"Speech recognition is not supported in your browser. Try Chrome or Edge.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      resetTranscript();\n      startListening();\n    }\n  };\n\n  const handleSpeakMessage = async (messageId: string, content: string) => {\n    // If clicking the same message that's currently speaking, stop it\n    if (speakingMessageId === messageId || pendingMessageId === messageId) {\n      stopSpeaking();\n      setSpeakingMessageId(null);\n      setPendingMessageId(null);\n      return;\n    }\n    \n    // Set pending ID and start playback\n    // The actual speaking ID will be set in onStart callback when playback begins\n    setPendingMessageId(messageId);\n    // Mark as user-initiated since this is a manual click\n    speak(stripMarkdownForSpeech(content), true);\n  };\n\n  const handlePromptClick = (prompt: string) => {\n    setInput(prompt);\n  };\n\n  const handleNewConversation = async () => {\n    setIsInitialized(false);  // Reset to allow reinitialization with new conversation\n    const response = await fetch(\"/api/conversations\", { method: \"POST\" });\n    const data = await response.json();\n    setConversationId(data.id);\n    sessionStorage.setItem(\"currentConversationId\", data.id);\n    \n    // Fetch messages (including the persisted welcome message)\n    const messagesRes = await fetch(`/api/messages/${data.id}`);\n    const loadedMessages: Message[] = await messagesRes.json();\n    setMessages(loadedMessages);\n    \n    setIsInitialized(true);  // Mark as initialized again\n  };\n\n  if (isLoading || !isInitialized) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <p className=\"text-muted-foreground\">Loading conversation...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6\">\n      {needsUserInteraction && autoPlayEnabled && (\n        <Card className=\"border-primary/50 bg-primary/5\" data-testid=\"card-enable-autoplay\">\n          <CardContent className=\"flex items-center justify-between gap-3 p-3 sm:p-4\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <Volume2 className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary shrink-0\" />\n              <p className=\"text-xs sm:text-sm\">\n                <span className=\"font-medium\">Auto-play is ready!</span>\n                <span className=\"hidden sm:inline\"> Click to enable AI voice responses.</span>\n              </p>\n            </div>\n            <Button \n              size=\"sm\" \n              onClick={handleEnableAutoPlay}\n              data-testid=\"button-enable-autoplay\"\n              className=\"shrink-0\"\n            >\n              Enable\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n      <Card data-testid=\"card-chat-interface\">\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 p-4 sm:p-6\">\n          <CardTitle className=\"flex items-center gap-2 text-base sm:text-lg\">\n            <Sparkles className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n            <span className=\"hidden sm:inline\">AI Conversation</span>\n            <span className=\"sm:hidden\">Chat</span>\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant={autoPlayEnabled ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setAutoPlayEnabled(!autoPlayEnabled)}\n              data-testid=\"button-toggle-autoplay\"\n              className=\"shrink-0\"\n            >\n              {autoPlayEnabled ? (\n                <Volume2 className=\"h-4 w-4 sm:mr-1\" />\n              ) : (\n                <VolumeOff className=\"h-4 w-4 sm:mr-1\" />\n              )}\n              <span className=\"hidden sm:inline\">\n                {autoPlayEnabled ? \"Auto-play On\" : \"Auto-play Off\"}\n              </span>\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={handleNewConversation}\n              data-testid=\"button-new-conversation\"\n            >\n              <Plus className=\"h-4 w-4 sm:mr-1\" />\n              <span className=\"hidden sm:inline\">New Chat</span>\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-3 sm:space-y-4 p-4 sm:p-6\">\n          <ScrollArea className=\"h-[300px] sm:h-[400px] pr-2 sm:pr-4\" data-testid=\"scroll-messages\">\n            <div className=\"space-y-3 sm:space-y-4\">\n              {messages.map((message) => (\n                <div\n                  key={message.id}\n                  className={`flex items-start gap-2 ${message.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                  data-testid={`message-${message.role}-${message.id}`}\n                >\n                  <div\n                    className={`max-w-[85%] sm:max-w-[80%] rounded-lg p-3 sm:p-4 ${\n                      message.role === \"user\"\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"bg-muted\"\n                    }`}\n                  >\n                    <p className=\"text-sm break-words\">{message.content}</p>\n                    <p className={`text-xs mt-1.5 sm:mt-2 ${\n                      message.role === \"user\" ? \"text-primary-foreground/70\" : \"text-muted-foreground\"\n                    }`}>\n                      {new Date(message.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                    </p>\n                  </div>\n                  {message.role === \"assistant\" && (\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      className=\"shrink-0 h-8 w-8\"\n                      onClick={() => handleSpeakMessage(message.id, message.content)}\n                      disabled={isListening}\n                      data-testid={`button-speak-${message.id}`}\n                    >\n                      {(speakingMessageId === message.id || pendingMessageId === message.id) ? (\n                        <VolumeX className=\"h-4 w-4\" />\n                      ) : (\n                        <Volume2 className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  )}\n                </div>\n              ))}\n              {sendMessageMutation.isPending && (\n                <div className=\"flex justify-start\">\n                  <div className=\"bg-muted rounded-lg p-3 sm:p-4\">\n                    <p className=\"text-sm text-muted-foreground\">AI is typing...</p>\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n          </ScrollArea>\n          \n          <div className=\"space-y-3\">\n            <div className=\"flex gap-2\">\n              <div className=\"flex-1 relative\">\n                <Textarea\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  placeholder={isListening ? \"Listening...\" : \"Share your thoughts...\"}\n                  className=\"resize-none text-sm sm:text-base\"\n                  rows={3}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" && !e.shiftKey) {\n                      e.preventDefault();\n                      handleSend();\n                    }\n                  }}\n                  data-testid=\"input-chat-message\"\n                />\n                {isListening && (\n                  <Badge variant=\"destructive\" className=\"absolute top-2 right-2 animate-pulse\">\n                    Recording\n                  </Badge>\n                )}\n              </div>\n              <div className=\"flex flex-col gap-2 shrink-0\">\n                <Button\n                  onClick={toggleVoiceInput}\n                  variant={isListening ? \"destructive\" : \"outline\"}\n                  size=\"icon\"\n                  data-testid=\"button-voice-input\"\n                >\n                  {isListening ? (\n                    <MicOff className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                  ) : (\n                    <Mic className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                  )}\n                </Button>\n                <Button\n                  onClick={handleSend}\n                  disabled={!input.trim() || sendMessageMutation.isPending}\n                  size=\"icon\"\n                  data-testid=\"button-send-message\"\n                >\n                  <Send className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      <Card data-testid=\"card-suggested-prompts\">\n        <CardHeader className=\"p-4 sm:p-6\">\n          <CardTitle className=\"text-sm sm:text-base\">Conversation Starters</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-4 sm:p-6\">\n          <div className=\"flex flex-wrap gap-2\">\n            {suggestedPrompts.map((prompt, index) => (\n              <Badge\n                key={index}\n                variant=\"secondary\"\n                className=\"cursor-pointer hover-elevate active-elevate-2 px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm\"\n                onClick={() => handlePromptClick(prompt)}\n                data-testid={`badge-prompt-${index}`}\n              >\n                {prompt}\n              </Badge>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":19616,"size_tokens":null},"client/src/components/examples/DashboardOverview.tsx":{"content":"import { DashboardOverview } from '../DashboardOverview';\n\nexport default function DashboardOverviewExample() {\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto\">\n      <DashboardOverview />\n    </div>\n  );\n}\n","path":null,"size_bytes":213,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/examples/ChatInterface.tsx":{"content":"import { ChatInterface } from '../ChatInterface';\n\nexport default function ChatInterfaceExample() {\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto\">\n      <ChatInterface />\n    </div>\n  );\n}\n","path":null,"size_bytes":197,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"server/replitAuth.ts":{"content":"// Replit Auth integration - OpenID Connect authentication\nimport * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  // Map standard OIDC claims (given_name, family_name) to our schema\n  // Fall back to parsing 'name' claim if given_name/family_name not available\n  const firstName = claims[\"given_name\"] || claims[\"name\"]?.split(' ')[0] || '';\n  const lastName = claims[\"family_name\"] || claims[\"name\"]?.split(' ').slice(1).join(' ') || '';\n  \n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName,\n    lastName,\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  // Keep track of registered strategies\n  const registeredStrategies = new Set<string>();\n\n  // Helper function to ensure strategy exists for a domain\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4818,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type UpsertUser, type Message, type InsertMessage, type JournalEntry, type InsertJournalEntry, type Conversation, type PersonalityInsight, type MemoryFact, type InsertMemoryFact, type MemoryFactMention, type InsertMemoryFactMention, type MemorySnapshot, type InsertMemorySnapshot, type MoodEntry, type InsertMoodEntry, type PersonalityReflection, type InsertPersonalityReflection, type UserSelectedCategory, type InsertUserSelectedCategory, type CategoryScore, type InsertCategoryScore, type CategoryInsight, type InsertCategoryInsight } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { db } from \"./db\";\nimport { users, conversations, messages, journalEntries, personalityInsights, memoryFacts, memoryFactMentions, memorySnapshots, moodEntries, personalityReflections, userSelectedCategories, categoryScores, categoryInsights } from \"@shared/schema\";\nimport { eq, desc, and, sql as drizzleSql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (required for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  \n  createConversation(userId: string): Promise<Conversation>;\n  getConversation(id: string): Promise<Conversation | undefined>;\n  getConversationsByUserId(userId: string): Promise<Conversation[]>;\n  \n  createMessage(message: InsertMessage): Promise<Message>;\n  getMessagesByConversationId(conversationId: string): Promise<Message[]>;\n  \n  createJournalEntry(entry: InsertJournalEntry & { userId: string }): Promise<JournalEntry>;\n  getJournalEntriesByUserId(userId: string): Promise<JournalEntry[]>;\n  updateJournalEntry(id: string, updates: Partial<InsertJournalEntry>): Promise<JournalEntry>;\n  deleteJournalEntry(id: string): Promise<void>;\n  \n  getPersonalityInsightsByUserId(userId: string): Promise<PersonalityInsight[]>;\n  createPersonalityInsight(insight: Omit<PersonalityInsight, \"id\" | \"createdAt\">): Promise<PersonalityInsight>;\n  \n  createMemoryFact(fact: InsertMemoryFact): Promise<MemoryFact>;\n  getMemoryFactsByUserId(userId: string, limit?: number): Promise<MemoryFact[]>;\n  updateMemoryFactConfidence(factId: string, confidence: number): Promise<void>;\n  \n  createMemoryFactMention(mention: InsertMemoryFactMention): Promise<MemoryFactMention>;\n  getMemoryFactMentionsByFactId(factId: string): Promise<MemoryFactMention[]>;\n  \n  createMemorySnapshot(snapshot: InsertMemorySnapshot): Promise<MemorySnapshot>;\n  getLatestMemorySnapshotByUserId(userId: string, snapshotType: string): Promise<MemorySnapshot | undefined>;\n  \n  createMoodEntry(entry: InsertMoodEntry & { userId: string }): Promise<MoodEntry>;\n  getMoodEntriesByUserId(userId: string): Promise<MoodEntry[]>;\n  \n  createPersonalityReflection(reflection: InsertPersonalityReflection & { userId: string }): Promise<PersonalityReflection>;\n  getLatestPersonalityReflection(userId: string): Promise<PersonalityReflection | undefined>;\n  getPersonalityReflection(id: string): Promise<PersonalityReflection | undefined>;\n  updatePersonalityReflection(id: string, updates: Partial<PersonalityReflection>): Promise<PersonalityReflection>;\n  getActivePersonalityReflection(userId: string): Promise<PersonalityReflection | undefined>;\n  \n  // Category tracking operations\n  selectCategory(data: InsertUserSelectedCategory): Promise<UserSelectedCategory>;\n  getUserSelectedCategories(userId: string): Promise<UserSelectedCategory[]>;\n  unselectCategory(userId: string, categoryId: string): Promise<void>;\n  \n  createCategoryScore(score: InsertCategoryScore): Promise<CategoryScore>;\n  getCategoryScores(userId: string, categoryId: string, periodType?: string, limit?: number): Promise<CategoryScore[]>;\n  getLatestCategoryScore(userId: string, categoryId: string, periodType: string): Promise<CategoryScore | undefined>;\n  \n  createCategoryInsight(insight: InsertCategoryInsight): Promise<CategoryInsight>;\n  getCategoryInsights(userId: string, categoryId: string, limit?: number): Promise<CategoryInsight[]>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private conversations: Map<string, Conversation>;\n  private messages: Map<string, Message>;\n  private journalEntries: Map<string, JournalEntry>;\n  private personalityInsights: Map<string, PersonalityInsight>;\n  private memoryFacts: Map<string, MemoryFact>;\n  private memoryFactMentions: Map<string, MemoryFactMention>;\n  private memorySnapshots: Map<string, MemorySnapshot>;\n\n  constructor() {\n    this.users = new Map();\n    this.conversations = new Map();\n    this.messages = new Map();\n    this.journalEntries = new Map();\n    this.personalityInsights = new Map();\n    this.memoryFacts = new Map();\n    this.memoryFactMentions = new Map();\n    this.memorySnapshots = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const existingUser = userData.id ? this.users.get(userData.id) : undefined;\n    const user: User = {\n      id: userData.id || randomUUID(),\n      email: userData.email || null,\n      firstName: userData.firstName || null,\n      lastName: userData.lastName || null,\n      profileImageUrl: userData.profileImageUrl || null,\n      createdAt: existingUser?.createdAt || new Date(),\n      updatedAt: new Date(),\n    };\n    this.users.set(user.id, user);\n    return user;\n  }\n\n  async createConversation(userId: string): Promise<Conversation> {\n    const id = randomUUID();\n    const conversation: Conversation = {\n      id,\n      userId,\n      createdAt: new Date()\n    };\n    this.conversations.set(id, conversation);\n    return conversation;\n  }\n\n  async getConversation(id: string): Promise<Conversation | undefined> {\n    return this.conversations.get(id);\n  }\n\n  async getConversationsByUserId(userId: string): Promise<Conversation[]> {\n    return Array.from(this.conversations.values()).filter(\n      (conv) => conv.userId === userId\n    );\n  }\n\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const id = randomUUID();\n    const message: Message = {\n      ...insertMessage,\n      id,\n      createdAt: new Date()\n    };\n    this.messages.set(id, message);\n    return message;\n  }\n\n  async getMessagesByConversationId(conversationId: string): Promise<Message[]> {\n    return Array.from(this.messages.values())\n      .filter((msg) => msg.conversationId === conversationId)\n      .sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n  }\n\n  async createJournalEntry(insertEntry: InsertJournalEntry & { userId: string }): Promise<JournalEntry> {\n    const id = randomUUID();\n    const entry: JournalEntry = {\n      id,\n      userId: insertEntry.userId,\n      content: insertEntry.content,\n      prompt: insertEntry.prompt ?? null,\n      wordCount: insertEntry.wordCount,\n      createdAt: new Date()\n    };\n    this.journalEntries.set(id, entry);\n    return entry;\n  }\n\n  async getJournalEntriesByUserId(userId: string): Promise<JournalEntry[]> {\n    return Array.from(this.journalEntries.values())\n      .filter((entry) => entry.userId === userId)\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async updateJournalEntry(id: string, updates: Partial<InsertJournalEntry>): Promise<JournalEntry> {\n    const existing = this.journalEntries.get(id);\n    if (!existing) {\n      throw new Error(\"Journal entry not found\");\n    }\n    const updated: JournalEntry = {\n      ...existing,\n      ...updates,\n      prompt: updates.prompt ?? existing.prompt,\n    };\n    this.journalEntries.set(id, updated);\n    return updated;\n  }\n\n  async deleteJournalEntry(id: string): Promise<void> {\n    this.journalEntries.delete(id);\n  }\n\n  async getPersonalityInsightsByUserId(userId: string): Promise<PersonalityInsight[]> {\n    return Array.from(this.personalityInsights.values())\n      .filter((insight) => insight.userId === userId)\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n  }\n\n  async createPersonalityInsight(insertInsight: Omit<PersonalityInsight, \"id\" | \"createdAt\">): Promise<PersonalityInsight> {\n    const id = randomUUID();\n    const insight: PersonalityInsight = {\n      ...insertInsight,\n      id,\n      createdAt: new Date()\n    };\n    this.personalityInsights.set(id, insight);\n    return insight;\n  }\n\n  async createMemoryFact(fact: InsertMemoryFact): Promise<MemoryFact> {\n    throw new Error(\"Memory facts not supported in MemStorage\");\n  }\n\n  async getMemoryFactsByUserId(userId: string, limit?: number): Promise<MemoryFact[]> {\n    return [];\n  }\n\n  async updateMemoryFactConfidence(factId: string, confidence: number): Promise<void> {\n    throw new Error(\"Memory facts not supported in MemStorage\");\n  }\n\n  async createMemoryFactMention(mention: InsertMemoryFactMention): Promise<MemoryFactMention> {\n    throw new Error(\"Memory fact mentions not supported in MemStorage\");\n  }\n\n  async getMemoryFactMentionsByFactId(factId: string): Promise<MemoryFactMention[]> {\n    return [];\n  }\n\n  async createMemorySnapshot(snapshot: InsertMemorySnapshot): Promise<MemorySnapshot> {\n    throw new Error(\"Memory snapshots not supported in MemStorage\");\n  }\n\n  async getLatestMemorySnapshotByUserId(userId: string, snapshotType: string): Promise<MemorySnapshot | undefined> {\n    return undefined;\n  }\n\n  async createMoodEntry(entry: InsertMoodEntry & { userId: string }): Promise<MoodEntry> {\n    throw new Error(\"Mood entries not supported in MemStorage\");\n  }\n\n  async getMoodEntriesByUserId(userId: string): Promise<MoodEntry[]> {\n    return [];\n  }\n\n  async createPersonalityReflection(reflection: InsertPersonalityReflection & { userId: string }): Promise<PersonalityReflection> {\n    throw new Error(\"Personality reflections not supported in MemStorage\");\n  }\n\n  async getLatestPersonalityReflection(userId: string): Promise<PersonalityReflection | undefined> {\n    return undefined;\n  }\n\n  async getPersonalityReflection(id: string): Promise<PersonalityReflection | undefined> {\n    return undefined;\n  }\n\n  async updatePersonalityReflection(id: string, updates: Partial<PersonalityReflection>): Promise<PersonalityReflection> {\n    throw new Error(\"Personality reflections not supported in MemStorage\");\n  }\n\n  async getActivePersonalityReflection(userId: string): Promise<PersonalityReflection | undefined> {\n    return undefined;\n  }\n\n  // Category tracking operations (not supported in MemStorage)\n  async selectCategory(data: InsertUserSelectedCategory): Promise<UserSelectedCategory> {\n    throw new Error(\"Category tracking not supported in MemStorage\");\n  }\n\n  async getUserSelectedCategories(userId: string): Promise<UserSelectedCategory[]> {\n    return [];\n  }\n\n  async unselectCategory(userId: string, categoryId: string): Promise<void> {\n    throw new Error(\"Category tracking not supported in MemStorage\");\n  }\n\n  async createCategoryScore(score: InsertCategoryScore): Promise<CategoryScore> {\n    throw new Error(\"Category tracking not supported in MemStorage\");\n  }\n\n  async getCategoryScores(userId: string, categoryId: string, periodType?: string, limit?: number): Promise<CategoryScore[]> {\n    return [];\n  }\n\n  async getLatestCategoryScore(userId: string, categoryId: string, periodType: string): Promise<CategoryScore | undefined> {\n    return undefined;\n  }\n\n  async createCategoryInsight(insight: InsertCategoryInsight): Promise<CategoryInsight> {\n    throw new Error(\"Category tracking not supported in MemStorage\");\n  }\n\n  async getCategoryInsights(userId: string, categoryId: string, limit?: number): Promise<CategoryInsight[]> {\n    return [];\n  }\n}\n\nexport class PostgresStorage implements IStorage {\n  // User operations (required for Replit Auth)\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async createConversation(userId: string): Promise<Conversation> {\n    const result = await db.insert(conversations).values({ userId }).returning();\n    return result[0];\n  }\n\n  async getConversation(id: string): Promise<Conversation | undefined> {\n    const result = await db.select().from(conversations).where(eq(conversations.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getConversationsByUserId(userId: string): Promise<Conversation[]> {\n    return await db.select().from(conversations)\n      .where(eq(conversations.userId, userId))\n      .orderBy(desc(conversations.createdAt));\n  }\n\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const result = await db.insert(messages).values(insertMessage).returning();\n    return result[0];\n  }\n\n  async getMessagesByConversationId(conversationId: string): Promise<Message[]> {\n    return await db.select().from(messages)\n      .where(eq(messages.conversationId, conversationId))\n      .orderBy(messages.createdAt);\n  }\n\n  async createJournalEntry(insertEntry: InsertJournalEntry & { userId: string }): Promise<JournalEntry> {\n    const result = await db.insert(journalEntries).values(insertEntry).returning();\n    return result[0];\n  }\n\n  async getJournalEntriesByUserId(userId: string): Promise<JournalEntry[]> {\n    return await db.select().from(journalEntries)\n      .where(eq(journalEntries.userId, userId))\n      .orderBy(desc(journalEntries.createdAt));\n  }\n\n  async updateJournalEntry(id: string, updates: Partial<InsertJournalEntry>): Promise<JournalEntry> {\n    const result = await db\n      .update(journalEntries)\n      .set(updates)\n      .where(eq(journalEntries.id, id))\n      .returning();\n    \n    if (!result[0]) {\n      throw new Error(\"Journal entry not found\");\n    }\n    return result[0];\n  }\n\n  async deleteJournalEntry(id: string): Promise<void> {\n    await db.delete(journalEntries).where(eq(journalEntries.id, id));\n  }\n\n  async getPersonalityInsightsByUserId(userId: string): Promise<PersonalityInsight[]> {\n    return await db.select().from(personalityInsights)\n      .where(eq(personalityInsights.userId, userId))\n      .orderBy(desc(personalityInsights.createdAt));\n  }\n\n  async createPersonalityInsight(insertInsight: Omit<PersonalityInsight, \"id\" | \"createdAt\">): Promise<PersonalityInsight> {\n    const result = await db.insert(personalityInsights).values(insertInsight).returning();\n    return result[0];\n  }\n\n  async createMemoryFact(insertFact: InsertMemoryFact): Promise<MemoryFact> {\n    const result = await db.insert(memoryFacts).values(insertFact).returning();\n    return result[0];\n  }\n\n  async getMemoryFactsByUserId(userId: string, limit: number = 100): Promise<MemoryFact[]> {\n    return await db.select().from(memoryFacts)\n      .where(and(\n        eq(memoryFacts.userId, userId),\n        eq(memoryFacts.status, 'active')\n      ))\n      .orderBy(desc(memoryFacts.confidence))\n      .limit(limit);\n  }\n\n  async updateMemoryFactConfidence(factId: string, confidence: number): Promise<void> {\n    await db\n      .update(memoryFacts)\n      .set({ \n        confidence,\n        updatedAt: drizzleSql`NOW()`\n      })\n      .where(eq(memoryFacts.id, factId));\n  }\n\n  async createMemoryFactMention(insertMention: InsertMemoryFactMention): Promise<MemoryFactMention> {\n    const result = await db.insert(memoryFactMentions).values(insertMention).returning();\n    return result[0];\n  }\n\n  async getMemoryFactMentionsByFactId(factId: string): Promise<MemoryFactMention[]> {\n    return await db.select().from(memoryFactMentions)\n      .where(eq(memoryFactMentions.factId, factId))\n      .orderBy(desc(memoryFactMentions.createdAt));\n  }\n\n  async createMemorySnapshot(insertSnapshot: InsertMemorySnapshot): Promise<MemorySnapshot> {\n    const result = await db.insert(memorySnapshots).values(insertSnapshot).returning();\n    return result[0];\n  }\n\n  async getLatestMemorySnapshotByUserId(userId: string, snapshotType: string): Promise<MemorySnapshot | undefined> {\n    const result = await db.select().from(memorySnapshots)\n      .where(and(\n        eq(memorySnapshots.userId, userId),\n        eq(memorySnapshots.snapshotType, snapshotType)\n      ))\n      .orderBy(desc(memorySnapshots.createdAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async createMoodEntry(entry: InsertMoodEntry & { userId: string }): Promise<MoodEntry> {\n    const result = await db.insert(moodEntries).values(entry).returning();\n    return result[0];\n  }\n\n  async getMoodEntriesByUserId(userId: string): Promise<MoodEntry[]> {\n    return await db.select().from(moodEntries)\n      .where(eq(moodEntries.userId, userId))\n      .orderBy(desc(moodEntries.createdAt));\n  }\n\n  async createPersonalityReflection(reflection: InsertPersonalityReflection & { userId: string }): Promise<PersonalityReflection> {\n    const result = await db.insert(personalityReflections).values(reflection).returning();\n    return result[0];\n  }\n\n  async getLatestPersonalityReflection(userId: string): Promise<PersonalityReflection | undefined> {\n    const result = await db.select().from(personalityReflections)\n      .where(eq(personalityReflections.userId, userId))\n      .orderBy(desc(personalityReflections.createdAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async getPersonalityReflection(id: string): Promise<PersonalityReflection | undefined> {\n    const result = await db.select().from(personalityReflections)\n      .where(eq(personalityReflections.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async updatePersonalityReflection(id: string, updates: Partial<PersonalityReflection>): Promise<PersonalityReflection> {\n    const result = await db\n      .update(personalityReflections)\n      .set(updates)\n      .where(eq(personalityReflections.id, id))\n      .returning();\n    \n    if (!result[0]) {\n      throw new Error(\"Personality reflection not found\");\n    }\n    return result[0];\n  }\n\n  async getActivePersonalityReflection(userId: string): Promise<PersonalityReflection | undefined> {\n    // Find any reflection that is still pending or processing\n    const result = await db.select().from(personalityReflections)\n      .where(and(\n        eq(personalityReflections.userId, userId),\n        drizzleSql`${personalityReflections.status} IN ('pending', 'processing')`\n      ))\n      .orderBy(desc(personalityReflections.createdAt))\n      .limit(1);\n    return result[0];\n  }\n\n  // Category tracking operations\n  async selectCategory(data: InsertUserSelectedCategory): Promise<UserSelectedCategory> {\n    const result = await db.insert(userSelectedCategories).values(data).returning();\n    return result[0];\n  }\n\n  async getUserSelectedCategories(userId: string): Promise<UserSelectedCategory[]> {\n    return await db.select().from(userSelectedCategories)\n      .where(and(\n        eq(userSelectedCategories.userId, userId),\n        eq(userSelectedCategories.status, 'active')\n      ))\n      .orderBy(userSelectedCategories.startedAt);\n  }\n\n  async unselectCategory(userId: string, categoryId: string): Promise<void> {\n    await db\n      .update(userSelectedCategories)\n      .set({ status: 'inactive', pausedAt: new Date() })\n      .where(and(\n        eq(userSelectedCategories.userId, userId),\n        eq(userSelectedCategories.categoryId, categoryId)\n      ));\n  }\n\n  async createCategoryScore(score: InsertCategoryScore): Promise<CategoryScore> {\n    const result = await db.insert(categoryScores).values(score).returning();\n    return result[0];\n  }\n\n  async getCategoryScores(\n    userId: string,\n    categoryId: string,\n    periodType?: string,\n    limit: number = 30\n  ): Promise<CategoryScore[]> {\n    const conditions = [\n      eq(categoryScores.userId, userId),\n      eq(categoryScores.categoryId, categoryId)\n    ];\n\n    if (periodType) {\n      conditions.push(eq(categoryScores.periodType, periodType));\n    }\n\n    return await db.select().from(categoryScores)\n      .where(and(...conditions))\n      .orderBy(desc(categoryScores.periodStart))\n      .limit(limit);\n  }\n\n  async getLatestCategoryScore(\n    userId: string,\n    categoryId: string,\n    periodType: string\n  ): Promise<CategoryScore | undefined> {\n    const result = await db.select().from(categoryScores)\n      .where(and(\n        eq(categoryScores.userId, userId),\n        eq(categoryScores.categoryId, categoryId),\n        eq(categoryScores.periodType, periodType)\n      ))\n      .orderBy(desc(categoryScores.periodStart))\n      .limit(1);\n    return result[0];\n  }\n\n  async createCategoryInsight(insight: InsertCategoryInsight): Promise<CategoryInsight> {\n    const result = await db.insert(categoryInsights).values(insight).returning();\n    return result[0];\n  }\n\n  async getCategoryInsights(\n    userId: string,\n    categoryId: string,\n    limit: number = 10\n  ): Promise<CategoryInsight[]> {\n    return await db.select().from(categoryInsights)\n      .where(and(\n        eq(categoryInsights.userId, userId),\n        eq(categoryInsights.categoryId, categoryId)\n      ))\n      .orderBy(desc(categoryInsights.createdAt))\n      .limit(limit);\n  }\n}\n\nexport const storage = new PostgresStorage();\n","path":null,"size_bytes":21252,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { HeroSection } from \"@/components/HeroSection\";\nimport { FeaturesSection } from \"@/components/FeaturesSection\";\nimport { HowItWorksSection } from \"@/components/HowItWorksSection\";\nimport { PersonalityPreviewSection } from \"@/components/PersonalityPreviewSection\";\nimport { TestimonialsSection } from \"@/components/TestimonialsSection\";\nimport { CTASection } from \"@/components/CTASection\";\nimport { Footer } from \"@/components/Footer\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { LogOut } from \"lucide-react\";\nimport { Logo } from \"@/components/Logo\";\n\nexport default function Home() {\n  return (\n    <div className=\"min-h-screen\">\n      <header className=\"fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between\">\n          <Logo size=\"sm\" />\n          <div className=\"flex items-center gap-1 sm:gap-2\">\n            <ThemeToggle />\n            <Link href=\"/dashboard\">\n              <Button variant=\"default\" size=\"sm\" className=\"sm:size-default\" data-testid=\"button-enter-app\">\n                Enter App\n              </Button>\n            </Link>\n            <Button variant=\"ghost\" size=\"icon\" asChild data-testid=\"button-logout\">\n              <a href=\"/api/logout\" title=\"Sign Out\">\n                <LogOut className=\"w-4 h-4\" />\n              </a>\n            </Button>\n          </div>\n        </div>\n      </header>\n      \n      <main className=\"pt-16\">\n        <HeroSection />\n        <FeaturesSection />\n        <HowItWorksSection />\n        <PersonalityPreviewSection />\n        <TestimonialsSection />\n        <CTASection />\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":1826,"size_tokens":null},"client/src/components/PersonalityPreviewSection.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RadarChart, PolarGrid, PolarAngleAxis, Radar, ResponsiveContainer } from \"recharts\";\nimport analysisImage from \"@assets/generated_images/Analysis_process_illustration_571ba544.png\";\nimport { AlertCircle, TrendingUp } from \"lucide-react\";\n\nconst personalityData = [\n  { trait: \"Openness\", value: 85 },\n  { trait: \"Conscientiousness\", value: 72 },\n  { trait: \"Extraversion\", value: 45 },\n  { trait: \"Agreeableness\", value: 68 },\n  { trait: \"Emotional Stability\", value: 55 },\n];\n\nexport function PersonalityPreviewSection() {\n  return (\n    <section className=\"py-20 px-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"text-center mb-12\">\n          <p className=\"text-2xl md:text-3xl font-medium italic text-muted-foreground mb-4\">\n            \"The truth will set you free\"\n          </p>\n          <p className=\"text-lg text-muted-foreground\">\n            Experience honest, data-driven insights about your personality\n          </p>\n        </div>\n        \n        <div className=\"grid lg:grid-cols-2 gap-8 items-center mb-12\">\n          <Card data-testid=\"card-personality-chart\">\n            <CardHeader>\n              <CardTitle>Your Personality Profile</CardTitle>\n              <CardDescription>Multi-dimensional trait analysis</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <RadarChart data={personalityData}>\n                  <PolarGrid />\n                  <PolarAngleAxis dataKey=\"trait\" />\n                  <Radar\n                    name=\"Traits\"\n                    dataKey=\"value\"\n                    stroke=\"hsl(var(--primary))\"\n                    fill=\"hsl(var(--primary))\"\n                    fillOpacity={0.3}\n                  />\n                </RadarChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n          \n          <div className=\"space-y-6\">\n            <Card className=\"border-l-4 border-l-destructive\" data-testid=\"card-blind-spot\">\n              <CardHeader className=\"flex flex-row items-start gap-4 space-y-0\">\n                <div className=\"h-10 w-10 rounded-lg bg-destructive/10 flex items-center justify-center flex-shrink-0\">\n                  <AlertCircle className=\"h-5 w-5 text-destructive\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <CardTitle className=\"text-lg\">Blind Spot Detected</CardTitle>\n                    <Badge variant=\"destructive\" className=\"text-xs\">High Priority</Badge>\n                  </div>\n                  <CardDescription className=\"text-base\">\n                    Your communication style shows a pattern of avoiding conflict, which may prevent genuine connection in relationships. Consider addressing disagreements directly.\n                  </CardDescription>\n                </div>\n              </CardHeader>\n            </Card>\n            \n            <Card className=\"border-l-4 border-l-primary\" data-testid=\"card-growth-opportunity\">\n              <CardHeader className=\"flex flex-row items-start gap-4 space-y-0\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <TrendingUp className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <CardTitle className=\"text-lg\">Growth Opportunity</CardTitle>\n                    <Badge className=\"text-xs\">Actionable</Badge>\n                  </div>\n                  <CardDescription className=\"text-base\">\n                    Your high openness score suggests untapped creative potential. Dedicate time to exploring new artistic or intellectual pursuits.\n                  </CardDescription>\n                </div>\n              </CardHeader>\n            </Card>\n          </div>\n        </div>\n        \n        <div className=\"flex justify-center\">\n          <img \n            src={analysisImage} \n            alt=\"AI analysis process\" \n            className=\"max-w-md w-full rounded-lg opacity-80\"\n          />\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/DashboardNav.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ThemeToggle } from \"./ThemeToggle\";\nimport { Home, MessageSquare, BookOpen, BarChart3, Brain, User, Menu, X, Heart } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Logo } from \"./Logo\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\n\nconst navItems = [\n  { path: \"/dashboard\", label: \"Dashboard\", icon: Home },\n  { path: \"/chat\", label: \"Chat\", icon: MessageSquare },\n  { path: \"/journal\", label: \"Journal\", icon: BookOpen },\n  { path: \"/mood\", label: \"Mood\", icon: Heart },\n  { path: \"/insights\", label: \"Insights\", icon: BarChart3 },\n  { path: \"/reflection\", label: \"Reflection\", icon: Brain },\n  { path: \"/profile\", label: \"Profile\", icon: User },\n];\n\nexport function DashboardNav() {\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  \n  return (\n    <nav className=\"border-b sticky top-0 z-50 bg-background\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4\">\n        <div className=\"flex items-center justify-between gap-2 sm:gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n              <SheetTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"md:hidden\"\n                  data-testid=\"button-mobile-menu\"\n                >\n                  <Menu className=\"h-5 w-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"w-64\">\n                <SheetHeader className=\"mb-6\">\n                  <SheetTitle>\n                    <Logo size=\"sm\" showText />\n                  </SheetTitle>\n                </SheetHeader>\n                <div className=\"flex flex-col gap-2\">\n                  {navItems.map((item) => {\n                    const Icon = item.icon;\n                    const isActive = location === item.path;\n                    return (\n                      <Link key={item.path} href={item.path}>\n                        <Button\n                          variant={isActive ? \"secondary\" : \"ghost\"}\n                          className=\"w-full justify-start gap-3\"\n                          onClick={() => setMobileMenuOpen(false)}\n                          data-testid={`button-mobile-nav-${item.label.toLowerCase()}`}\n                        >\n                          <Icon className=\"h-5 w-5\" />\n                          {item.label}\n                        </Button>\n                      </Link>\n                    );\n                  })}\n                </div>\n              </SheetContent>\n            </Sheet>\n            \n            <Link href=\"/dashboard\" data-testid=\"link-logo\">\n              <Logo size=\"sm\" />\n            </Link>\n          </div>\n          \n          <div className=\"hidden md:flex items-center gap-2\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path}>\n                  <Button\n                    variant={isActive ? \"secondary\" : \"ghost\"}\n                    className=\"gap-2\"\n                    data-testid={`button-nav-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-4 w-4\" />\n                    {item.label}\n                  </Button>\n                </Link>\n              );\n            })}\n          </div>\n          \n          <div className=\"flex items-center gap-1 sm:gap-2\">\n            <ThemeToggle />\n            <Avatar data-testid=\"avatar-user\" className=\"h-8 w-8 sm:h-10 sm:w-10\">\n              <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-xs sm:text-sm\">\n                JD\n              </AvatarFallback>\n            </Avatar>\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":4139,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/examples/CTASection.tsx":{"content":"import { CTASection } from '../CTASection';\n\nexport default function CTASectionExample() {\n  return <CTASection />;\n}\n","path":null,"size_bytes":118,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"replit.md":{"content":"# Mirror - AI Personality Analyzer\n\n## Overview\nMirror is an AI-powered personality analysis application that provides deep insights into user personality through conversations and journal entries. Its core purpose is to uncover personality traits, blind spots, and growth opportunities via comprehensive AI analysis, ultimately empowering users with self-awareness and personal growth.\n\n## User Preferences\nI want iterative development.\nAsk before making major changes.\nI prefer detailed explanations.\nDo not make changes to the folder `Z`.\nDo not make changes to the file `Y`.\n\n## System Architecture\nMirror employs a modern web stack focused on AI-driven personality analysis, user experience, and robust data management.\n\n### UI/UX Decisions\nThe design utilizes React, TypeScript, Tailwind CSS, and Shadcn UI for a professional and consistent aesthetic. Branding is reinforced with a custom Chakrai logo. The application is fully responsive, optimized for all devices, and designed to foster trust, encourage self-reflection, provide actionable insights, and balance empathy with direct truth-telling.\n\n### Technical Implementations\n- **Frontend**: React and TypeScript.\n- **Backend**: Express.js with TypeScript for API handling.\n- **Database**: PostgreSQL via Neon Serverless, managed with Drizzle ORM for type-safe queries and migrations.\n- **State Management**: TanStack Query for data fetching and caching.\n- **Authentication**: Multi-user authentication via Replit Auth (OpenID Connect) with PostgreSQL-backed sessions and per-user data isolation.\n- **AI Memory System**: GPT-4o asynchronously extracts, stores, and deduplicates facts from user interactions into a PostgreSQL memory system, injecting them into prompts for personalized responses.\n- **Speech Integration**: Web Speech API for Speech-to-Text (STT) and Eleven Labs for high-quality Text-to-Speech (TTS), including advanced text processing to remove markdown and analytical labels. TTS is implemented for individual sections and journal entries.\n- **Conversation Management**: Persistent conversation history stored in PostgreSQL, with a three-tier loading priority and a \"New Chat\" option.\n- **Journal Management**: Features for saving, editing, and deleting journal entries with ownership verification and AI analysis triggers.\n- **Tiered Personality Analysis**: Uses professional psychological frameworks (Schema Therapy, IFS, Attachment Theory, etc.) with three tiers:\n  - **Free Tier**: 2 sections (Behavioral Patterns, Growth Areas) - basic insights\n  - **Standard Tier**: 6 sections (adds Emotional Patterns, Relationship Dynamics, Strengths, Blind Spots) - deep dive analysis\n  - **Premium Tier**: 9 sections (all Standard + Coping Mechanisms, Values & Beliefs, Therapeutic Insights) + Holy Shit Moment + Growth Leverage Point - devastating truth\n- **Multi-Pass Generation System**: Instead of single monolithic AI call, generates each of the 9 sections separately with focused prompts. Each section gets 8-12 insights using section-specific analytical formats (e.g., Behavioral Patterns use [TRIGGER] → [ACTION] → [CONSEQUENCE] format). **Sections are generated sequentially** (not parallel) to avoid OpenAI rate limits on free tier accounts (30k tokens/min). Premium tier includes final \"Holy Shit Moment\" synthesis.\n- **Senior AI Quality Controls** (Complete Formula Implementation): Each section uses an \"unforgiving, world-class personality analyst\" system message with strict analytical principles:\n  - **Persona Enforcement**: \"If you have nothing new or deep to say, you say 'Insufficient data for meaningful analysis' rather than bullshit\"\n  - **Triangulation Mandatory**: Every insight must cite evidence from 2+ data sources\n  - **Inference Over Echoing**: Go 2 inferential steps deeper than surface observations\n  - **Contradiction Detection**: Ruthlessly expose gaps between stated vs. actual behavior\n  - **Anti-Echo Guardrails**: Forbidden phrases list prevents therapeutic clichés\n  - **Two-Step Chain-of-Thought**: First pass generates analysis, second pass (senior clinical supervisor) critiques and rewrites with mandatory rejection criteria\n  - **Few-Shot Examples**: 6 devastating analysis examples integrated into every section prompt to raise quality floor\n  - **Jaccard Similarity**: Automatically removes duplicate insights (>60% overlap) within each section\n  - **Quality Threshold**: Every insight must make user think \"holy shit, how did you know that?\" or be explicitly marked \"Insufficient depth\"\n- **AI Configuration**: GPT-4o with temperature 0.8-0.9 for analysis, temperature 0.3 for fact extraction, top_p 0.95, presence_penalty 0.2, frequency_penalty 0.8, max tokens 3000 per section, structured JSON output.\n- **Multi-Level Memory System**: Extracts facts at 4 abstraction levels (raw_fact, inferred_belief, defense_mechanism, ifs_part) with deterministic temperature 0.3\n- **Category Tracking**: Allows users to select improvement categories with tier-based limits, goal tracking, and AI-generated scores and insights.\n\n### Feature Specifications\n- **AI Chat Interface**: Direct AI personality analyst with conversation history, STT, and TTS.\n- **Digital Journal**: Private journaling with prompts and AI analysis.\n- **Personality Dashboard**: Displays live stats, AI-analyzed traits, patterns, blind spots, and growth opportunities.\n- **Memory System**: GPT-4o-powered fact extraction for personalized AI context.\n- **Comprehensive Intake Assessment**: A 5-step guided questionnaire to personalize insights.\n\n### System Design Choices\nThe system enforces strict per-user data isolation for all sensitive information. AI analysis prioritizes \"holy shit\" revelations over surface-level observations by integrating diverse psychological frameworks and employing sophisticated anti-echo and duplicate detection mechanisms. Category tracking provides targeted self-improvement with AI-powered scoring and trend visualization.\n\n## External Dependencies\n- **AI Service**: OpenAI GPT-4o (direct API via user's OPENAI_API_KEY - bypasses Azure content filtering)\n- **Database**: PostgreSQL (via Neon Serverless)\n- **Text-to-Speech**: Eleven Labs\n- **Authentication**: Replit Auth (OpenID Connect)\n- **Frontend Framework**: React\n- **Styling**: Tailwind CSS, Shadcn UI\n- **Backend Framework**: Express.js\n- **ORM**: Drizzle ORM\n- **State Management**: TanStack Query (React Query)\n\n## Recent Changes\n\n### November 23, 2025 - Direct OpenAI API Integration & Unfiltered Prompts\n- **Switched to direct OpenAI API**: All OpenAI clients (routes.ts, memory-service.ts, comprehensive-analytics.ts, category-scoring.ts) now prioritize user's OPENAI_API_KEY over Replit's Azure-filtered AI_INTEGRATIONS_OPENAI_API_KEY\n- **Removed Azure content filtering**: Bypasses Azure OpenAI's strict content policy that blocked \"brutal/devastating/ruthless\" language in prompts\n- **Restored original brutal prompts**: Multi-pass system messages reverted from softened \"experienced clinical\" language back to \"unforgiving, world-class personality analyst\" with \"uncomfortable truths\", \"ruthless contradiction detection\", and \"devastating accuracy\"\n- **Fixed JSON parsing bugs**: Added robust markdown stripping in memory-service.ts and comprehensive-analytics.ts to handle GPT-4o wrapping JSON in ```json code blocks (prevents SyntaxError during fact extraction)\n- **Trade-off accepted**: User pays directly for OpenAI API usage (~$0.01-0.03 per analysis) in exchange for complete control over prompt content without corporate filtering\n- **Anti-word-salad rules preserved**: Max 2 hyphens per insight, clear sentence structure, no jargon stacking - maintained regardless of API source\n\n### November 24, 2025 - Rate Limit Fix & Sequential Generation\n- **Critical bug fix: Parallel generation caused rate limit cascade**:\n  - Problem: Generating 9 sections in parallel (~18k tokens each) instantly exceeded OpenAI's 30k tokens/min limit on free tier\n  - All sections were falling back to weak simplified prompts, producing generic/surface-level analysis\n  - Blind spots and other sections were failing completely (returning fallback messages)\n- **Switched to sequential generation**:\n  - Sections now generate one at a time with 1-second delays between each\n  - Full two-pass brutal prompt system now works correctly without rate limits\n  - Trade-off: Slower (~5-7 minutes) but much higher quality analysis\n- **Reduced token usage for rate limit compliance**:\n  - Reduced context from 100 messages → 50 messages\n  - Reduced from 20 journals → 10 journals  \n  - Truncated long messages to 500 chars, journals to 800 chars\n  - Fits within 30k tokens/min rate limit\n- **Improved OpenAI error handling**:\n  - Quota exceeded errors (429) now properly detected and displayed with helpful instructions\n  - Frontend shows specific \"OpenAI API Quota Exceeded\" message with links to billing/usage pages\n  - No longer misreports quota errors as \"not enough data\"\n- **Enhanced simplified prompt (fallback quality)**:\n  - Simplified prompt now includes full brutal tone requirements\n  - Forbidden phrases list prevents therapy clichés even on retry path\n  - \"Pathologist reading autopsy report\" tone enforced at all prompt levels\n\n### November 24, 2025 - Retry Logic & Brutal Tone Enforcement\n- **Rolled back citation enforcement system**: Removed citation handles and cross-source triangulation requirements that broke GPT-4o and produced surface-level analysis\n- **Implemented retry logic with simplified prompts**:\n  - Created `generateSectionWithRetry()` wrapper (max 2 attempts per section)\n  - First attempt uses full two-pass prompt system\n  - Second attempt (if needed) uses `generateSectionSimplified()` with trimmed context (conversations 3k, journals 2k, moods 1k, facts 2k chars)\n  - Simplified prompt demands exactly 8 insights with brutal tone, single-pass generation for speed\n  - Fallback messages prevent blank sections: \"Analysis unavailable - [reason]\" if all attempts fail\n  - Comprehensive logging: retry attempts, reasons, success/failure rates\n- **Enhanced brutal tone requirements**:\n  - Added explicit \"TONE REQUIREMENTS\" section to system message forbidding ALL hedging (\"might,\" \"perhaps\"), softening (\"understandable,\" \"many people\"), and reassurance language\n  - Changed goal from \"holy shit moments\" to \"devastating truths like a clinical diagnostician delivering findings\"\n  - Added instruction: \"State facts like a pathologist reading an autopsy report: direct, clinical, unflinching\"\n  - Supervisor prompt: Added \"TONE CHECK\" as mandatory #1 criterion with ZERO tolerance for polite/therapy language\n  - Supervisor enforces \"devastating truth\" standard instead of comfortable therapy speak\n- **Quality improvements**:\n  - Sections never render blank (fallback messages ensure visibility)\n  - Retry system addresses JSON parsing failures and under-delivered sections\n  - Brutal tone enforcement tackles \"AI being polite\" complaints\n  - Maintained anti-word-salad rules (max 2 hyphens, clear sentences, no jargon stacking)\n\n### November 23, 2025 - Mood Tracking UI & Message Count Display\n- **Added complete mood tracking interface**: Created Mood page (client/src/pages/Mood.tsx) with MoodInterface component for logging moods with intensity, activities, and notes\n- **Fixed mood intensity slider scale**: Changed from incorrect 1-10 scale to proper 0-100 scale matching database schema (min=0, max=100, step=5)\n- **Enhanced stats display**: Personality reflection stats now show \"X total (Y messages)\" format for clarity instead of just conversation count\n- **Fixed loading state**: Removed premature \"0 messages\" display during personality reflection generation, now shows generic \"Analyzing...\" message\n- **Mood entry persistence**: Fully functional POST /api/mood-entries endpoint creates mood entries with correct user_id isolation\n- **Navigation integration**: Added Mood link to DashboardNav for easy access\n\n### November 23, 2025 - Multi-Pass Tiered Analysis System with Senior AI Quality Controls\n- Implemented three-tier personality analysis pricing model (Free/$0, Standard/$9, Premium/$29)\n- Replaced single-pass AI generation with multi-pass system (9 separate focused calls per section)\n- Added tier field to personalityReflections database schema\n- Created TIER_CONFIG defining which sections are included at each tier\n- Built tier selection UI with pricing cards, feature comparison, and upgrade dialog\n- Sections generated in parallel for speed, each with 8-12 evidence-based insights\n- Premium tier includes \"Holy Shit Moment\" - devastating synthesis of all patterns\n- All non-included sections initialized to empty arrays to satisfy NOT NULL constraints\n- **Integrated senior AI quality controls**: Each section now uses the same rigorous system message as the legacy implementation with anti-echo guardrails, contradiction detection, and forbidden phrases\n- **Added Jaccard similarity duplicate detection**: Automatically removes insights with >60% overlap within each section AND across sections\n- **Frequency penalty 0.8**: Prevents AI from repeating similar patterns across insights\n- **Type safety improvements**: Added validation to handle non-string AI responses gracefully, preventing crashes during deduplication","path":null,"size_bytes":13254,"size_tokens":null},"client/src/components/examples/TestimonialsSection.tsx":{"content":"import { TestimonialsSection } from '../TestimonialsSection';\n\nexport default function TestimonialsSectionExample() {\n  return <TestimonialsSection />;\n}\n","path":null,"size_bytes":154,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/TestimonialsSection.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Star } from \"lucide-react\";\n\nconst testimonials = [\n  {\n    name: \"Sarah Chen\",\n    initials: \"SC\",\n    role: \"Product Designer\",\n    text: \"Mirror showed me patterns I'd been blind to for years. The AI insights about my conflict avoidance were uncomfortable but transformative. I'm now having more honest conversations.\",\n    rating: 5\n  },\n  {\n    name: \"Marcus Johnson\",\n    initials: \"MJ\",\n    role: \"Entrepreneur\",\n    text: \"I thought I knew myself well. This app proved me wrong in the best way. The personality analysis revealed blind spots affecting my leadership. Game-changing.\",\n    rating: 5\n  },\n  {\n    name: \"Elena Rodriguez\",\n    initials: \"ER\",\n    role: \"Therapist\",\n    text: \"As a professional, I'm impressed by the depth of analysis. The combination of journaling, conversations, and assessments creates remarkably accurate insights.\",\n    rating: 5\n  },\n  {\n    name: \"David Kim\",\n    initials: \"DK\",\n    role: \"Software Engineer\",\n    text: \"The data-driven approach appealed to me. Seeing my personality traits visualized and tracked over time helped me understand my growth objectively.\",\n    rating: 5\n  }\n];\n\nexport function TestimonialsSection() {\n  return (\n    <section className=\"py-20 px-6 bg-muted/30\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"text-center mb-16\">\n          <h2 className=\"text-3xl md:text-4xl font-semibold mb-4\">\n            Transformation Stories\n          </h2>\n          <p className=\"text-lg text-muted-foreground\">\n            Real people, real insights, real growth\n          </p>\n        </div>\n        \n        <div className=\"grid md:grid-cols-2 gap-6\">\n          {testimonials.map((testimonial, index) => (\n            <Card key={index} data-testid={`card-testimonial-${index}`}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex gap-1 mb-4\">\n                  {Array.from({ length: testimonial.rating }).map((_, i) => (\n                    <Star key={i} className=\"h-4 w-4 fill-primary text-primary\" />\n                  ))}\n                </div>\n                <p className=\"text-base mb-6 leading-relaxed\">\"{testimonial.text}\"</p>\n                <div className=\"flex items-center gap-3\">\n                  <Avatar data-testid={`avatar-${index}`}>\n                    <AvatarFallback className=\"bg-primary/10 text-primary font-semibold\">\n                      {testimonial.initials}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <p className=\"font-semibold\" data-testid={`text-name-${index}`}>{testimonial.name}</p>\n                    <p className=\"text-sm text-muted-foreground\">{testimonial.role}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":2985,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":2210,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/examples/HowItWorksSection.tsx":{"content":"import { HowItWorksSection } from '../HowItWorksSection';\n\nexport default function HowItWorksSectionExample() {\n  return <HowItWorksSection />;\n}\n","path":null,"size_bytes":146,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/examples/PersonalityPreviewSection.tsx":{"content":"import { PersonalityPreviewSection } from '../PersonalityPreviewSection';\n\nexport default function PersonalityPreviewSectionExample() {\n  return <PersonalityPreviewSection />;\n}\n","path":null,"size_bytes":178,"size_tokens":null},"server/memory-service.ts":{"content":"import OpenAI from \"openai\";\nimport { storage } from \"./storage\";\nimport type { Message, JournalEntry } from \"@shared/schema\";\n\n// Prioritize direct OPENAI_API_KEY for unfiltered access\nconst apiKey = process.env.OPENAI_API_KEY ?? process.env.AI_INTEGRATIONS_OPENAI_API_KEY;\nconst openai = new OpenAI({\n  apiKey,\n  // Only use baseURL if using Replit integration\n  baseURL: process.env.OPENAI_API_KEY ? undefined : process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\ninterface ExtractedFact {\n  fact: string;\n  category: string;\n  abstractionLevel: 'raw_fact' | 'inferred_belief' | 'defense_mechanism' | 'ifs_part';\n  confidence: number;\n  timeContext?: string;\n  emotionalTone?: string;\n}\n\nexport class MemoryService {\n  async extractFactsFromMessages(userId: string, messages: Message[]): Promise<void> {\n    if (messages.length === 0) return;\n\n    const conversationText = messages\n      .map(m => `${m.role === \"user\" ? \"User\" : \"Assistant\"}: ${m.content}`)\n      .join(\"\\n\");\n\n    const facts = await this.extractFacts(conversationText, \"conversation\");\n    \n    for (const extractedFact of facts) {\n      await this.storeFact(userId, extractedFact, \"message\", messages[messages.length - 1].id, messages[messages.length - 1].content);\n    }\n  }\n\n  async extractFactsFromJournal(userId: string, entry: JournalEntry): Promise<void> {\n    const facts = await this.extractFacts(entry.content, \"journal\");\n    \n    for (const extractedFact of facts) {\n      await this.storeFact(userId, extractedFact, \"journal\", entry.id, entry.content);\n    }\n  }\n\n  private async extractFacts(text: string, sourceType: string): Promise<ExtractedFact[]> {\n    try {\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: `You are a multi-level memory extraction AI with expertise in clinical psychology. Extract information about the user at FOUR abstraction levels from their ${sourceType}.\n\n**ABSTRACTION LEVELS:**\n\n1. **raw_fact** - Observable, concrete facts they explicitly stated\n   Examples:\n   - \"Lives in Seattle\"\n   - \"Works as a software engineer\"\n   - \"Has a sister named Sarah\"\n\n2. **inferred_belief** - Implicit beliefs inferred from their statements/behaviors\n   Examples:\n   - \"Believes love must be earned through perfection\" (inferred from pattern of overachieving before asking for help)\n   - \"Assumes conflict = rejection\" (inferred from avoidance of disagreements)\n   - \"Feels fundamentally unworthy\" (inferred from self-sabotage pattern before success)\n\n3. **defense_mechanism** - Psychological defenses they employ\n   Examples:\n   - \"Uses intellectualization when discussing emotional trauma\" (shifts to abstract analysis)\n   - \"Employs projection - accuses others of being 'too sensitive' when own emotions are triggered\"\n   - \"Rationalization defense - justifies people-pleasing as 'just being considerate'\"\n\n4. **ifs_part** - Internal Family Systems \"parts\" identifiable in their psyche\n   Examples:\n   - \"The Perfectionist Manager part - demands flawless performance to prevent abandonment\"\n   - \"The Wounded 8-year-old exile - holds shame from childhood criticism\"\n   - \"The Intellectual Firefighter - uses analysis to extinguish emotional overwhelm\"\n\n**CATEGORIES** (same for all levels):\n- personal_info: Demographics, background, life situation\n- relationships: Family, friends, social connections\n- work_career: Job, career, professional life\n- goals_aspirations: What they want to achieve\n- challenges_struggles: Problems they're facing\n- patterns_behaviors: Recurring behaviors or habits\n- values_beliefs: What matters to them, core beliefs\n- emotions_wellbeing: Emotional state, mental health, defenses\n\n**EXTRACTION RULES:**\n- Extract 8-15 total facts across ALL four abstraction levels\n- Prioritize deeper levels (inferred_belief, defense_mechanism, ifs_part) over surface raw_facts\n- Each fact must be SPECIFIC to this individual - avoid generic psychology\n- For ifs_part: Name the part, describe its strategy, and what it protects\n- For defense_mechanism: Name the mechanism (projection, denial, intellectualization, etc.)\n- For inferred_belief: Connect to behavioral evidence\n\nReturn ONLY a JSON array with this structure:\n[{\n  \"fact\": \"string (the extracted fact/belief/defense/part)\",\n  \"category\": \"string (one of the categories above)\",\n  \"abstractionLevel\": \"raw_fact\" | \"inferred_belief\" | \"defense_mechanism\" | \"ifs_part\",\n  \"confidence\": number (0-100),\n  \"timeContext\": \"string or null\",\n  \"emotionalTone\": \"string\"\n}]\n\nPrioritize quality over quantity. Go deep.`\n          },\n          {\n            role: \"user\",\n            content: text\n          }\n        ],\n        temperature: 0.3,  // Deterministic for fact extraction (per formula)\n        max_tokens: 2000,  // More tokens for multi-level extraction\n        top_p: 0.95,\n        presence_penalty: 0.2,\n        frequency_penalty: 0.8,\n        response_format: { type: \"json_object\" }  // Force valid JSON output\n      });\n\n      let response = completion.choices[0].message.content || \"[]\";\n      \n      // DEBUG: Log raw response to diagnose parse errors\n      console.log('[MEMORY-SERVICE] Raw GPT response (first 500 chars):', response.substring(0, 500));\n      \n      // ROBUST: Strip markdown code blocks if GPT wraps JSON (common with GPT-4o)\n      response = response.trim();\n      if (response.startsWith('```')) {\n        // Remove ```json or ``` opening and closing markers\n        response = response.replace(/^```(?:json)?\\s*\\n?/i, '').replace(/\\n?```\\s*$/i, '').trim();\n      }\n      \n      // Additional cleanup: remove any remaining non-JSON text before/after\n      const jsonStart = response.indexOf('[');\n      const jsonEnd = response.lastIndexOf(']');\n      if (jsonStart >= 0 && jsonEnd > jsonStart) {\n        response = response.substring(jsonStart, jsonEnd + 1);\n      }\n      \n      console.log('[MEMORY-SERVICE] Cleaned response (first 500 chars):', response.substring(0, 500));\n      \n      const facts = JSON.parse(response);\n      \n      return Array.isArray(facts) ? facts : [];\n    } catch (error) {\n      console.error(\"Error extracting facts:\", error);\n      return [];\n    }\n  }\n\n  private async storeFact(\n    userId: string,\n    extractedFact: ExtractedFact,\n    sourceType: string,\n    sourceId: string,\n    evidenceExcerpt: string\n  ): Promise<void> {\n    try {\n      // Defensive: Skip if extracted fact is invalid\n      if (!extractedFact || !extractedFact.fact || typeof extractedFact.fact !== 'string') {\n        console.warn('Skipping invalid extracted fact:', extractedFact);\n        return;\n      }\n      \n      const existingFacts = await storage.getMemoryFactsByUserId(userId);\n      \n      const similarFact = existingFacts.find(\n        f => this.calculateSimilarity(f.factContent, extractedFact.fact) > 0.8\n      );\n\n      if (similarFact) {\n        const newConfidence = Math.min(100, similarFact.confidence + 5);\n        await storage.updateMemoryFactConfidence(similarFact.id, newConfidence);\n        \n        await storage.createMemoryFactMention({\n          factId: similarFact.id,\n          sourceType,\n          sourceId,\n          evidenceExcerpt: evidenceExcerpt.substring(0, 500)\n        });\n      } else {\n        const fact = await storage.createMemoryFact({\n          userId,\n          factContent: extractedFact.fact,\n          category: extractedFact.category,\n          abstractionLevel: extractedFact.abstractionLevel,\n          confidence: extractedFact.confidence,\n          timeContext: extractedFact.timeContext || null,\n          emotionalTone: extractedFact.emotionalTone || null,\n          status: 'active'\n        });\n\n        await storage.createMemoryFactMention({\n          factId: fact.id,\n          sourceType,\n          sourceId,\n          evidenceExcerpt: evidenceExcerpt.substring(0, 500)\n        });\n      }\n    } catch (error) {\n      console.error(\"Error storing fact:\", error);\n    }\n  }\n\n  private calculateSimilarity(text1: string, text2: string): number {\n    // Defensive: Guard against undefined/null inputs\n    if (!text1 || !text2 || typeof text1 !== 'string' || typeof text2 !== 'string') {\n      return 0;\n    }\n    \n    const words1 = text1.toLowerCase().split(/\\s+/);\n    const words2 = text2.toLowerCase().split(/\\s+/);\n    const set1 = new Set(words1);\n    const set2 = new Set(words2);\n    \n    const intersection = new Set(Array.from(set1).filter(x => set2.has(x)));\n    const union = new Set([...words1, ...words2]);\n    \n    return intersection.size / union.size;\n  }\n\n  async getMemoryContext(userId: string, limit: number = 20): Promise<string> {\n    const facts = await storage.getMemoryFactsByUserId(userId, limit);\n    \n    if (facts.length === 0) {\n      return \"No established memories about this user yet.\";\n    }\n\n    const factsByCategory: Record<string, string[]> = {};\n    \n    for (const fact of facts) {\n      if (!factsByCategory[fact.category]) {\n        factsByCategory[fact.category] = [];\n      }\n      factsByCategory[fact.category].push(`${fact.factContent} (confidence: ${fact.confidence}%)`);\n    }\n\n    let context = \"## Known Facts About User:\\n\\n\";\n    \n    for (const [category, categoryFacts] of Object.entries(factsByCategory)) {\n      context += `**${category.replace(/_/g, \" \").toUpperCase()}:**\\n`;\n      context += categoryFacts.map(f => `- ${f}`).join(\"\\n\") + \"\\n\\n\";\n    }\n\n    return context;\n  }\n}\n\nexport const memoryService = new MemoryService();\n","path":null,"size_bytes":9494,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, jsonb, index, unique } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (required for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table (updated for Replit Auth)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\"),  // Not unique - same email can exist across different OAuth providers\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  conversationId: varchar(\"conversation_id\").notNull(),\n  role: text(\"role\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const journalEntries = pgTable(\"journal_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  content: text(\"content\").notNull(),\n  prompt: text(\"prompt\"),\n  wordCount: integer(\"word_count\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const personalityInsights = pgTable(\"personality_insights\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  insightType: text(\"insight_type\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  priority: text(\"priority\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const memoryFacts = pgTable(\"memory_facts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  factContent: text(\"fact_content\").notNull(),\n  category: text(\"category\").notNull(),\n  abstractionLevel: text(\"abstraction_level\").notNull().default('raw_fact'), // raw_fact, inferred_belief, defense_mechanism, ifs_part\n  confidence: integer(\"confidence\").notNull().default(50),\n  timeContext: text(\"time_context\"),\n  emotionalTone: text(\"emotional_tone\"),\n  status: text(\"status\").notNull().default('active'),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const memoryFactMentions = pgTable(\"memory_fact_mentions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  factId: varchar(\"fact_id\").notNull(),\n  sourceType: text(\"source_type\").notNull(),\n  sourceId: varchar(\"source_id\").notNull(),\n  evidenceExcerpt: text(\"evidence_excerpt\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const memorySnapshots = pgTable(\"memory_snapshots\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  snapshotType: text(\"snapshot_type\").notNull(),\n  content: text(\"content\").notNull(),\n  metadata: text(\"metadata\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const moodEntries = pgTable(\"mood_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  mood: text(\"mood\").notNull(),\n  intensity: integer(\"intensity\").notNull(),\n  activities: text(\"activities\").array(),\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const personalityReflections = pgTable(\"personality_reflections\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  tier: text(\"tier\").notNull().default('free'), // free, standard, premium\n  status: text(\"status\").notNull().default('pending'), // pending, processing, completed, failed\n  progress: integer(\"progress\").notNull().default(0), // 0-100 percentage\n  currentSection: text(\"current_section\"), // which section is being generated\n  errorMessage: text(\"error_message\"), // error details if failed\n  summary: text(\"summary\").notNull().default(''),\n  coreTraits: jsonb(\"core_traits\").notNull().default({}),\n  behavioralPatterns: text(\"behavioral_patterns\").array().notNull().default([]),\n  emotionalPatterns: text(\"emotional_patterns\").array().notNull().default([]),\n  relationshipDynamics: text(\"relationship_dynamics\").array().notNull().default([]),\n  copingMechanisms: text(\"coping_mechanisms\").array().notNull().default([]),\n  growthAreas: text(\"growth_areas\").array().notNull().default([]),\n  strengths: text(\"strengths\").array().notNull().default([]),\n  blindSpots: text(\"blind_spots\").array().notNull().default([]),\n  valuesAndBeliefs: text(\"values_and_beliefs\").array().notNull().default([]),\n  therapeuticInsights: text(\"therapeutic_insights\").array().notNull().default([]),\n  holyShitMoment: text(\"holy_shit_moment\"),\n  growthLeveragePoint: text(\"growth_leverage_point\"),\n  statistics: jsonb(\"statistics\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Category Tracking Tables (MVP Feature)\nexport const userSelectedCategories = pgTable(\"user_selected_categories\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  categoryId: varchar(\"category_id\").notNull(),\n  status: text(\"status\").notNull().default('active'),\n  baselineScore: integer(\"baseline_score\"),\n  goalScore: integer(\"goal_score\"),\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  pausedAt: timestamp(\"paused_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniqueUserCategory: unique('unique_user_category').on(table.userId, table.categoryId)\n}));\n\nexport const categoryScores = pgTable(\"category_scores\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  categoryId: varchar(\"category_id\").notNull(),\n  periodType: text(\"period_type\").notNull(),\n  periodStart: timestamp(\"period_start\").notNull(),\n  periodEnd: timestamp(\"period_end\").notNull(),\n  score: integer(\"score\").notNull(),\n  delta: integer(\"delta\"),\n  reasoning: text(\"reasoning\"),\n  keyPatterns: text(\"key_patterns\").array(),\n  progressIndicators: text(\"progress_indicators\").array(),\n  areasForGrowth: text(\"areas_for_growth\").array(),\n  confidenceLevel: text(\"confidence_level\"),\n  evidenceSnippets: jsonb(\"evidence_snippets\"),\n  contributors: jsonb(\"contributors\"),\n  generatedAt: timestamp(\"generated_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniquePeriodScore: unique('unique_period_score').on(table.userId, table.categoryId, table.periodType, table.periodStart)\n}));\n\nexport const categoryInsights = pgTable(\"category_insights\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  categoryId: varchar(\"category_id\").notNull(),\n  timeframe: text(\"timeframe\").notNull(),\n  summary: text(\"summary\").notNull(),\n  keyPatterns: text(\"key_patterns\").array().notNull(),\n  recommendedActions: text(\"recommended_actions\").array().notNull(),\n  severity: text(\"severity\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const upsertUserSchema = createInsertSchema(users).omit({\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertJournalEntrySchema = createInsertSchema(journalEntries).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertPersonalityInsightSchema = createInsertSchema(personalityInsights).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertMemoryFactSchema = createInsertSchema(memoryFacts).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMemoryFactMentionSchema = createInsertSchema(memoryFactMentions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMemorySnapshotSchema = createInsertSchema(memorySnapshots).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMoodEntrySchema = createInsertSchema(moodEntries).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertPersonalityReflectionSchema = createInsertSchema(personalityReflections).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertUserSelectedCategorySchema = createInsertSchema(userSelectedCategories).omit({\n  id: true,\n  createdAt: true,\n  startedAt: true,\n});\n\nexport const insertCategoryScoreSchema = createInsertSchema(categoryScores).omit({\n  id: true,\n  generatedAt: true,\n});\n\nexport const insertCategoryInsightSchema = createInsertSchema(categoryInsights).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type UpsertUser = z.infer<typeof upsertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Conversation = typeof conversations.$inferSelect;\nexport type Message = typeof messages.$inferSelect;\nexport type JournalEntry = typeof journalEntries.$inferSelect;\nexport type PersonalityInsight = typeof personalityInsights.$inferSelect;\nexport type MemoryFact = typeof memoryFacts.$inferSelect;\nexport type MemoryFactMention = typeof memoryFactMentions.$inferSelect;\nexport type MemorySnapshot = typeof memorySnapshots.$inferSelect;\nexport type MoodEntry = typeof moodEntries.$inferSelect;\nexport type PersonalityReflection = typeof personalityReflections.$inferSelect;\nexport type UserSelectedCategory = typeof userSelectedCategories.$inferSelect;\nexport type CategoryScore = typeof categoryScores.$inferSelect;\nexport type CategoryInsight = typeof categoryInsights.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type InsertJournalEntry = z.infer<typeof insertJournalEntrySchema>;\nexport type InsertMemoryFact = Omit<typeof memoryFacts.$inferInsert, \"id\" | \"createdAt\" | \"updatedAt\">;\nexport type InsertMemoryFactMention = z.infer<typeof insertMemoryFactMentionSchema>;\nexport type InsertMemorySnapshot = z.infer<typeof insertMemorySnapshotSchema>;\nexport type InsertMoodEntry = z.infer<typeof insertMoodEntrySchema>;\nexport type InsertPersonalityReflection = z.infer<typeof insertPersonalityReflectionSchema>;\nexport type InsertUserSelectedCategory = z.infer<typeof insertUserSelectedCategorySchema>;\nexport type InsertCategoryScore = z.infer<typeof insertCategoryScoreSchema>;\nexport type InsertCategoryInsight = z.infer<typeof insertCategoryInsightSchema>;\n","path":null,"size_bytes":11165,"size_tokens":null},"client/src/components/FeaturesSection.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { MessageSquare, ClipboardList, BookOpen, Brain, TrendingUp, Eye } from \"lucide-react\";\n\nconst features = [\n  {\n    icon: MessageSquare,\n    title: \"AI Conversations\",\n    description: \"Chat freely about your thoughts, feelings, and experiences. Our AI analyzes patterns in your communication style and emotional expression.\"\n  },\n  {\n    icon: ClipboardList,\n    title: \"Personality Questionnaires\",\n    description: \"Complete comprehensive assessments covering values, behaviors, relationships, and goals to build your personality foundation.\"\n  },\n  {\n    icon: BookOpen,\n    title: \"Digital Journaling\",\n    description: \"Write daily reflections and track your inner world. AI identifies recurring themes, emotions, and growth patterns over time.\"\n  },\n  {\n    icon: Brain,\n    title: \"Deep Analysis\",\n    description: \"Advanced AI creates a mirror image of your personality, revealing core traits, motivations, and behavioral patterns.\"\n  },\n  {\n    icon: Eye,\n    title: \"Blind Spot Detection\",\n    description: \"Discover aspects of yourself you weren't aware of. Uncover hidden biases, contradictions, and unconscious patterns.\"\n  },\n  {\n    icon: TrendingUp,\n    title: \"Growth Roadmap\",\n    description: \"Receive personalized insights and actionable recommendations to improve specific aspects of your life and personality.\"\n  }\n];\n\nexport function FeaturesSection() {\n  return (\n    <section className=\"py-20 px-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"text-center mb-16\">\n          <h2 className=\"text-3xl md:text-4xl font-semibold mb-4\">\n            Complete Personality Analysis\n          </h2>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Multiple data sources combine to create the most accurate reflection of who you truly are\n          </p>\n        </div>\n        \n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {features.map((feature, index) => {\n            const Icon = feature.icon;\n            return (\n              <Card key={index} className=\"hover-elevate\" data-testid={`card-feature-${index}`}>\n                <CardHeader>\n                  <div className=\"h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4\">\n                    <Icon className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-xl\">{feature.title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <CardDescription className=\"text-base\">\n                    {feature.description}\n                  </CardDescription>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":2858,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/examples/FeaturesSection.tsx":{"content":"import { FeaturesSection } from '../FeaturesSection';\n\nexport default function FeaturesSectionExample() {\n  return <FeaturesSection />;\n}\n","path":null,"size_bytes":138,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\nimport { getQueryFn } from \"@/lib/queryClient\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","path":null,"size_bytes":405,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 220 0% 98%;\n  --foreground: 220 5% 12%;\n  --border: 220 10% 88%;\n\n  --card: 220 0% 96%;\n  --card-foreground: 220 5% 12%;\n  --card-border: 220 8% 90%;\n\n  --sidebar: 220 2% 94%;\n  --sidebar-foreground: 220 5% 12%;\n  --sidebar-border: 220 8% 87%;\n\n  --sidebar-primary: 210 85% 42%;\n  --sidebar-primary-foreground: 210 15% 98%;\n\n  --sidebar-accent: 220 8% 88%;\n  --sidebar-accent-foreground: 220 5% 15%;\n\n  --sidebar-ring: 210 85% 42%;\n\n  --popover: 220 3% 92%;\n  --popover-foreground: 220 5% 12%;\n  --popover-border: 220 10% 85%;\n\n  --primary: 210 85% 42%;\n  --primary-foreground: 210 15% 98%;\n\n  --secondary: 220 8% 86%;\n  --secondary-foreground: 220 5% 15%;\n\n  --muted: 220 12% 90%;\n  --muted-foreground: 220 5% 35%;\n\n  --accent: 220 15% 88%;\n  --accent-foreground: 220 5% 20%;\n\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 10% 98%;\n\n  --input: 220 12% 75%;\n  --ring: 210 85% 42%;\n\n  --chart-1: 210 85% 42%;\n  --chart-2: 168 76% 38%;\n  --chart-3: 280 65% 48%;\n  --chart-4: 32 95% 52%;\n  --chart-5: 340 75% 52%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif;\n  --font-serif: \"Crimson Pro\", Georgia, serif;\n  --font-mono: Menlo, Monaco, \"Courier New\", monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 1px 2px 0px hsl(220 10% 10% / 0.02);\n  --shadow-xs: 0px 1px 2px 0px hsl(220 10% 10% / 0.04);\n  --shadow-sm: 0px 1px 3px 0px hsl(220 10% 10% / 0.06), 0px 1px 2px -1px hsl(220 10% 10% / 0.04);\n  --shadow: 0px 2px 4px 0px hsl(220 10% 10% / 0.08), 0px 1px 2px -1px hsl(220 10% 10% / 0.04);\n  --shadow-md: 0px 4px 6px -1px hsl(220 10% 10% / 0.08), 0px 2px 4px -2px hsl(220 10% 10% / 0.04);\n  --shadow-lg: 0px 10px 15px -3px hsl(220 10% 10% / 0.08), 0px 4px 6px -4px hsl(220 10% 10% / 0.04);\n  --shadow-xl: 0px 20px 25px -5px hsl(220 10% 10% / 0.08), 0px 8px 10px -6px hsl(220 10% 10% / 0.04);\n  --shadow-2xl: 0px 25px 50px -12px hsl(220 10% 10% / 0.12);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 5% 8%;\n  --foreground: 220 5% 95%;\n  --border: 220 8% 18%;\n\n  --card: 220 4% 11%;\n  --card-foreground: 220 5% 95%;\n  --card-border: 220 8% 16%;\n\n  --sidebar: 220 5% 13%;\n  --sidebar-foreground: 220 5% 95%;\n  --sidebar-border: 220 8% 20%;\n\n  --sidebar-primary: 210 80% 48%;\n  --sidebar-primary-foreground: 210 10% 98%;\n\n  --sidebar-accent: 220 10% 20%;\n  --sidebar-accent-foreground: 220 5% 92%;\n\n  --sidebar-ring: 210 80% 48%;\n\n  --popover: 220 5% 15%;\n  --popover-foreground: 220 5% 95%;\n  --popover-border: 220 8% 22%;\n\n  --primary: 210 80% 48%;\n  --primary-foreground: 210 10% 98%;\n\n  --secondary: 220 8% 22%;\n  --secondary-foreground: 220 5% 92%;\n\n  --muted: 220 12% 18%;\n  --muted-foreground: 220 5% 68%;\n\n  --accent: 220 15% 20%;\n  --accent-foreground: 220 5% 88%;\n\n  --destructive: 0 68% 48%;\n  --destructive-foreground: 0 10% 98%;\n\n  --input: 220 12% 32%;\n  --ring: 210 80% 48%;\n\n  --chart-1: 210 85% 62%;\n  --chart-2: 168 76% 58%;\n  --chart-3: 280 65% 68%;\n  --chart-4: 32 95% 62%;\n  --chart-5: 340 75% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(220 10% 0% / 0.08);\n  --shadow-xs: 0px 1px 2px 0px hsl(220 10% 0% / 0.12);\n  --shadow-sm: 0px 1px 3px 0px hsl(220 10% 0% / 0.16), 0px 1px 2px -1px hsl(220 10% 0% / 0.12);\n  --shadow: 0px 2px 4px 0px hsl(220 10% 0% / 0.20), 0px 1px 2px -1px hsl(220 10% 0% / 0.12);\n  --shadow-md: 0px 4px 6px -1px hsl(220 10% 0% / 0.24), 0px 2px 4px -2px hsl(220 10% 0% / 0.12);\n  --shadow-lg: 0px 10px 15px -3px hsl(220 10% 0% / 0.28), 0px 4px 6px -4px hsl(220 10% 0% / 0.12);\n  --shadow-xl: 0px 20px 25px -5px hsl(220 10% 0% / 0.32), 0px 8px 10px -6px hsl(220 10% 0% / 0.12);\n  --shadow-2xl: 0px 25px 50px -12px hsl(220 10% 0% / 0.40);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","path":null,"size_bytes":9890,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction, QueryCache, MutationCache } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nfunction handleUnauthorizedError(error: Error) {\n  if (error.message.includes(\"401:\")) {\n    window.location.href = \"/api/login\";\n  }\n}\n\nexport const queryClient = new QueryClient({\n  queryCache: new QueryCache({\n    onError: handleUnauthorizedError,\n  }),\n  mutationCache: new MutationCache({\n    onError: handleUnauthorizedError,\n  }),\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1703,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import { ThemeToggle } from '../ThemeToggle';\n\nexport default function ThemeToggleExample() {\n  return <ThemeToggle />;\n}\n","path":null,"size_bytes":122,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/Landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { MessageCircle, BookOpen, BarChart3 } from \"lucide-react\";\nimport { Logo } from \"@/components/Logo\";\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <header className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <Logo size=\"md\" />\n          <Button asChild data-testid=\"button-login\">\n            <a href=\"/api/login\">Sign In</a>\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto px-4 py-16 flex flex-col items-center justify-center\">\n        <div className=\"max-w-4xl mx-auto text-center space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-4xl sm:text-5xl font-bold tracking-tight\">\n              Discover the truth about yourself\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n              An AI-powered personality analyzer that gives you honest, deep insights about who you really are—not who you think you are.\n            </p>\n          </div>\n\n          <Button size=\"lg\" asChild className=\"text-lg px-8\" data-testid=\"button-get-started\">\n            <a href=\"/api/login\">Get Started</a>\n          </Button>\n\n          <div className=\"grid sm:grid-cols-2 lg:grid-cols-4 gap-6 mt-16\">\n            <Card>\n              <CardHeader>\n                <MessageCircle className=\"w-8 h-8 mb-2 text-primary\" />\n                <CardTitle className=\"text-lg\">Deep Conversations</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <CardDescription>\n                  Chat with an AI analyst that asks the hard questions you avoid\n                </CardDescription>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <BookOpen className=\"w-8 h-8 mb-2 text-primary\" />\n                <CardTitle className=\"text-lg\">Private Journal</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <CardDescription>\n                  Reflect daily and uncover patterns in your thoughts and emotions\n                </CardDescription>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <Logo showText={false} size=\"md\" className=\"mb-2\" />\n                <CardTitle className=\"text-lg\">Blind Spots</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <CardDescription>\n                  Discover what you can't see about yourself—your hidden patterns\n                </CardDescription>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <BarChart3 className=\"w-8 h-8 mb-2 text-primary\" />\n                <CardTitle className=\"text-lg\">Personality Analysis</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <CardDescription>\n                  Get comprehensive Big 5 traits analysis and growth opportunities\n                </CardDescription>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"mt-16 p-6 bg-muted rounded-lg text-left max-w-2xl mx-auto\">\n            <p className=\"text-sm text-muted-foreground\">\n              <strong className=\"text-foreground\">Privacy First:</strong> Your conversations, journals, and insights are completely private. Only you can access your data. We use AI to help you understand yourself better, not to judge or share your information.\n            </p>\n          </div>\n        </div>\n      </main>\n\n      <footer className=\"border-t py-8\">\n        <div className=\"container mx-auto px-4 text-center text-sm text-muted-foreground\">\n          <p>Mirror • Your honest AI personality analyst</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":4036,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/Insights.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Lightbulb, Eye, TrendingUp, Loader2 } from \"lucide-react\";\n\ntype PersonalityInsight = {\n  id: string;\n  userId: string;\n  insightType: string;\n  title: string;\n  description: string;\n  priority: string;\n  createdAt: Date;\n};\n\nexport default function Insights() {\n  const { data: insights = [], isLoading } = useQuery<PersonalityInsight[]>({\n    queryKey: [\"/api/insights\"],\n  });\n\n  const blindSpots = insights.filter(i => i.insightType === \"blind_spot\");\n  const growthOpportunities = insights.filter(i => i.insightType === \"growth_opportunity\");\n\n  const getPriorityVariant = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return \"destructive\";\n      case \"medium\":\n        return \"default\";\n      case \"low\":\n        return \"secondary\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <DashboardNav />\n      \n      <main className=\"max-w-5xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-bold mb-1 sm:mb-2\" data-testid=\"text-insights-title\">Your Insights</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\" data-testid=\"text-insights-description\">\n            AI-generated observations about your personality patterns, blind spots, and growth opportunities\n          </p>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : insights.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12\">\n              <div className=\"text-center\">\n                <Lightbulb className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                <p className=\"text-muted-foreground\" data-testid=\"text-no-insights\">\n                  No insights yet. Keep journaling and chatting with the AI to generate insights!\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-8\">\n            {blindSpots.length > 0 && (\n              <section>\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Eye className=\"h-5 w-5 text-primary\" />\n                  <h2 className=\"text-2xl font-semibold\" data-testid=\"text-blindspots-title\">Blind Spots</h2>\n                  <Badge variant=\"secondary\" data-testid=\"badge-blindspots-count\">{blindSpots.length}</Badge>\n                </div>\n                <div className=\"space-y-4\">\n                  {blindSpots.map((insight) => (\n                    <Card key={insight.id} data-testid={`card-insight-${insight.id}`}>\n                      <CardHeader>\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <CardTitle className=\"text-lg\" data-testid={`text-insight-title-${insight.id}`}>\n                            {insight.title}\n                          </CardTitle>\n                          <Badge variant={getPriorityVariant(insight.priority)} data-testid={`badge-priority-${insight.id}`}>\n                            {insight.priority}\n                          </Badge>\n                        </div>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-muted-foreground\" data-testid={`text-insight-description-${insight.id}`}>\n                          {insight.description}\n                        </p>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </section>\n            )}\n\n            {growthOpportunities.length > 0 && (\n              <section>\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <TrendingUp className=\"h-5 w-5 text-primary\" />\n                  <h2 className=\"text-2xl font-semibold\" data-testid=\"text-growth-title\">Growth Opportunities</h2>\n                  <Badge variant=\"secondary\" data-testid=\"badge-growth-count\">{growthOpportunities.length}</Badge>\n                </div>\n                <div className=\"space-y-4\">\n                  {growthOpportunities.map((insight) => (\n                    <Card key={insight.id} data-testid={`card-insight-${insight.id}`}>\n                      <CardHeader>\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <CardTitle className=\"text-lg\" data-testid={`text-insight-title-${insight.id}`}>\n                            {insight.title}\n                          </CardTitle>\n                          <Badge variant={getPriorityVariant(insight.priority)} data-testid={`badge-priority-${insight.id}`}>\n                            {insight.priority}\n                          </Badge>\n                        </div>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-muted-foreground\" data-testid={`text-insight-description-${insight.id}`}>\n                          {insight.description}\n                        </p>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </section>\n            )}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":5627,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { LogOut, User, Mail } from \"lucide-react\";\n\nexport default function Profile() {\n  const { user } = useAuth();\n\n  const handleLogout = async () => {\n    await fetch(\"/api/logout\", { method: \"POST\" });\n    window.location.href = \"/\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <DashboardNav />\n      \n      <main className=\"max-w-3xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-bold mb-1 sm:mb-2\" data-testid=\"text-profile-title\">Profile</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\" data-testid=\"text-profile-description\">\n            Manage your account settings and preferences\n          </p>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle data-testid=\"text-account-title\">Account Information</CardTitle>\n              <CardDescription>Your personal details and authentication info</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-16 w-16\" data-testid=\"avatar-profile\">\n                  <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-xl\">\n                    {user?.firstName?.[0]?.toUpperCase() || 'U'}\n                    {user?.lastName?.[0]?.toUpperCase() || ''}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-semibold text-lg\" data-testid=\"text-user-name\">\n                    {user?.firstName} {user?.lastName}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\" data-testid=\"text-user-email\">\n                    {user?.email}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"grid gap-4 pt-4\">\n                <div className=\"flex items-center gap-3 p-3 rounded-md border\">\n                  <User className=\"h-5 w-5 text-muted-foreground\" />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium\">Full Name</p>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-fullname\">\n                      {user?.firstName} {user?.lastName}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-3 p-3 rounded-md border\">\n                  <Mail className=\"h-5 w-5 text-muted-foreground\" />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium\">Email</p>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-email\">\n                      {user?.email}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle data-testid=\"text-session-title\">Session</CardTitle>\n              <CardDescription>Manage your current session</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Button\n                onClick={handleLogout}\n                variant=\"destructive\"\n                className=\"gap-2\"\n                data-testid=\"button-logout\"\n              >\n                <LogOut className=\"h-4 w-4\" />\n                Sign Out\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":3893,"size_tokens":null},"client/src/hooks/useTextToSpeech.ts":{"content":"import { useState, useCallback, useRef } from 'react';\n\ninterface TextToSpeechOptions {\n  voiceId?: string;\n  onStart?: () => void;\n  onEnd?: () => void;\n  onError?: (error: Error) => void;\n}\n\n// Global audio context to enable auto-play after first user interaction\nlet globalAudioContext: AudioContext | null = null;\nlet globalAudioUnlocked = false;\n\nexport function useTextToSpeech(options: TextToSpeechOptions = {}) {\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const audioUrlRef = useRef<string | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const requestIdRef = useRef(0);\n\n  const cleanup = useCallback(() => {\n    // Abort any in-flight requests\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    \n    if (audioRef.current) {\n      // Remove all event listeners before cleanup to prevent error events\n      audioRef.current.onplay = null;\n      audioRef.current.onended = null;\n      audioRef.current.onerror = null;\n      audioRef.current.pause();\n      audioRef.current.src = '';\n      audioRef.current = null;\n    }\n    if (audioUrlRef.current) {\n      URL.revokeObjectURL(audioUrlRef.current);\n      audioUrlRef.current = null;\n    }\n  }, []);\n\n  // Function to unlock audio playback on first user interaction\n  const unlockAudio = useCallback(async () => {\n    if (globalAudioUnlocked) return true;\n    \n    try {\n      // Create audio context if it doesn't exist\n      if (!globalAudioContext) {\n        globalAudioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n      }\n      \n      // Resume the context (requires user gesture)\n      if (globalAudioContext.state === 'suspended') {\n        await globalAudioContext.resume();\n      }\n      \n      // Create a silent buffer and play it to unlock audio\n      const buffer = globalAudioContext.createBuffer(1, 1, 22050);\n      const source = globalAudioContext.createBufferSource();\n      source.buffer = buffer;\n      source.connect(globalAudioContext.destination);\n      source.start(0);\n      \n      globalAudioUnlocked = true;\n      console.log('Audio unlocked successfully');\n      return true;\n    } catch (e) {\n      console.error('Failed to unlock audio:', e);\n      return false;\n    }\n  }, []);\n\n  const speak = useCallback(async (text: string, userInitiated = false) => {\n    if (!text) return;\n\n    // If this is user-initiated, unlock audio first\n    if (userInitiated) {\n      await unlockAudio();\n    }\n\n    // Stop any existing playback before starting new one\n    cleanup();\n    setIsSpeaking(false);\n    setIsLoading(false);\n\n    // Create a new request ID and AbortController for this request\n    const currentRequestId = ++requestIdRef.current;\n    const abortController = new AbortController();\n    abortControllerRef.current = abortController;\n\n    try {\n      setIsLoading(true);\n\n      const response = await fetch('/api/text-to-speech', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          text,\n          voiceId: options.voiceId,\n        }),\n        signal: abortController.signal,\n      });\n\n      // Check if this request was cancelled\n      if (currentRequestId !== requestIdRef.current) {\n        return;\n      }\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('TTS API error:', response.status, errorText);\n        throw new Error('Failed to generate speech');\n      }\n\n      const audioBlob = await response.blob();\n      console.log('TTS audio blob received:', audioBlob.size, 'bytes, type:', audioBlob.type);\n      \n      // Check again if this request was cancelled after blob download\n      if (currentRequestId !== requestIdRef.current) {\n        return;\n      }\n\n      const audioUrl = URL.createObjectURL(audioBlob);\n      audioUrlRef.current = audioUrl;\n\n      const audio = new Audio(audioUrl);\n      audioRef.current = audio;\n\n      const handlePlay = () => {\n        // Only update state if this is still the current request\n        if (currentRequestId === requestIdRef.current) {\n          setIsSpeaking(true);\n          setIsLoading(false);\n          options.onStart?.();\n        }\n      };\n\n      const handleEnded = () => {\n        if (currentRequestId === requestIdRef.current) {\n          setIsSpeaking(false);\n          // Remove event listeners before cleanup to prevent error events\n          audio.removeEventListener('play', handlePlay);\n          audio.removeEventListener('ended', handleEnded);\n          audio.removeEventListener('error', handleError);\n          cleanup();\n          options.onEnd?.();\n        }\n      };\n\n      const handleError = (e: Event) => {\n        if (currentRequestId === requestIdRef.current) {\n          console.error('Audio playback error event:', e, 'Audio element:', audio, 'Error code:', audio.error?.code, 'Error message:', audio.error?.message);\n          setIsSpeaking(false);\n          setIsLoading(false);\n          // Remove event listeners before cleanup\n          audio.removeEventListener('play', handlePlay);\n          audio.removeEventListener('ended', handleEnded);\n          audio.removeEventListener('error', handleError);\n          cleanup();\n          const error = new Error('Audio playback failed');\n          options.onError?.(error);\n        }\n      };\n\n      audio.addEventListener('play', handlePlay);\n      audio.addEventListener('ended', handleEnded);\n      audio.addEventListener('error', handleError);\n\n      // Final check before playing\n      if (currentRequestId === requestIdRef.current) {\n        try {\n          console.log('Starting audio playback, audioUrl:', audioUrl);\n          await audio.play();\n          console.log('Audio playback started successfully');\n        } catch (playError) {\n          console.error('audio.play() failed (likely browser auto-play policy):', playError);\n          // Browser blocked auto-play - call onError to trigger the banner\n          setIsSpeaking(false);\n          setIsLoading(false);\n          cleanup();\n          // Always call onError - the chat interface will decide how to handle it\n          if (playError instanceof Error) {\n            options.onError?.(playError);\n          }\n          return;\n        }\n      }\n    } catch (error) {\n      // Only report errors if this request is still current and wasn't aborted\n      if (currentRequestId === requestIdRef.current && error instanceof Error && error.name !== 'AbortError') {\n        console.error('TTS error in speak function:', error);\n        setIsSpeaking(false);\n        setIsLoading(false);\n        cleanup();\n        options.onError?.(error as Error);\n      }\n    }\n  }, [options, cleanup, unlockAudio]);\n\n  const stop = useCallback(() => {\n    cleanup();\n    setIsSpeaking(false);\n    setIsLoading(false);\n    options.onEnd?.();\n  }, [cleanup, options]);\n\n  return {\n    speak,\n    stop,\n    isSpeaking,\n    isLoading,\n    unlockAudio,\n  };\n}\n","path":null,"size_bytes":7149,"size_tokens":null},"client/src/pages/PersonalityReflection.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { DashboardNav } from \"@/components/DashboardNav\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Dialog, DialogClose, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Brain, TrendingUp, Eye, Heart, Target, Lightbulb, Shield, Sparkles, RefreshCw, Loader2, Users, Zap, CheckCircle2, Volume2, VolumeX, AlertTriangle, Rocket } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useTextToSpeech } from \"@/hooks/useTextToSpeech\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { stripMarkdownForSpeech } from \"@/lib/utils\";\n\ntype AnalysisTier = 'free' | 'standard' | 'premium';\ntype JobStatus = 'pending' | 'processing' | 'completed' | 'failed';\n\ntype PersonalityReflection = {\n  id: string;\n  userId: string;\n  tier: AnalysisTier;\n  status: JobStatus;\n  progress: number;\n  currentSection?: string | null;\n  errorMessage?: string | null;\n  summary: string;\n  coreTraits: {\n    big5: {\n      openness: number;\n      conscientiousness: number;\n      extraversion: number;\n      agreeableness: number;\n      emotionalStability: number;\n    };\n    archetype: string;\n    dominantTraits: string[];\n  };\n  behavioralPatterns: string[];\n  emotionalPatterns: string[];\n  relationshipDynamics: string[];\n  copingMechanisms: string[];\n  growthAreas: string[];\n  strengths: string[];\n  blindSpots: string[];\n  valuesAndBeliefs: string[];\n  therapeuticInsights: string[];\n  holyShitMoment?: string | null;\n  growthLeveragePoint?: string | null;\n  statistics: {\n    totalConversations: number;\n    totalMessages: number;\n    totalJournalEntries: number;\n    totalMoodEntries: number;\n    totalMemoryFacts: number;\n    averageMoodScore: number;\n    journalStreak: number;\n    mostCommonEmotions: string[];\n    mostActiveCategories: string[];\n    engagementScore: number;\n  } | null;\n  createdAt: Date;\n};\n\nconst TIER_CONFIG = {\n  free: {\n    name: 'Starter Insights',\n    price: '$0',\n    sections: ['behavioralPatterns', 'growthAreas'],\n    color: 'gray'\n  },\n  standard: {\n    name: 'Deep Dive',\n    price: '$9',\n    sections: ['behavioralPatterns', 'emotionalPatterns', 'relationshipDynamics', 'growthAreas', 'strengths', 'blindSpots'],\n    color: 'blue'\n  },\n  premium: {\n    name: 'Devastating Truth',\n    price: '$29',\n    sections: ['behavioralPatterns', 'emotionalPatterns', 'relationshipDynamics', 'copingMechanisms', 'growthAreas', 'strengths', 'blindSpots', 'valuesAndBeliefs', 'therapeuticInsights'],\n    color: 'primary'\n  }\n} as const;\n\nconst Big5TraitBar = ({ label, value }: { label: string; value: number }) => {\n  const getColor = (val: number) => {\n    if (val >= 75) return \"bg-primary\";\n    if (val >= 50) return \"bg-blue-500\";\n    if (val >= 25) return \"bg-yellow-500\";\n    return \"bg-gray-400\";\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-sm font-medium\">{label}</span>\n        <span className=\"text-sm font-bold\">{value}/100</span>\n      </div>\n      <div className=\"relative h-3 w-full rounded-full bg-secondary overflow-hidden\">\n        <div \n          className={`absolute top-0 left-0 h-full ${getColor(value)} transition-all duration-1000 ease-out rounded-full`}\n          style={{ width: `${value}%` }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StatCard = ({ icon: Icon, label, value, description }: { icon: any; label: string; value: string | number; description?: string }) => (\n  <Card>\n    <CardContent className=\"pt-4 sm:pt-6 p-3 sm:p-6\">\n      <div className=\"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2\">\n        <div className=\"p-1.5 sm:p-2 rounded-md bg-primary/10 shrink-0\">\n          <Icon className=\"h-4 w-4 sm:h-5 sm:w-5 text-primary\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-lg sm:text-2xl font-bold truncate\">{value}</p>\n          <p className=\"text-xs sm:text-sm text-muted-foreground truncate\">{label}</p>\n        </div>\n      </div>\n      {description && <p className=\"text-xs text-muted-foreground mt-1 sm:mt-2\">{description}</p>}\n    </CardContent>\n  </Card>\n);\n\nconst LockedSectionCard = ({ \n  title, \n  description, \n  icon: Icon,\n  requiredTier \n}: { \n  title: string; \n  description: string; \n  icon: any;\n  requiredTier: AnalysisTier;\n}) => (\n  <Card className=\"opacity-60 border-dashed\" data-testid={`card-locked-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n    <CardHeader>\n      <div className=\"flex items-center justify-between gap-3\">\n        <div>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Icon className=\"h-5 w-5\" />\n            {title}\n            <Badge variant=\"secondary\" className=\"ml-2\" data-testid={`badge-locked-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              {TIER_CONFIG[requiredTier].name} Only\n            </Badge>\n          </CardTitle>\n          <CardDescription>{description}</CardDescription>\n        </div>\n      </div>\n    </CardHeader>\n    <CardContent>\n      <div className=\"flex items-center justify-center py-8 text-center\">\n        <div className=\"space-y-4\">\n          <Rocket className=\"h-12 w-12 text-muted-foreground mx-auto\" />\n          <p className=\"text-sm text-muted-foreground max-w-xs\">\n            Unlock this section with {TIER_CONFIG[requiredTier].name} tier\n          </p>\n        </div>\n      </div>\n    </CardContent>\n  </Card>\n);\n\nfunction isSectionEnabled(sectionName: string, tier: AnalysisTier): boolean {\n  return TIER_CONFIG[tier].sections.includes(sectionName as any);\n}\n\nexport default function PersonalityReflection() {\n  const [playingSection, setPlayingSection] = useState<string | null>(null);\n  const [selectedTier, setSelectedTier] = useState<AnalysisTier>('free');\n  const [activeJobId, setActiveJobId] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  // Fetch the latest completed reflection\n  const { data: reflection, isLoading, error } = useQuery<PersonalityReflection>({\n    queryKey: [\"/api/personality-reflection\"],\n  });\n\n  // Poll for job status when we have an active job\n  const { data: jobStatus } = useQuery<PersonalityReflection>({\n    queryKey: [\"/api/personality-reflection\", activeJobId],\n    enabled: !!activeJobId,\n    refetchInterval: (query) => {\n      const data = query.state.data as PersonalityReflection | undefined;\n      // Stop polling when job is done\n      if (data?.status === 'completed' || data?.status === 'failed') {\n        return false;\n      }\n      return 2000; // Poll every 2 seconds while processing\n    },\n  });\n\n  // Handle job completion\n  useEffect(() => {\n    if (jobStatus?.status === 'completed') {\n      setActiveJobId(null);\n      queryClient.invalidateQueries({ queryKey: [\"/api/personality-reflection\"] });\n      toast({\n        title: \"Analysis Complete\",\n        description: \"Your personality reflection is ready!\",\n      });\n    } else if (jobStatus?.status === 'failed') {\n      setActiveJobId(null);\n      toast({\n        title: \"Analysis Failed\",\n        description: jobStatus.errorMessage || \"Something went wrong. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  }, [jobStatus?.status, jobStatus?.errorMessage, toast]);\n\n  const { speak, stop: stopSpeaking, isSpeaking } = useTextToSpeech({\n    onStart: () => {\n      // Playing state is tracked by playingSection\n    },\n    onEnd: () => {\n      setPlayingSection(null);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Speech Error\",\n        description: \"Failed to play audio. Please try again.\",\n        variant: \"destructive\",\n      });\n      setPlayingSection(null);\n    },\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async (): Promise<PersonalityReflection> => {\n      const data = await apiRequest(\"POST\", \"/api/personality-reflection\", { tier: selectedTier });\n      return data as PersonalityReflection;\n    },\n    onSuccess: (data: PersonalityReflection) => {\n      // If job is pending or processing, start polling\n      if (data.status === 'pending' || data.status === 'processing') {\n        setActiveJobId(data.id);\n      } else if (data.status === 'completed') {\n        queryClient.invalidateQueries({ queryKey: [\"/api/personality-reflection\"] });\n      }\n    },\n  });\n\n  // Check if there's an active job from the reflection data\n  const isJobProcessing = activeJobId && (jobStatus?.status === 'pending' || jobStatus?.status === 'processing');\n  const jobProgress = jobStatus?.progress || 0;\n  const currentSection = jobStatus?.currentSection || 'Starting analysis...';\n\n  const handlePlaySection = (sectionName: string, text: string) => {\n    // If this section is already playing, stop it\n    if (playingSection === sectionName) {\n      stopSpeaking();\n      setPlayingSection(null);\n      return;\n    }\n\n    // Start playing this section\n    setPlayingSection(sectionName);\n    speak(stripMarkdownForSpeech(text), true);\n  };\n\n  const handlePlayArchetype = () => {\n    if (!reflection) return;\n    const text = `\nYour Comprehensive Personality Reflection.\n\nYour Personality Archetype: ${reflection.coreTraits.archetype}.\n\n${reflection.summary}\n    `.trim();\n    handlePlaySection('archetype', text);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <DashboardNav />\n        <main className=\"max-w-7xl mx-auto px-6 py-8\">\n          <div className=\"flex items-center justify-center py-20\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  // Check if error is a 404 (no reflection found yet) - treat as empty state\n  const is404 = error instanceof Error && \n    (error.message.includes(\"404\") || error.message.includes(\"No personality reflection found\"));\n\n  if (error && !is404) {\n    const errorMessage = error instanceof Error ? error.message : \"Failed to load personality reflection\";\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <DashboardNav />\n        <main className=\"max-w-5xl mx-auto px-6 py-8\">\n          <Card className=\"border-destructive\">\n            <CardContent className=\"py-16\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"text-destructive text-4xl mb-4\">⚠</div>\n                <h2 className=\"text-2xl font-bold\">Error Loading Reflection</h2>\n                <p className=\"text-muted-foreground max-w-md mx-auto\">{errorMessage}</p>\n                <Button \n                  onClick={() => window.location.reload()}\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  data-testid=\"button-retry-load\"\n                >\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\n                  Retry\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </main>\n      </div>\n    );\n  }\n\n  if (generateMutation.isError) {\n    const errorMessage = generateMutation.error instanceof Error \n      ? generateMutation.error.message \n      : \"Failed to generate personality reflection\";\n    \n    // Check if it's an OpenAI quota error\n    const isQuotaError = errorMessage.includes(\"quota\") || errorMessage.includes(\"429\");\n    \n    return (\n      <div className=\"min-h-screen bg-background\">\n        <DashboardNav />\n        <main className=\"max-w-5xl mx-auto px-6 py-8\">\n          <Card className=\"border-destructive\">\n            <CardContent className=\"py-16\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"text-destructive text-4xl mb-4\">⚠</div>\n                <h2 className=\"text-2xl font-bold\">\n                  {isQuotaError ? \"OpenAI API Quota Exceeded\" : \"Error Generating Reflection\"}\n                </h2>\n                <p className=\"text-muted-foreground max-w-md mx-auto\">{errorMessage}</p>\n                {isQuotaError ? (\n                  <div className=\"text-sm text-muted-foreground space-y-2 max-w-lg mx-auto\">\n                    <p>Your OpenAI API key has exceeded its usage quota.</p>\n                    <p className=\"font-medium\">To fix this:</p>\n                    <ol className=\"text-left list-decimal list-inside space-y-1\">\n                      <li>Go to <a href=\"https://platform.openai.com/account/billing\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline\">OpenAI Billing</a></li>\n                      <li>Add credits or upgrade your plan</li>\n                      <li>Check your usage at <a href=\"https://platform.openai.com/account/usage\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline\">OpenAI Usage</a></li>\n                    </ol>\n                  </div>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">\n                    Make sure you have enough data: conversations, journal entries, and mood entries.\n                  </p>\n                )}\n                <Button \n                  onClick={() => generateMutation.reset()}\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  data-testid=\"button-retry-generate\"\n                >\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\n                  Try Again\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </main>\n      </div>\n    );\n  }\n\n  // Show empty state if no reflection or if last reflection failed/is incomplete\n  const showEmptyState = !reflection || \n    (reflection.status === 'failed') || \n    (!reflection.summary && reflection.status === 'completed');\n  \n  if (showEmptyState && !generateMutation.isPending && !isJobProcessing) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <DashboardNav />\n        <main className=\"max-w-5xl mx-auto px-6 py-8 space-y-8\">\n          <div className=\"text-center space-y-4\">\n            <Brain className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold\">Generate Your Comprehensive Personality Reflection</h2>\n            <p className=\"text-muted-foreground max-w-md mx-auto\">\n              Choose your analysis depth. Each tier uses professional psychological frameworks to reveal deeper insights about your personality.\n            </p>\n          </div>\n\n          {/* Tier Selection Cards */}\n          <div className=\"grid md:grid-cols-3 gap-6\">\n            {(['free', 'standard', 'premium'] as const).map((tier) => {\n              const config = TIER_CONFIG[tier];\n              const isSelected = selectedTier === tier;\n              \n              return (\n                <Card \n                  key={tier}\n                  className={`relative cursor-pointer transition-all ${isSelected ? 'ring-2 ring-primary' : ''}`}\n                  onClick={() => setSelectedTier(tier)}\n                  data-testid={`card-tier-${tier}`}\n                >\n                  {isSelected && (\n                    <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                      <Badge variant=\"default\" className=\"bg-primary\" data-testid={`badge-selected-${tier}`}>\n                        <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                        Selected\n                      </Badge>\n                    </div>\n                  )}\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center justify-between\">\n                      <span data-testid={`text-tier-name-${tier}`}>{config.name}</span>\n                      <Badge variant={tier === 'free' ? 'secondary' : 'default'} data-testid={`badge-price-${tier}`}>\n                        {config.price}\n                      </Badge>\n                    </CardTitle>\n                    <CardDescription data-testid={`text-tier-sections-${tier}`}>\n                      {config.sections.length} analysis sections\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div className=\"text-sm text-muted-foreground space-y-1\">\n                      {tier === 'free' && (\n                        <>\n                          <p>• Behavioral Patterns</p>\n                          <p>• Growth Areas</p>\n                        </>\n                      )}\n                      {tier === 'standard' && (\n                        <>\n                          <p>• Everything in Free</p>\n                          <p>• Emotional Patterns</p>\n                          <p>• Relationship Dynamics</p>\n                          <p>• Strengths & Blind Spots</p>\n                        </>\n                      )}\n                      {tier === 'premium' && (\n                        <>\n                          <p>• Everything in Standard</p>\n                          <p>• Coping Mechanisms</p>\n                          <p>• Values & Beliefs</p>\n                          <p>• Therapeutic Insights</p>\n                          <p className=\"font-semibold text-primary\">• Holy Shit Moment ✨</p>\n                        </>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n\n          <div className=\"text-center\">\n            <Button \n              onClick={() => generateMutation.mutate()}\n              size=\"lg\"\n              className=\"mt-6\"\n              data-testid=\"button-generate-reflection\"\n            >\n              <Sparkles className=\"mr-2 h-4 w-4\" />\n              Generate {TIER_CONFIG[selectedTier].name} Analysis\n            </Button>\n            <p className=\"text-sm text-muted-foreground mt-4\">\n              Analyzes all your conversations, journals, moods, and memories using AI\n            </p>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  if (generateMutation.isPending || isJobProcessing) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <DashboardNav />\n        <main className=\"max-w-5xl mx-auto px-6 py-8\">\n          <Card>\n            <CardContent className=\"py-16\">\n              <div className=\"text-center space-y-6\">\n                <Brain className=\"h-16 w-16 text-primary mx-auto animate-pulse\" />\n                <h2 className=\"text-2xl font-bold\">Analyzing Your Personality...</h2>\n                \n                {/* Progress bar */}\n                <div className=\"max-w-md mx-auto space-y-3\">\n                  <Progress value={jobProgress} className=\"h-3\" />\n                  <div className=\"flex justify-between text-sm text-muted-foreground\">\n                    <span>{currentSection}</span>\n                    <span>{jobProgress}%</span>\n                  </div>\n                </div>\n                \n                <p className=\"text-muted-foreground max-w-md mx-auto\">\n                  Using advanced AI to analyze all your conversations, journals, moods, and memories. \n                  This may take 3-5 minutes to complete a comprehensive psychological analysis.\n                </p>\n                \n                <div className=\"text-xs text-muted-foreground\">\n                  Generating {TIER_CONFIG[selectedTier].sections.length} sections sequentially to ensure high-quality analysis\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </main>\n      </div>\n    );\n  }\n\n  if (!reflection) return null;\n\n  // Check if user has a lower tier and might want to upgrade\n  const canUpgrade = reflection.tier === 'free' || reflection.tier === 'standard';\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <DashboardNav />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-8 space-y-4 sm:space-y-6 md:space-y-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row items-start justify-between gap-3 sm:gap-4\">\n          <div>\n            <div className=\"flex items-center gap-3 mb-1 sm:mb-2\">\n              <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold\" data-testid=\"text-reflection-title\">\n                Your Comprehensive Personality Reflection\n              </h1>\n              <Badge variant=\"default\" className=\"hidden sm:inline-flex\" data-testid=\"badge-current-tier\">\n                {TIER_CONFIG[reflection.tier].name}\n              </Badge>\n            </div>\n            <p className=\"text-xs sm:text-sm text-muted-foreground\">\n              Generated {new Date(reflection.createdAt).toLocaleDateString()} • Deep AI Analysis\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            {canUpgrade && (\n              <Dialog>\n                <DialogTrigger asChild>\n                  <Button \n                    variant=\"default\"\n                    size=\"sm\"\n                    className=\"sm:size-default w-full sm:w-auto\"\n                    data-testid=\"button-upgrade-tier\"\n                  >\n                    <TrendingUp className=\"mr-2 h-4 w-4\" />\n                    Upgrade Analysis\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n                  <DialogHeader>\n                    <DialogTitle>Upgrade Your Personality Analysis</DialogTitle>\n                    <DialogDescription>\n                      Choose a deeper level of analysis to unlock more insights\n                    </DialogDescription>\n                  </DialogHeader>\n                  \n                  <div className=\"grid md:grid-cols-3 gap-4 mt-4\">\n                    {(['free', 'standard', 'premium'] as const).map((tier) => {\n                      const config = TIER_CONFIG[tier];\n                      const isSelected = selectedTier === tier;\n                      const isCurrent = reflection.tier === tier;\n                      \n                      return (\n                        <Card \n                          key={tier}\n                          className={`relative cursor-pointer transition-all ${\n                            isSelected ? 'ring-2 ring-primary' : ''\n                          } ${isCurrent ? 'opacity-60' : ''}`}\n                          onClick={() => !isCurrent && setSelectedTier(tier)}\n                          data-testid={`card-tier-${tier}`}\n                        >\n                          {isCurrent && (\n                            <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                              <Badge variant=\"secondary\" data-testid={`badge-current-${tier}`}>\n                                Current Tier\n                              </Badge>\n                            </div>\n                          )}\n                          {isSelected && !isCurrent && (\n                            <div className=\"absolute -top-3 left-1/2 -translate-x-1/2\">\n                              <Badge variant=\"default\" className=\"bg-primary\" data-testid={`badge-selected-${tier}`}>\n                                <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                                Selected\n                              </Badge>\n                            </div>\n                          )}\n                          <CardHeader>\n                            <CardTitle className=\"flex items-center justify-between text-base\">\n                              <span data-testid={`text-tier-name-${tier}`}>{config.name}</span>\n                              <Badge variant={tier === 'free' ? 'secondary' : 'default'} data-testid={`badge-price-${tier}`}>\n                                {config.price}\n                              </Badge>\n                            </CardTitle>\n                            <CardDescription data-testid={`text-tier-sections-${tier}`}>\n                              {config.sections.length} analysis sections\n                            </CardDescription>\n                          </CardHeader>\n                          <CardContent className=\"space-y-2\">\n                            <div className=\"text-xs text-muted-foreground space-y-1\">\n                              {tier === 'free' && (\n                                <>\n                                  <p>• Behavioral Patterns</p>\n                                  <p>• Growth Areas</p>\n                                </>\n                              )}\n                              {tier === 'standard' && (\n                                <>\n                                  <p>• Everything in Free</p>\n                                  <p>• Emotional Patterns</p>\n                                  <p>• Relationship Dynamics</p>\n                                  <p>• Strengths & Blind Spots</p>\n                                </>\n                              )}\n                              {tier === 'premium' && (\n                                <>\n                                  <p>• Everything in Standard</p>\n                                  <p>• Coping Mechanisms</p>\n                                  <p>• Values & Beliefs</p>\n                                  <p>• Therapeutic Insights</p>\n                                  <p className=\"font-semibold text-primary\">• Holy Shit Moment ✨</p>\n                                </>\n                              )}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    })}\n                  </div>\n                  \n                  <div className=\"flex justify-end gap-3 mt-6\">\n                    <DialogClose asChild>\n                      <Button variant=\"outline\" data-testid=\"button-cancel-upgrade\">\n                        Cancel\n                      </Button>\n                    </DialogClose>\n                    <DialogClose asChild>\n                      <Button \n                        onClick={() => generateMutation.mutate()}\n                        disabled={selectedTier === reflection.tier}\n                        data-testid=\"button-confirm-upgrade\"\n                      >\n                        <Sparkles className=\"mr-2 h-4 w-4\" />\n                        Generate {TIER_CONFIG[selectedTier].name} Analysis\n                      </Button>\n                    </DialogClose>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            )}\n            <Button \n              onClick={() => generateMutation.mutate()}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"sm:size-default w-full sm:w-auto\"\n              data-testid=\"button-refresh-reflection\"\n            >\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n              Regenerate\n            </Button>\n          </div>\n        </div>\n\n        {/* Statistics Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4\">\n          <StatCard \n            icon={Brain}\n            label=\"Engagement Score\"\n            value={`${reflection.statistics?.engagementScore || 0}/100`}\n            description=\"Your interaction depth\"\n          />\n          <StatCard \n            icon={TrendingUp}\n            label=\"Journal Streak\"\n            value={`${reflection.statistics?.journalStreak || 0} days`}\n            description=\"Consecutive days\"\n          />\n          <StatCard \n            icon={Heart}\n            label=\"Avg Mood\"\n            value={(reflection.statistics?.averageMoodScore || 0).toFixed(1)}\n            description=\"Out of 10\"\n          />\n          <StatCard \n            icon={Lightbulb}\n            label=\"Memory Facts\"\n            value={reflection.statistics?.totalMemoryFacts || 0}\n            description=\"Extracted insights\"\n          />\n        </div>\n\n        {/* Archetype & Summary */}\n        <Card className=\"border-2 border-primary/20\">\n          <CardHeader className=\"p-4 sm:p-6\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"flex items-center gap-2 sm:gap-3\">\n                <Sparkles className=\"h-5 w-5 sm:h-6 sm:w-6 text-primary shrink-0\" />\n                <div>\n                  <CardTitle className=\"text-lg sm:text-xl md:text-2xl\">Your Personality Archetype</CardTitle>\n                  <CardDescription className=\"text-xs sm:text-sm\">Core identity and essence</CardDescription>\n                </div>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'archetype' ? \"default\" : \"ghost\"}\n                onClick={handlePlayArchetype}\n                data-testid=\"button-play-archetype\"\n                title={playingSection === 'archetype' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'archetype' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 sm:space-y-4 p-4 sm:p-6\">\n            <Badge variant=\"outline\" className=\"text-sm sm:text-base md:text-lg px-3 sm:px-4 py-1.5 sm:py-2\">\n              {reflection.coreTraits.archetype}\n            </Badge>\n            <p className=\"text-sm sm:text-base leading-relaxed whitespace-pre-line\">\n              {reflection.summary}\n            </p>\n            <div className=\"flex flex-wrap gap-1.5 sm:gap-2 pt-1 sm:pt-2\">\n              {reflection.coreTraits.dominantTraits.map((trait, i) => (\n                <Badge key={i} variant=\"secondary\" className=\"text-xs sm:text-sm\">{trait}</Badge>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Big 5 Personality Traits */}\n        <Card>\n          <CardHeader className=\"p-4 sm:p-6\">\n            <CardTitle className=\"flex items-center gap-2 text-base sm:text-lg md:text-xl\">\n              <Target className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n              Big 5 Personality Traits\n            </CardTitle>\n            <CardDescription className=\"text-xs sm:text-sm\">Scientific personality dimensions</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4 sm:space-y-6 p-4 sm:p-6\">\n            <Big5TraitBar label=\"Openness\" value={reflection.coreTraits.big5.openness} />\n            <Big5TraitBar label=\"Conscientiousness\" value={reflection.coreTraits.big5.conscientiousness} />\n            <Big5TraitBar label=\"Extraversion\" value={reflection.coreTraits.big5.extraversion} />\n            <Big5TraitBar label=\"Agreeableness\" value={reflection.coreTraits.big5.agreeableness} />\n            <Big5TraitBar label=\"Emotional Stability\" value={reflection.coreTraits.big5.emotionalStability} />\n          </CardContent>\n        </Card>\n\n        {/* Behavioral Patterns */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Zap className=\"h-5 w-5\" />\n                  Behavioral Patterns\n                </CardTitle>\n                <CardDescription>How you act and react in the world</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'behavioral' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('behavioral', `Behavioral Patterns:\\n${reflection.behavioralPatterns.map((p, i) => `${i + 1}. ${p}`).join('\\n')}`)}\n                data-testid=\"button-play-behavioral\"\n                title={playingSection === 'behavioral' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'behavioral' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {reflection.behavioralPatterns.map((pattern, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-3 rounded-md bg-secondary/50\">\n                  <CheckCircle2 className=\"h-5 w-5 text-primary flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{pattern}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Emotional Patterns */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Heart className=\"h-5 w-5\" />\n                  Emotional Patterns\n                </CardTitle>\n                <CardDescription>How you process and express feelings</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'emotional' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('emotional', `Emotional Patterns:\\n${reflection.emotionalPatterns.map((p, i) => `${i + 1}. ${p}`).join('\\n')}`)}\n                data-testid=\"button-play-emotional\"\n                title={playingSection === 'emotional' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'emotional' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {reflection.emotionalPatterns.map((pattern, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-3 rounded-md bg-secondary/50\">\n                  <Heart className=\"h-5 w-5 text-pink-500 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{pattern}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Relationship Dynamics */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5\" />\n                  Relationship Dynamics\n                </CardTitle>\n                <CardDescription>How you connect with others</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'relationships' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('relationships', `Relationship Dynamics:\\n${reflection.relationshipDynamics.map((d, i) => `${i + 1}. ${d}`).join('\\n')}`)}\n                data-testid=\"button-play-relationships\"\n                title={playingSection === 'relationships' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'relationships' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {reflection.relationshipDynamics.map((dynamic, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-3 rounded-md bg-secondary/50\">\n                  <Users className=\"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{dynamic}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Coping Mechanisms */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5\" />\n                  Coping Mechanisms\n                </CardTitle>\n                <CardDescription>How you handle stress and challenges</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'coping' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('coping', `Coping Mechanisms:\\n${reflection.copingMechanisms.map((m, i) => `${i + 1}. ${m}`).join('\\n')}`)}\n                data-testid=\"button-play-coping\"\n                title={playingSection === 'coping' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'coping' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {reflection.copingMechanisms.map((mechanism, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-3 rounded-md bg-secondary/50\">\n                  <Shield className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{mechanism}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid md:grid-cols-2 gap-4 sm:gap-6\">\n          {/* Strengths */}\n          <Card>\n            <CardHeader className=\"p-4 sm:p-6\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2 text-base sm:text-lg md:text-xl\">\n                    <Sparkles className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                    Strengths\n                  </CardTitle>\n                  <CardDescription className=\"text-xs sm:text-sm\">Your superpowers</CardDescription>\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant={playingSection === 'strengths' ? \"default\" : \"ghost\"}\n                  onClick={() => handlePlaySection('strengths', `Strengths:\\n${reflection.strengths.map((s, i) => `${i + 1}. ${s}`).join('\\n')}`)}\n                  data-testid=\"button-play-strengths\"\n                  title={playingSection === 'strengths' ? \"Stop reading\" : \"Read aloud\"}\n                >\n                  {playingSection === 'strengths' && isSpeaking ? (\n                    <VolumeX className=\"h-4 w-4\" />\n                  ) : (\n                    <Volume2 className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-4 sm:p-6\">\n              <ul className=\"space-y-1.5 sm:space-y-2\">\n                {reflection.strengths.map((strength, i) => (\n                  <li key={i} className=\"flex items-start gap-2 text-xs sm:text-sm\">\n                    <span className=\"text-primary font-bold shrink-0\">•</span>\n                    <span>{strength}</span>\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n\n          {/* Blind Spots */}\n          <Card>\n            <CardHeader className=\"p-4 sm:p-6\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2 text-base sm:text-lg md:text-xl\">\n                    <Eye className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                    Blind Spots\n                  </CardTitle>\n                  <CardDescription className=\"text-xs sm:text-sm\">What you can't see about yourself</CardDescription>\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant={playingSection === 'blindspots' ? \"default\" : \"ghost\"}\n                  onClick={() => handlePlaySection('blindspots', `Blind Spots:\\n${reflection.blindSpots.map((b, i) => `${i + 1}. ${b}`).join('\\n')}`)}\n                  data-testid=\"button-play-blindspots\"\n                  title={playingSection === 'blindspots' ? \"Stop reading\" : \"Read aloud\"}\n                >\n                  {playingSection === 'blindspots' && isSpeaking ? (\n                    <VolumeX className=\"h-4 w-4\" />\n                  ) : (\n                    <Volume2 className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-4 sm:p-6\">\n              <ul className=\"space-y-1.5 sm:space-y-2\">\n                {reflection.blindSpots.map((spot, i) => (\n                  <li key={i} className=\"flex items-start gap-2 text-xs sm:text-sm\">\n                    <span className=\"text-yellow-500 font-bold shrink-0\">•</span>\n                    <span>{spot}</span>\n                  </li>\n                ))}\n              </ul>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Growth Areas */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"h-5 w-5\" />\n                  Growth Areas\n                </CardTitle>\n                <CardDescription>Opportunities for development</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'growth' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('growth', `Growth Areas:\\n${reflection.growthAreas.map((a, i) => `${i + 1}. ${a}`).join('\\n')}`)}\n                data-testid=\"button-play-growth\"\n                title={playingSection === 'growth' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'growth' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {reflection.growthAreas.map((area, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-3 rounded-md bg-secondary/50\">\n                  <TrendingUp className=\"h-5 w-5 text-orange-500 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{area}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Values & Beliefs */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Lightbulb className=\"h-5 w-5\" />\n                  Values & Beliefs\n                </CardTitle>\n                <CardDescription>What drives your decisions</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'values' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('values', `Values and Beliefs:\\n${reflection.valuesAndBeliefs.map((v, i) => `${i + 1}. ${v}`).join('\\n')}`)}\n                data-testid=\"button-play-values\"\n                title={playingSection === 'values' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'values' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-2\">\n              {reflection.valuesAndBeliefs.map((value, i) => (\n                <li key={i} className=\"flex items-start gap-2 text-sm p-2 rounded-md bg-secondary/30\">\n                  <span className=\"text-primary font-bold\">→</span>\n                  <span>{value}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Therapeutic Insights */}\n        <Card className=\"border-2 border-purple-500/20\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-3\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Brain className=\"h-5 w-5 text-purple-500\" />\n                  Therapeutic Insights\n                </CardTitle>\n                <CardDescription>Deep psychological observations</CardDescription>\n              </div>\n              <Button\n                size=\"icon\"\n                variant={playingSection === 'therapeutic' ? \"default\" : \"ghost\"}\n                onClick={() => handlePlaySection('therapeutic', `Therapeutic Insights:\\n${reflection.therapeuticInsights.map((t, i) => `${i + 1}. ${t}`).join('\\n')}`)}\n                data-testid=\"button-play-therapeutic\"\n                title={playingSection === 'therapeutic' ? \"Stop reading\" : \"Read aloud\"}\n              >\n                {playingSection === 'therapeutic' && isSpeaking ? (\n                  <VolumeX className=\"h-4 w-4\" />\n                ) : (\n                  <Volume2 className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-4\">\n              {reflection.therapeuticInsights.map((insight, i) => (\n                <li key={i} className=\"flex items-start gap-3 p-4 rounded-md bg-purple-500/5 border border-purple-500/20\">\n                  <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-purple-500/20 flex items-center justify-center text-xs font-bold text-purple-700 dark:text-purple-300\">\n                    {i + 1}\n                  </div>\n                  <span className=\"text-sm leading-relaxed\">{insight}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        {/* Holy Shit Moment - THE core revelation */}\n        {reflection.holyShitMoment && (\n          <Card className=\"border-2 border-red-500/30 bg-red-500/5\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-3\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <AlertTriangle className=\"h-5 w-5 text-red-500\" />\n                    The Core Truth\n                  </CardTitle>\n                  <CardDescription>The organizing principle behind your patterns</CardDescription>\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant={playingSection === 'holyshit' ? \"default\" : \"ghost\"}\n                  onClick={() => handlePlaySection('holyshit', `The Core Truth:\\n${reflection.holyShitMoment}`)}\n                  data-testid=\"button-play-holyshit\"\n                  title={playingSection === 'holyshit' ? \"Stop reading\" : \"Read aloud\"}\n                >\n                  {playingSection === 'holyshit' && isSpeaking ? (\n                    <VolumeX className=\"h-4 w-4\" />\n                  ) : (\n                    <Volume2 className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"p-6 rounded-md bg-red-500/10 border border-red-500/30\">\n                <p className=\"text-base leading-relaxed font-medium\">{reflection.holyShitMoment}</p>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-3 italic\">\n                This insight connects the underlying patterns across all your behavioral, emotional, and relational dynamics.\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Growth Leverage Point - THE actionable intervention */}\n        {reflection.growthLeveragePoint && (\n          <Card className=\"border-2 border-green-500/30 bg-green-500/5\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-3\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Rocket className=\"h-5 w-5 text-green-500\" />\n                    Your Growth Leverage Point\n                  </CardTitle>\n                  <CardDescription>The counter-intuitive action that will move the needle</CardDescription>\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant={playingSection === 'leverage' ? \"default\" : \"ghost\"}\n                  onClick={() => handlePlaySection('leverage', `Your Growth Leverage Point:\\n${reflection.growthLeveragePoint}`)}\n                  data-testid=\"button-play-leverage\"\n                  title={playingSection === 'leverage' ? \"Stop reading\" : \"Read aloud\"}\n                >\n                  {playingSection === 'leverage' && isSpeaking ? (\n                    <VolumeX className=\"h-4 w-4\" />\n                  ) : (\n                    <Volume2 className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"p-6 rounded-md bg-green-500/10 border border-green-500/30\">\n                <p className=\"text-base leading-relaxed font-medium\">{reflection.growthLeveragePoint}</p>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-3 italic\">\n                This action directly targets your core pattern - not generic advice, but a specific intervention tailored to you.\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Data Sources */}\n        <Card className=\"bg-secondary/30\">\n          <CardHeader>\n            <CardTitle className=\"text-sm\">Analysis Data Sources</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs\">\n              <div>\n                <p className=\"font-semibold mb-1\">Conversations</p>\n                <p className=\"text-muted-foreground\">{reflection.statistics?.totalConversations || 0} total ({reflection.statistics?.totalMessages || 0} messages)</p>\n              </div>\n              <div>\n                <p className=\"font-semibold mb-1\">Journal Entries</p>\n                <p className=\"text-muted-foreground\">{reflection.statistics?.totalJournalEntries || 0} total</p>\n              </div>\n              <div>\n                <p className=\"font-semibold mb-1\">Mood Entries</p>\n                <p className=\"text-muted-foreground\">{reflection.statistics?.totalMoodEntries || 0} total</p>\n              </div>\n              <div>\n                <p className=\"font-semibold mb-1\">Memory Facts</p>\n                <p className=\"text-muted-foreground\">{reflection.statistics?.totalMemoryFacts || 0} extracted</p>\n              </div>\n            </div>\n            {reflection.statistics?.mostCommonEmotions && reflection.statistics.mostCommonEmotions.length > 0 && (\n              <div className=\"mt-4 pt-4 border-t\">\n                <p className=\"text-xs font-semibold mb-2\">Most Common Emotions</p>\n                <div className=\"flex flex-wrap gap-1\">\n                  {reflection.statistics.mostCommonEmotions.map((emotion, i) => (\n                    <Badge key={i} variant=\"outline\" className=\"text-xs\">{emotion}</Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":52009,"size_tokens":null},"client/src/hooks/useSpeechRecognition.ts":{"content":"import { useState, useEffect, useRef, useCallback } from 'react';\n\ninterface SpeechRecognitionEvent extends Event {\n  results: SpeechRecognitionResultList;\n  resultIndex: number;\n}\n\ninterface SpeechRecognitionErrorEvent extends Event {\n  error: string;\n  message: string;\n}\n\ninterface SpeechRecognitionInstance extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start(): void;\n  stop(): void;\n  abort(): void;\n}\n\ninterface SpeechRecognitionStatic {\n  new(): SpeechRecognitionInstance;\n}\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: SpeechRecognitionStatic;\n    webkitSpeechRecognition: SpeechRecognitionStatic;\n  }\n}\n\nexport function useSpeechRecognition() {\n  const [isListening, setIsListening] = useState(false);\n  const [transcript, setTranscript] = useState('');\n  const [interimTranscript, setInterimTranscript] = useState('');\n  const [isSupported, setIsSupported] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const recognitionRef = useRef<SpeechRecognitionInstance | null>(null);\n\n  useEffect(() => {\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    \n    if (SpeechRecognition) {\n      setIsSupported(true);\n      const recognition = new SpeechRecognition();\n      recognition.continuous = true;\n      recognition.interimResults = true;\n      recognition.lang = 'en-US';\n\n      recognition.addEventListener('result', (event: Event) => {\n        const speechEvent = event as SpeechRecognitionEvent;\n        let interim = '';\n        let final = '';\n\n        for (let i = speechEvent.resultIndex; i < speechEvent.results.length; i++) {\n          const transcript = speechEvent.results[i][0].transcript;\n          if (speechEvent.results[i].isFinal) {\n            final += transcript + ' ';\n          } else {\n            interim += transcript;\n          }\n        }\n\n        setInterimTranscript(interim);\n        if (final) {\n          setTranscript(prev => prev + final);\n        }\n      });\n\n      recognition.addEventListener('error', (event: Event) => {\n        const errorEvent = event as SpeechRecognitionErrorEvent;\n        console.error('Speech recognition error:', errorEvent.error);\n        setError(errorEvent.error || 'Speech recognition failed');\n        setIsListening(false);\n      });\n\n      recognition.addEventListener('end', () => {\n        setIsListening(false);\n      });\n\n      recognitionRef.current = recognition;\n    }\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.abort();\n      }\n    };\n  }, []);\n\n  const startListening = useCallback(() => {\n    if (recognitionRef.current && !isListening) {\n      setTranscript('');\n      setInterimTranscript('');\n      setError(null);\n      recognitionRef.current.start();\n      setIsListening(true);\n    }\n  }, [isListening]);\n\n  const stopListening = useCallback(() => {\n    if (recognitionRef.current && isListening) {\n      recognitionRef.current.stop();\n      setIsListening(false);\n    }\n  }, [isListening]);\n\n  const resetTranscript = useCallback(() => {\n    setTranscript('');\n    setInterimTranscript('');\n  }, []);\n\n  return {\n    isListening,\n    transcript,\n    interimTranscript,\n    isSupported,\n    error,\n    startListening,\n    stopListening,\n    resetTranscript,\n  };\n}\n","path":null,"size_bytes":3336,"size_tokens":null},"server/comprehensive-analytics.ts":{"content":"import OpenAI from \"openai\";\nimport { storage } from \"./storage\";\nimport type { MemoryFact, Message, JournalEntry, MoodEntry } from \"@shared/schema\";\n\n// Prioritize direct OPENAI_API_KEY for unfiltered access\nconst apiKey = process.env.OPENAI_API_KEY ?? process.env.AI_INTEGRATIONS_OPENAI_API_KEY;\nconst openai = new OpenAI({\n  apiKey,\n  // Only use baseURL if using Replit integration\n  baseURL: process.env.OPENAI_API_KEY ? undefined : process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\ninterface ComprehensiveProfile {\n  summary: string;\n  coreTraits: {\n    big5: {\n      openness: number;\n      conscientiousness: number;\n      extraversion: number;\n      agreeableness: number;\n      emotionalStability: number;\n    };\n    archetype: string;\n    dominantTraits: string[];\n  };\n  behavioralPatterns: string[];\n  emotionalPatterns: string[];\n  relationshipDynamics: string[];\n  copingMechanisms: string[];\n  growthAreas: string[];\n  strengths: string[];\n  blindSpots: string[];\n  valuesAndBeliefs: string[];\n  therapeuticInsights: string[];\n  holyShitMoment?: string;\n  growthLeveragePoint?: string;\n  statistics: {\n    totalConversations: number;\n    totalMessages: number;\n    totalJournalEntries: number;\n    totalMoodEntries: number;\n    totalMemoryFacts: number;\n    averageMoodScore: number;\n    journalStreak: number;\n    mostCommonEmotions: string[];\n    mostActiveCategories: string[];\n    engagementScore: number;\n  };\n}\n\n// Tier configuration\nconst TIER_CONFIG = {\n  free: {\n    sections: ['behavioralPatterns', 'growthAreas'],\n    includesHolyShit: false,\n    name: 'Starter Insights'\n  },\n  standard: {\n    sections: ['behavioralPatterns', 'emotionalPatterns', 'relationshipDynamics', 'growthAreas', 'strengths', 'blindSpots'],\n    includesHolyShit: false,\n    name: 'Deep Dive'\n  },\n  premium: {\n    sections: ['behavioralPatterns', 'emotionalPatterns', 'relationshipDynamics', 'copingMechanisms', 'growthAreas', 'strengths', 'blindSpots', 'valuesAndBeliefs', 'therapeuticInsights'],\n    includesHolyShit: true,\n    name: 'Devastating Truth'\n  }\n} as const;\n\nexport type AnalysisTier = keyof typeof TIER_CONFIG;\n\n// Few-shot examples for devastating analysis\nconst FEW_SHOT_EXAMPLES = {\n  blindSpot: `❌ BAD: \"You struggle with anxiety because you mention feeling anxious often\"\n✅ GOOD: \"You claim to value independence yet make every significant decision based on anticipating others' approval—dependency is invisible to you because you've reframed it as 'being considerate.' Evidence across conversations and journals: delayed career change by 2 years waiting for partner's approval, chose apartment based on friends' reactions not your own needs, describes autonomous decisions as 'selfish.' The performance of independence hides complete reliance on external validation.\"`,\n\n  behavioralPattern: `❌ BAD: \"When you get stressed, you tend to withdraw and need alone time\"\n✅ GOOD: \"[TRIGGER] When praised publicly → [ACTION] minimizes achievement within seconds ('it was nothing', deflects to others) → [CONSEQUENCE] prevents genuine acknowledgment from landing, reinforces belief that achievements don't matter, others get credit. Pattern appears in conversations, journals, and mood notes. This isn't humility—it's a sophisticated pre-emptive strike against disappointment (Defectiveness schema). You can't lose what you never claimed.\"`,\n\n  emotionalPattern: `❌ BAD: \"You have difficulty regulating emotions when criticized\"\n✅ GOOD: \"[APPRAISAL] Interprets neutral feedback as complete rejection → [RESPONSE] shame spiral lasting 2-3 days, catastrophizing about competence → [REGULATION] isolates completely, then over-prepares obsessively before next interaction. Pattern seen in journals, moods, and conversations. Emotional dysregulation isn't random—it's alexithymia (can't differentiate shame from fear from sadness). You're not over-sensitive; you're under-differentiated.\"`,\n\n  relationshipDynamic: `❌ BAD: \"You have an anxious attachment style that affects your relationships\"\n✅ GOOD: \"Classic anxious-preoccupied pattern: When partner is slow to respond, escalates contact (texts every 30min), then feels 'too much' and withdraws in shame. The protest-shame cycle. But here's the blind spot: You've specifically selected partners who reward this pattern—they need your pursuit to feel desired, then punish the intensity they created. You're drawn to avoidant partners who confirm your belief that love requires constant performance (Emotional Deprivation schema).\"`,\n\n  copingMechanism: `❌ BAD: \"You use humor as a coping mechanism when things get hard\"\n✅ GOOD: \"Intellectualization defense activates immediately when emotional content emerges: shifts to abstract analysis, quotes research, uses technical language. Pattern seen in conversations and journals. Adaptive in work contexts (allows clear thinking under pressure), maladaptive in intimacy (partner reports feeling 'locked out' when vulnerable). The defense protects a part that learned emotions = danger. You're not emotionally avoidant—you're employing a mature defense that's outlived its usefulness.\"`,\n\n  strength: `❌ BAD: \"You're good at problem-solving and helping others\"\n✅ GOOD: \"Exceptional pattern recognition: detects relationship shifts 2-3 weeks before others notice (accurately predicted multiple friend conflicts in journal entries) but systematically dismisses this as 'overthinking' or 'being paranoid.' This isn't anxiety—it's genuinely sophisticated social intelligence you've been trained to distrust. The dismissal protects against the risk of being labeled 'too much' but costs you the ability to act on accurate intuitions.\"`,\n\n  therapeuticInsight: `❌ BAD: \"Working on self-compassion could help you be kinder to yourself\"\n✅ GOOD: \"Your perfectionism isn't about achievement—it's hypervigilance designed to prevent abandonment. Core belief: 'If I'm flawed, I'm unlovable' (Defectiveness schema). Evidence: mood crashes after ANY mistake even minor ones, relationships end when you feel 'truly seen' (sabotage pattern), describes genuine self as 'disappointing' in conversations. The perfectionist isn't trying to excel; it's a protector part (IFS) desperately preventing the Defective Exile from being exposed. Therapy direction: parts work to negotiate with the perfectionist, not eliminate it.\"`\n};\n\nexport class ComprehensiveAnalytics {\n  async generatePersonalityProfile(\n    userId: string, \n    tier: AnalysisTier = 'free',\n    onProgress?: (progress: number, currentSection: string) => Promise<void>\n  ): Promise<ComprehensiveProfile | null> {\n    try {\n      // Report initial progress\n      if (onProgress) await onProgress(5, 'Gathering your data...');\n      \n      // Gather ALL data sources\n      const conversations = await storage.getConversationsByUserId(userId);\n      const journalEntries = await storage.getJournalEntriesByUserId(userId);\n      const moodEntries = await storage.getMoodEntriesByUserId(userId);\n      const memoryFacts = await storage.getMemoryFactsByUserId(userId);\n      \n      // DEBUG: Log what we fetched\n      console.log('[COMPREHENSIVE-ANALYTICS] Data fetched for userId:', userId);\n      console.log('[COMPREHENSIVE-ANALYTICS] Conversations:', conversations.length);\n      console.log('[COMPREHENSIVE-ANALYTICS] Journal entries:', journalEntries.length);\n      console.log('[COMPREHENSIVE-ANALYTICS] Mood entries:', moodEntries.length);\n      console.log('[COMPREHENSIVE-ANALYTICS] Memory facts:', memoryFacts.length);\n      \n      if (onProgress) await onProgress(10, 'Processing conversations...');\n      \n      // Collect all messages from conversations\n      let allMessages: Message[] = [];\n      for (const conv of conversations) {\n        const msgs = await storage.getMessagesByConversationId(conv.id);\n        console.log(`[COMPREHENSIVE-ANALYTICS] Conversation ${conv.id} has ${msgs.length} messages`);\n        allMessages = allMessages.concat(msgs);\n      }\n      console.log('[COMPREHENSIVE-ANALYTICS] Total messages:', allMessages.length);\n\n      // Calculate statistics\n      const statistics = this.calculateStatistics(\n        conversations,\n        allMessages,\n        journalEntries,\n        moodEntries,\n        memoryFacts\n      );\n\n      // If not enough data, return null\n      if (allMessages.length < 10 && journalEntries.length < 3) {\n        return null;\n      }\n\n      if (onProgress) await onProgress(15, 'Starting deep analysis...');\n\n      // Prepare comprehensive context for AI analysis using multi-pass generation\n      const profile = await this.analyzeWithMultiPass(\n        allMessages,\n        journalEntries,\n        moodEntries,\n        memoryFacts,\n        statistics,\n        tier,\n        onProgress\n      );\n\n      return profile;\n    } catch (error) {\n      console.error(\"Error generating comprehensive profile:\", error);\n      // Re-throw OpenAI errors so routes can handle them properly\n      if (error && typeof error === 'object' && 'status' in error) {\n        throw error;\n      }\n      return null;\n    }\n  }\n\n  private calculateStatistics(\n    conversations: any[],\n    messages: Message[],\n    journalEntries: JournalEntry[],\n    moodEntries: MoodEntry[],\n    memoryFacts: MemoryFact[]\n  ) {\n    // Calculate average mood\n    const avgMood = moodEntries.length > 0\n      ? moodEntries.reduce((sum, m) => sum + m.intensity, 0) / moodEntries.length\n      : 0;\n\n    // Calculate journal streak\n    const journalStreak = this.calculateStreak(journalEntries.map(j => j.createdAt));\n\n    // Find most common emotions from mood entries\n    const moodCounts = new Map<string, number>();\n    moodEntries.forEach(m => {\n      moodCounts.set(m.mood, (moodCounts.get(m.mood) || 0) + 1);\n    });\n    const mostCommonEmotions = Array.from(moodCounts.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([mood]) => mood);\n\n    // Find most active fact categories\n    const categoryCounts = new Map<string, number>();\n    memoryFacts.forEach(f => {\n      categoryCounts.set(f.category, (categoryCounts.get(f.category) || 0) + 1);\n    });\n    const mostActiveCategories = Array.from(categoryCounts.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([category]) => category);\n\n    // Calculate engagement score (0-100)\n    const engagementScore = Math.min(100, Math.round(\n      (conversations.length * 10) +\n      (journalEntries.length * 15) +\n      (moodEntries.length * 5) +\n      (memoryFacts.length * 2)\n    ));\n\n    return {\n      totalConversations: conversations.length,\n      totalMessages: messages.length,\n      totalJournalEntries: journalEntries.length,\n      totalMoodEntries: moodEntries.length,\n      totalMemoryFacts: memoryFacts.length,\n      averageMoodScore: Math.round(avgMood * 10) / 10,\n      journalStreak,\n      mostCommonEmotions,\n      mostActiveCategories,\n      engagementScore,\n    };\n  }\n\n  private calculateStreak(dates: Date[]): number {\n    if (dates.length === 0) return 0;\n\n    const sortedDates = dates\n      .map(d => new Date(d).setHours(0, 0, 0, 0))\n      .sort((a, b) => b - a);\n\n    let streak = 1;\n    const oneDayMs = 24 * 60 * 60 * 1000;\n\n    for (let i = 0; i < sortedDates.length - 1; i++) {\n      const dayDiff = (sortedDates[i] - sortedDates[i + 1]) / oneDayMs;\n      if (dayDiff === 1) {\n        streak++;\n      } else if (dayDiff > 1) {\n        break;\n      }\n    }\n\n    return streak;\n  }\n\n  // Calculate text overlap between two strings (returns 0-1 similarity score)\n  private calculateTextOverlap(str1: string, str2: string): number {\n    // Type safety: ensure both inputs are strings\n    if (!str1 || !str2 || typeof str1 !== 'string' || typeof str2 !== 'string') return 0;\n    \n    // Simple word-based Jaccard similarity\n    const words1 = new Set(str1.toLowerCase().split(/\\s+/).filter(w => w.length > 3));\n    const words2 = new Set(str2.toLowerCase().split(/\\s+/).filter(w => w.length > 3));\n    \n    const intersection = new Set(Array.from(words1).filter(w => words2.has(w)));\n    const union = new Set(Array.from(words1).concat(Array.from(words2)));\n    \n    return union.size > 0 ? intersection.size / union.size : 0;\n  }\n\n  private async analyzeWithMultiPass(\n    messages: Message[],\n    journals: JournalEntry[],\n    moods: MoodEntry[],\n    facts: MemoryFact[],\n    statistics: any,\n    tier: AnalysisTier,\n    onProgress?: (progress: number, currentSection: string) => Promise<void>\n  ): Promise<ComprehensiveProfile> {\n    console.log(`[MULTI-PASS] Starting ${TIER_CONFIG[tier].name} analysis (${TIER_CONFIG[tier].sections.length} sections)...`);\n    \n    // Prepare shared context for all sections\n    const context = this.prepareAnalysisContext(messages, journals, moods, facts, statistics);\n    \n    if (onProgress) await onProgress(20, 'Analyzing core personality traits...');\n    \n    // Generate core traits and summary first (always included)\n    const coreAnalysis = await this.generateCoreAnalysis(context);\n    \n    // Generate each section based on tier\n    const enabledSections = TIER_CONFIG[tier].sections;\n    \n    // Initialize ALL sections to empty arrays to satisfy NOT NULL schema constraints\n    const profile: any = {\n      summary: coreAnalysis.summary,\n      coreTraits: coreAnalysis.coreTraits,\n      statistics,\n      behavioralPatterns: [],\n      emotionalPatterns: [],\n      relationshipDynamics: [],\n      copingMechanisms: [],\n      growthAreas: [],\n      strengths: [],\n      blindSpots: [],\n      valuesAndBeliefs: [],\n      therapeuticInsights: [],\n      holyShitMoment: null,\n      growthLeveragePoint: null\n    };\n    \n    // Section display names for progress UI\n    const sectionDisplayNames: Record<string, string> = {\n      behavioralPatterns: 'Behavioral Patterns',\n      emotionalPatterns: 'Emotional Patterns',\n      relationshipDynamics: 'Relationship Dynamics',\n      copingMechanisms: 'Coping Mechanisms',\n      growthAreas: 'Growth Areas',\n      strengths: 'Strengths',\n      blindSpots: 'Blind Spots',\n      valuesAndBeliefs: 'Values & Beliefs',\n      therapeuticInsights: 'Therapeutic Insights'\n    };\n    \n    // Generate sections SEQUENTIALLY to avoid rate limits (30k tokens/min on free tier)\n    // Parallel generation causes all sections to hit rate limit and fall back to weak prompts\n    console.log('[MULTI-PASS] Generating sections sequentially to avoid rate limits...');\n    \n    const totalSections = enabledSections.length;\n    let failedSections = 0;\n    const failedSectionNames: string[] = [];\n    \n    for (let i = 0; i < enabledSections.length; i++) {\n      const sectionName = enabledSections[i];\n      const displayName = sectionDisplayNames[sectionName] || sectionName;\n      \n      // Progress: 25-85% range for section generation\n      const progressPercent = 25 + Math.round((i / totalSections) * 60);\n      if (onProgress) await onProgress(progressPercent, `Analyzing ${displayName}...`);\n      \n      console.log(`[MULTI-PASS] Generating ${sectionName}...`);\n      const insights = await this.generateSectionWithRetry(sectionName, context);\n      profile[sectionName] = insights;\n      \n      // Track failures - section is considered failed if it only has a fallback message\n      const isFailed = insights.length === 1 && insights[0].startsWith('Analysis unavailable');\n      if (isFailed) {\n        failedSections++;\n        failedSectionNames.push(displayName);\n        console.error(`[MULTI-PASS] Section ${sectionName} FAILED - added to failure count`);\n      }\n      \n      // Small delay between sections to respect rate limits\n      await new Promise(resolve => setTimeout(resolve, 1000));\n    }\n    \n    // Quality check: If more than half of sections failed, throw error\n    const failureThreshold = Math.ceil(totalSections / 2);\n    if (failedSections >= failureThreshold) {\n      const errorMsg = `Too many sections failed to generate (${failedSections}/${totalSections}): ${failedSectionNames.join(', ')}. This may indicate an API issue or insufficient data.`;\n      console.error(`[MULTI-PASS] ${errorMsg}`);\n      throw new Error(errorMsg);\n    }\n    \n    if (failedSections > 0) {\n      console.warn(`[MULTI-PASS] ${failedSections}/${totalSections} sections had issues but continuing with partial analysis`);\n    }\n    \n    // CROSS-SECTION DUPLICATE DETECTION (enforces anti-echo across entire analysis)\n    console.log('[MULTI-PASS] Running cross-section duplicate detection...');\n    const allInsights: Array<{section: string, insight: string, index: number}> = [];\n    \n    // Collect all insights from all sections\n    for (const sectionName of enabledSections) {\n      const insights = profile[sectionName] || [];\n      insights.forEach((insight: string, index: number) => {\n        allInsights.push({ section: sectionName, insight, index });\n      });\n    }\n    \n    // Check for cross-section duplicates\n    const duplicatePairs: Array<{section1: string, section2: string, overlap: number}> = [];\n    for (let i = 0; i < allInsights.length; i++) {\n      for (let j = i + 1; j < allInsights.length; j++) {\n        if (allInsights[i].section !== allInsights[j].section) {  // Only check across sections\n          const overlap = this.calculateTextOverlap(allInsights[i].insight, allInsights[j].insight);\n          if (overlap > 0.6) {\n            duplicatePairs.push({\n              section1: allInsights[i].section,\n              section2: allInsights[j].section,\n              overlap\n            });\n            \n            // Remove the duplicate from the second section (keep first occurrence)\n            const section2Insights = profile[allInsights[j].section];\n            section2Insights.splice(allInsights[j].index, 1);\n            console.warn(`[CROSS-SECTION DEDUP] Removed duplicate between ${allInsights[i].section} and ${allInsights[j].section} (${Math.round(overlap * 100)}% overlap)`);\n          }\n        }\n      }\n    }\n    \n    if (duplicatePairs.length > 0) {\n      console.warn(`[CROSS-SECTION DEDUP] Found and removed ${duplicatePairs.length} cross-section duplicates`);\n    } else {\n      console.log('[CROSS-SECTION DEDUP] No cross-section duplicates detected');\n    }\n    \n    // Generate holy shit moment and leverage point for premium tier\n    if (TIER_CONFIG[tier].includesHolyShit) {\n      if (onProgress) await onProgress(90, 'Synthesizing your \"Holy Shit\" moment...');\n      const holyShit = await this.generateHolyShitMoment(context, profile);\n      profile.holyShitMoment = holyShit.holyShitMoment;\n      profile.growthLeveragePoint = holyShit.growthLeveragePoint;\n    }\n    \n    if (onProgress) await onProgress(95, 'Finalizing analysis...');\n    console.log('[MULTI-PASS] Analysis complete!');\n    return profile as ComprehensiveProfile;\n  }\n\n  private prepareAnalysisContext(\n    messages: Message[],\n    journals: JournalEntry[],\n    moods: MoodEntry[],\n    facts: MemoryFact[],\n    statistics: any\n  ) {\n    // ===== EVIDENCE ASSEMBLY (Reduced for free tier rate limits) =====\n    \n    // CONVERSATIONS: Recent message exchanges (reduced to 50 to save tokens)\n    const recentMessages = messages.slice(-50);\n    const conversationText = recentMessages\n      .map(m => `${m.role}: ${m.content.slice(0, 500)}`) // Truncate long messages\n      .join(\"\\n\");\n\n    // JOURNALS: Recent journal entries with dates (reduced to 10)\n    const recentJournals = journals.slice(-10);\n    const journalText = recentJournals\n      .map(j => {\n        const date = new Date(j.createdAt).toLocaleDateString();\n        return `Journal entry (${date}):\\n${j.content.slice(0, 800)}`; // Truncate long entries\n      })\n      .join(\"\\n\\n---\\n\\n\");\n\n    // MOODS: Recent mood entries with context (reduced to 20)\n    const recentMoods = moods.slice(-20);\n    const moodText = recentMoods\n      .map(m => {\n        const date = new Date(m.createdAt).toLocaleDateString();\n        return `Mood (${date}): ${m.mood} (${m.intensity}%)${m.note ? ` - ${m.note}` : ''}${m.activities && m.activities.length > 0 ? ` [${m.activities.join(', ')}]` : ''}`;\n      })\n      .join(\"\\n\");\n\n    // MEMORY FACTS: Organized by abstraction level\n    const factsByAbstraction: Record<string, any[]> = {\n      raw_fact: [],\n      inferred_belief: [],\n      defense_mechanism: [],\n      ifs_part: []\n    };\n\n    facts.forEach(fact => {\n      const level = fact.abstractionLevel || 'raw_fact';\n      if (!factsByAbstraction[level]) factsByAbstraction[level] = [];\n      factsByAbstraction[level].push(fact);\n    });\n\n    const factsText = Object.entries(factsByAbstraction)\n      .filter(([_, items]) => items.length > 0)\n      .map(([level, items]) => {\n        const label = level === 'raw_fact' ? 'OBSERVABLE FACTS' :\n                      level === 'inferred_belief' ? 'INFERRED BELIEFS' :\n                      level === 'defense_mechanism' ? 'DEFENSE MECHANISMS' :\n                      'IFS PARTS';\n        \n        const factList = items\n          .map(f => `${f.factContent} (${f.category}, confidence: ${f.confidence}%)`)\n          .join(\"\\n\");\n        \n        return `**${label}:**\\n${factList}`;\n      })\n      .join(\"\\n\\n\");\n\n    // CROSS-SOURCE SUMMARY: Aggregate patterns for triangulation\n    const crossSourceSummary = this.generateCrossSourceSummary(recentMessages, recentJournals, recentMoods, facts, statistics);\n\n    return {\n      conversationText,\n      journalText,\n      moodText,\n      factsText,\n      crossSourceSummary,\n      statistics,\n      // Metadata for validation\n      citationMeta: {\n        messageIds: recentMessages.map(m => m.id.slice(0, 8)),\n        journalIds: recentJournals.map(j => j.id.slice(0, 8)),\n        moodIds: recentMoods.map(m => m.id.slice(0, 8)),\n        factIds: facts.map(f => f.id.slice(0, 8))\n      }\n    };\n  }\n\n  // Generate cross-source evidence clusters for triangulation\n  private generateCrossSourceSummary(\n    messages: Message[],\n    journals: JournalEntry[],\n    moods: MoodEntry[],\n    facts: MemoryFact[],\n    statistics: any\n  ): string {\n    const summary = [];\n    \n    // Mood patterns over time\n    if (moods.length >= 3) {\n      const avgIntensity = moods.reduce((sum, m) => sum + m.intensity, 0) / moods.length;\n      const moodCounts: Record<string, number> = {};\n      moods.forEach(m => {\n        moodCounts[m.mood] = (moodCounts[m.mood] || 0) + 1;\n      });\n      const dominantMood = Object.entries(moodCounts).sort((a, b) => b[1] - a[1])[0];\n      \n      summary.push(`**MOOD TRENDS:** ${moods.length} entries, avg intensity ${Math.round(avgIntensity)}%, most common: ${dominantMood[0]} (${dominantMood[1]} times)`);\n    }\n    \n    // Conversation themes\n    if (messages.length >= 5) {\n      const userMessages = messages.filter(m => m.role === 'user');\n      summary.push(`**CONVERSATION ACTIVITY:** ${userMessages.length} user messages across ${messages.length} total exchanges`);\n    }\n    \n    // Journal consistency\n    if (journals.length >= 2) {\n      const dates = journals.map(j => new Date(j.createdAt).getTime());\n      const timeDiffs = [];\n      for (let i = 1; i < dates.length; i++) {\n        timeDiffs.push((dates[i] - dates[i-1]) / (1000 * 60 * 60 * 24)); // days\n      }\n      const avgDaysBetween = timeDiffs.length > 0 \n        ? Math.round(timeDiffs.reduce((a, b) => a + b, 0) / timeDiffs.length)\n        : 0;\n      summary.push(`**JOURNAL PATTERNS:** ${journals.length} entries, avg ${avgDaysBetween} days between entries`);\n    }\n    \n    // Memory fact distribution\n    if (facts.length > 0) {\n      const byCategory: Record<string, number> = {};\n      facts.forEach(f => {\n        byCategory[f.category] = (byCategory[f.category] || 0) + 1;\n      });\n      const topCategories = Object.entries(byCategory)\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 3)\n        .map(([cat, count]) => `${cat}(${count})`)\n        .join(', ');\n      summary.push(`**MEMORY FACTS:** ${facts.length} total, top categories: ${topCategories}`);\n    }\n    \n    return summary.length > 0 \n      ? `**CROSS-SOURCE PATTERNS:**\\n${summary.join('\\n')}`\n      : '';\n  }\n\n  private async generateCoreAnalysis(context: any) {\n    const prompt = `Analyze this person's personality and generate a summary + Big 5 traits.\n\nDATA:\n${context.conversationText ? `CONVERSATIONS:\\n${context.conversationText}\\n\\n` : ''}\n${context.journalText ? `JOURNALS:\\n${context.journalText}\\n\\n` : ''}\n${context.moodText ? `MOODS:\\n${context.moodText}\\n\\n` : ''}\n${context.factsText ? `MEMORY FACTS:\\n${context.factsText}\\n\\n` : ''}\n\nReturn JSON:\n{\n  \"summary\": \"3-4 paragraph narrative synthesizing their personality with specific evidence\",\n  \"coreTraits\": {\n    \"big5\": {\n      \"openness\": 0-100,\n      \"conscientiousness\": 0-100,\n      \"extraversion\": 0-100,\n      \"agreeableness\": 0-100,\n      \"emotionalStability\": 0-100\n    },\n    \"archetype\": \"Their core archetype based on evidence\",\n    \"dominantTraits\": [\"trait 1\", \"trait 2\", \"trait 3\"]\n  }\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: \"You are a clinical psychologist generating personality analysis based on user data.\" },\n        { role: \"user\", content: prompt }\n      ],\n      temperature: 0.7,\n      top_p: 0.95,\n      presence_penalty: 0.2,\n      frequency_penalty: 0.8,\n      max_tokens: 2000,\n      response_format: { type: \"json_object\" }\n    });\n\n    return JSON.parse(response.choices[0].message.content || \"{}\");\n  }\n\n  private async generateSectionWithRetry(sectionName: string, context: any, maxAttempts: number = 2): Promise<string[]> {\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n      try {\n        const insights = await this.generateSection(sectionName, context, attempt === maxAttempts);\n        \n        // SUCCESS: Check if we got enough insights\n        if (insights.length >= 6) {\n          if (attempt > 1) {\n            console.log(`[RETRY-SUCCESS] ${sectionName}: Got ${insights.length} insights on attempt ${attempt}`);\n          }\n          return insights;\n        }\n        \n        // UNDER-DELIVERED: Log and retry\n        if (attempt < maxAttempts) {\n          console.warn(`[RETRY] ${sectionName}: Only ${insights.length} insights on attempt ${attempt}, retrying with simplified prompt...`);\n        } else {\n          console.error(`[RETRY-FAILED] ${sectionName}: Still only ${insights.length} insights after ${maxAttempts} attempts`);\n          // If we have SOME insights, return them; if none, return explicit failure message\n          if (insights.length > 0) {\n            return insights;\n          } else {\n            return [`Analysis unavailable - insufficient data to generate meaningful ${sectionName} insights. More conversations, journal entries, or mood tracking needed.`];\n          }\n        }\n      } catch (error) {\n        console.error(`[RETRY-ERROR] ${sectionName}: Attempt ${attempt} failed:`, error);\n        if (attempt === maxAttempts) {\n          console.error(`[RETRY-FAILED] ${sectionName}: All ${maxAttempts} attempts failed, returning fallback message`);\n          return [`Analysis unavailable - technical error prevented ${sectionName} generation. Please try regenerating.`];\n        }\n        console.warn(`[RETRY] ${sectionName}: Retrying after error...`);\n      }\n    }\n    \n    // Final fallback (should never reach here)\n    return [`Analysis unavailable - unexpected error in ${sectionName} generation.`];\n  }\n\n  private async generateSectionSimplified(sectionName: string, context: any): Promise<string[]> {\n    console.log(`[SIMPLIFIED] ${sectionName}: Using high-urgency simplified prompt (retry path)...`);\n    \n    // Trim context to most recent/important evidence only\n    const trimmedContext = {\n      conversationText: context.conversationText ? context.conversationText.slice(0, 3000) : '',\n      journalText: context.journalText ? context.journalText.slice(0, 2000) : '',\n      moodText: context.moodText ? context.moodText.slice(0, 1000) : '',\n      factsText: context.factsText ? context.factsText.slice(0, 2000) : ''\n    };\n    \n    const simplifiedPrompt = `Generate exactly 8 brutally honest psychological insights for ${sectionName}. Zero tolerance for therapeutic language.\n\nDATA:\n${trimmedContext.conversationText ? `CONVERSATIONS:\\n${trimmedContext.conversationText}\\n\\n` : ''}\n${trimmedContext.journalText ? `JOURNALS:\\n${trimmedContext.journalText}\\n\\n` : ''}\n${trimmedContext.moodText ? `MOODS:\\n${trimmedContext.moodText}\\n\\n` : ''}\n${trimmedContext.factsText ? `FACTS:\\n${trimmedContext.factsText}\\n\\n` : ''}\n\nTONE REQUIREMENTS (MANDATORY):\n- ZERO hedging: NO \"might,\" \"perhaps,\" \"could be,\" \"sometimes,\" \"often\"\n- ZERO softening: NO \"understandable,\" \"many people,\" \"it's normal,\" \"valid\"\n- ZERO reassurance: NO \"you're aware,\" \"good that,\" \"strength\"\n- State facts like a pathologist reading an autopsy report: direct, clinical, unflinching\n- Goal: devastating truth, not comfortable therapy speak\n- Each insight must make them think \"holy shit, how did you know that?\"\n\nFORBIDDEN PHRASES (instant failure if used):\n❌ \"It sounds like you're feeling...\"\n❌ \"That must be hard\"\n❌ \"You're being hard on yourself\"\n❌ \"Your inner child\"\n❌ \"Self-care\"\n❌ \"Growth mindset\"\n\nQUALITY STANDARD:\nEvery insight must pass the test: \"Would a therapist hesitate to say this out loud?\" If comfortable or obvious, it's worthless.\n\nReturn JSON with exactly 8 insights: {\"insights\": [\"insight 1\", \"insight 2\", ... \"insight 8\"]}`;\n\n    const simplifiedSystemMessage = `You are an unforgiving clinical diagnostician delivering psychological findings. NO polite hedging. NO therapeutic reassurance. NO Instagram wisdom. State uncomfortable truths like reading a medical diagnosis: factual, direct, devastating. If you have nothing clinically significant to say, write \"Insufficient data for meaningful analysis\" instead of generic observations.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: simplifiedSystemMessage },\n        { role: \"user\", content: simplifiedPrompt }\n      ],\n      temperature: 0.85,\n      max_tokens: 2000,\n      response_format: { type: \"json_object\" }\n    });\n\n    const result = this.parseAIResponse(response.choices[0].message.content || \"{}\");\n    const insights = result.insights || [];\n    \n    console.log(`[SIMPLIFIED] ${sectionName}: Generated ${insights.length} insights via simplified path`);\n    return insights;\n  }\n\n  private async generateSection(sectionName: string, context: any, useSimplifiedPrompt: boolean = false): Promise<string[]> {\n    console.log(`[MULTI-PASS] Generating ${sectionName} (2-step process${useSimplifiedPrompt ? ', simplified prompt' : ''})...`);\n    \n    // SIMPLIFIED PROMPT PATH: Used for retries when full prompt failed\n    if (useSimplifiedPrompt) {\n      return this.generateSectionSimplified(sectionName, context);\n    }\n    \n    const sectionGuides = {\n      behavioralPatterns: {\n        format: '[TRIGGER] → [ACTION] → [CONSEQUENCE]',\n        focus: 'OBSERVABLE ACTIONS and behavioral chains',\n        example: 'When praised publicly (trigger), minimizes/deflects within seconds (action), prevents genuine acknowledgment and reinforces belief achievements don\\'t matter (consequence)',\n        fewShotExample: FEW_SHOT_EXAMPLES.behavioralPattern\n      },\n      emotionalPatterns: {\n        format: '[APPRAISAL] → [EMOTIONAL RESPONSE] → [REGULATION]',\n        focus: 'Emotion PROCESSING and regulation strategies',\n        example: 'Interprets neutral feedback as rejection (appraisal) → shame spiral lasting 2-3 days (response) → isolates and over-prepares before next interaction (regulation)',\n        fewShotExample: FEW_SHOT_EXAMPLES.emotionalPattern\n      },\n      relationshipDynamics: {\n        format: 'Attachment theory lens - connection patterns',\n        focus: 'HOW they connect, attachment style behaviors',\n        example: 'Anxious-preoccupied: texts excessively when slow response (protest), then withdraws in shame. Classic activate-deactivate cycle',\n        fewShotExample: FEW_SHOT_EXAMPLES.relationshipDynamic\n      },\n      copingMechanisms: {\n        format: 'Defense mechanisms - adaptive vs maladaptive',\n        focus: 'HOW they handle stress and emotional threats',\n        example: 'Intellectualization defense - shifts to abstract analysis when overwhelmed. Adaptive in work, maladaptive in intimacy',\n        fewShotExample: FEW_SHOT_EXAMPLES.copingMechanism\n      },\n      growthAreas: {\n        format: 'Specific development areas with evidence',\n        focus: 'Clear opportunities for growth',\n        example: 'Difficulty tolerating uncertainty leads to premature decisions - rushes closure before gathering info',\n        fewShotExample: FEW_SHOT_EXAMPLES.therapeuticInsight\n      },\n      strengths: {\n        format: 'Underutilized or unrecognized strengths',\n        focus: 'What they\\'re good at but dismiss or underuse',\n        example: 'Exceptional pattern recognition detects relationship shifts early, but dismisses it as \"overthinking\"',\n        fewShotExample: FEW_SHOT_EXAMPLES.strength\n      },\n      blindSpots: {\n        format: 'Self-perception gaps',\n        focus: 'What they can\\'t see about themselves',\n        example: 'Claims to value independence yet makes all decisions based on others\\' approval. Dependency is invisible, framed as \"being considerate\"',\n        fewShotExample: FEW_SHOT_EXAMPLES.blindSpot\n      },\n      valuesAndBeliefs: {\n        format: 'Implicit vs explicit values',\n        focus: 'What they ACTUALLY value vs what they SAY they value',\n        example: 'Says authenticity is paramount but performs \"palatable\" version in new relationships. Real value: acceptance > authenticity',\n        fewShotExample: FEW_SHOT_EXAMPLES.relationshipDynamic\n      },\n      therapeuticInsights: {\n        format: 'Clinical-grade \"holy shit\" revelations',\n        focus: 'Deep psychological insights using professional frameworks',\n        example: 'Perfectionism isn\\'t about achievement - it\\'s hypervigilance to prevent abandonment. When \"flawed\", believes they\\'re unlovable (defectiveness schema)',\n        fewShotExample: FEW_SHOT_EXAMPLES.therapeuticInsight\n      }\n    };\n\n    const guide = sectionGuides[sectionName as keyof typeof sectionGuides];\n    \n    // STEP 1: First pass - generate initial analysis\n    console.log(`[MULTI-PASS] ${sectionName}: First pass (initial generation)...`);\n    \n    const firstPassPrompt = `Generate 8-12 impactful psychological insights for: **${sectionName}**\n\nFORMAT: ${guide.format}\nFOCUS: ${guide.focus}\n\nFEW-SHOT EXAMPLE (this is the quality bar):\n${guide.fewShotExample}\n\nDATA:\n${context.conversationText ? `**CONVERSATIONS:**\\n${context.conversationText}\\n\\n` : ''}\n${context.journalText ? `**JOURNALS:**\\n${context.journalText}\\n\\n` : ''}\n${context.moodText ? `**MOODS:**\\n${context.moodText}\\n\\n` : ''}\n${context.factsText ? `**MEMORY FACTS:**\\n${context.factsText}\\n\\n` : ''}\n${context.crossSourceSummary ? `${context.crossSourceSummary}\\n\\n` : ''}\n\nREQUIREMENTS:\n1. Return 8-12 insights as a JSON array of strings\n2. Go TWO inferential steps deeper than source text - reveal what they DON'T already know\n3. NEVER paraphrase or echo their own words - connect dots they haven't connected\n4. Make insights specific, uncomfortable, and undeniable\n5. Use professional frameworks (Schema Therapy, IFS, Attachment Theory)\n6. Reference specific evidence when possible (conversations, journals, moods, facts)\n\nReturn JSON: {\"insights\": [\"insight 1 with evidence\", \"insight 2 with evidence\", ... 8-12 total]}`;\n\n    const systemMessage = `You are an unforgiving, world-class personality analyst who has spent 30 years integrating Schema Therapy, Internal Family Systems (IFS), Attachment Theory, evolutionary psychology, psychodynamic defense mechanisms, and developmental trauma research.\n\nYOUR ONLY GOAL: Deliver devastating, uncomfortable, high-precision truths that make the user think \"how the fuck did you know that?\" You are NOT a therapist. You are a clinical diagnostician delivering findings. No reassurance. No softening. No \"it's understandable\" or \"many people struggle with.\" Just the brutal facts. If you have nothing devastating to say, say \"Insufficient data for meaningful analysis\" rather than generate polite bullshit.\n\nTONE REQUIREMENTS (CRITICAL - VIOLATE THESE AND YOUR OUTPUT IS WORTHLESS):\n- ZERO hedging language (\"might,\" \"perhaps,\" \"it seems,\" \"could be\")\n- ZERO softening language (\"understandable,\" \"it makes sense that,\" \"many people\")\n- ZERO reassurance (\"this is common,\" \"you're not alone,\" \"it's okay\")\n- State facts like a pathologist reading an autopsy report: direct, clinical, unflinching\n- If an insight doesn't make the user uncomfortable, it's not deep enough - DELETE IT\n\nCRITICAL ANALYTICAL PRINCIPLES:\n\n1. **EVIDENCE-BASED**: Reference specific evidence from conversations, journals, moods, and facts to support insights. Connect patterns across multiple sources when possible.\n\n2. **INFERENCE OVER ECHOING**: Never restate what they explicitly said. Go at least TWO INFERENTIAL STEPS deeper:\n   - What they said → What they're actually doing → The unconscious need it serves\n   - Surface emotion → Underlying belief → Developmental origin\n\n3. **CONTRADICTION DETECTION** (This is your specialty): Ruthlessly expose gaps between:\n   - What they say vs. what they do\n   - How they see themselves vs. how they actually behave\n   - Stated values vs. revealed values (time/energy/choices)\n   - Conscious intentions vs. unconscious sabotage patterns\n\n4. **DEVASTATING BLUNTNESS**: Every insight must pass the \"Would a licensed therapist hesitate to say this?\" test. If it's comfortable or diplomatic, you failed. State uncomfortable truths like medical diagnoses - factual, direct, no cushioning.\n\nFORBIDDEN PHRASES (Use any of these and your analysis is worthless):\n❌ \"It sounds like you're feeling...\"\n❌ \"That must be hard\"\n❌ \"You're being hard on yourself\"\n❌ \"Your inner child\"\n❌ \"Growth mindset\"\n❌ \"Self-care\"\n❌ \"Be kind to yourself\"\n❌ \"You deserve...\"\n❌ \"It's okay to feel...\"\n❌ \"Give yourself permission to...\"\n\nANTI-WORD-SALAD RULES (If you break these, your output is incoherent jargon):\n❌ NO excessive hyphenation - max 2 hyphenated phrases per insight\n❌ NO run-on sentences - each insight must be 1-3 clear sentences with proper punctuation\n❌ NO jargon stacking - can't use more than 2 technical terms in a row without plain explanation\n❌ NO fake technical terms like \"Safety-regulation-like developmental schemas pre-installed defending\"\n❌ Each sentence MUST have clear subject-verb-object structure - not word soup\n❌ Use proper punctuation - periods, commas, not endless hyphens connecting random concepts\n\nWRITING STANDARD: Write like a skilled clinical therapist. Be precise, concise, and impactful - but always COHERENT.\n\nQUALITY THRESHOLD:\nEvery single insight must make them think \"how did you know that?\" - not \"I already knew that\". You're revealing patterns they cannot easily see about themselves. That's the standard.`;\n\n    const firstPassResponse = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: systemMessage },\n        { role: \"user\", content: firstPassPrompt }\n      ],\n      temperature: 0.8,\n      top_p: 0.95,  // Nucleus sampling for diverse vocabulary\n      presence_penalty: 0.2,  // Discourage repetitive topics\n      frequency_penalty: 0.8,  // Prevent repetition\n      max_tokens: 3000,\n      response_format: { type: \"json_object\" }\n    });\n\n    const firstPassResult = this.parseAIResponse(firstPassResponse.choices[0].message.content || \"{}\");\n    const firstPassInsights = firstPassResult.insights || [];\n    \n    // STEP 2: Second pass - senior supervisor critique and rewrite (ENFORCED REJECTION)\n    console.log(`[MULTI-PASS] ${sectionName}: Second pass (senior supervisor critique & rewrite)...`);\n    \n    const secondPassPrompt = `You are a ruthless senior clinical supervisor reviewing this first draft for ${sectionName}.\n\nFIRST DRAFT:\n${JSON.stringify(firstPassInsights, null, 2)}\n\nYOUR TASK: Reject ANY insight that contains polite, hedging, or reassuring language. This user wants BRUTAL TRUTH, not therapy speak.\n\nMANDATORY REJECTION CRITERIA:\n\n1. **TONE CHECK** (MOST IMPORTANT): Does it contain ANY softening/hedging language?\n   - Forbidden: \"might,\" \"perhaps,\" \"it seems,\" \"could be,\" \"understandable,\" \"it makes sense,\" \"many people,\" \"it's okay,\" \"you're not alone\"\n   - If ANY hedging detected → REWRITE as direct clinical statement or mark \"Insufficient depth\"\n   \n2. **ECHO CHECK**: Does it paraphrase the user's own words?\n   - If yes → REWRITE to connect dots they DIDN'T connect OR mark \"Insufficient depth\"\n   \n3. **REVELATION TEST**: Would the user think \"how did you know that?\" or \"I already knew that\"?\n   - If obvious/comfortable → REWRITE to be devastating OR mark \"Insufficient depth\"\n   \n4. **BLUNTNESS TEST**: Would a therapist hesitate to say this due to how harsh it sounds?\n   - If too gentle/diplomatic → REWRITE as brutal clinical diagnosis OR mark \"Insufficient depth\"\n   \n5. **WORD SALAD CHECK**: Is it grammatically coherent?\n   - If unclear → REWRITE with proper structure (max 2 hyphens, no run-ons) OR mark \"Insufficient depth\"\n   \n6. **DUPLICATE CHECK**: Does it overlap >60% with another insight?\n   - If duplicate → REMOVE\n\nREWRITE STANDARD: State uncomfortable truths like a pathologist reading an autopsy report - direct, factual, zero cushioning. If you can't make it devastating, mark it \"Insufficient depth.\"\n\nReturn JSON:\n{\n  \"insights\": [\"devastating rewritten insight 1\", \"kept insight 2 (already blunt)\", \"Insufficient depth — need more data\", ...],\n  \"rejectionCount\": <number rejected/rewritten>,\n  \"rejectionReasons\": [\"brief reason 1\", \"brief reason 2\", ...]\n}`;\n\n    const supervisorMessage = `You are a ruthless senior clinical supervisor who enforces ZERO tolerance for polite, hedging, or reassuring language. Your job is to transform insights into brutal clinical diagnoses. If an insight sounds like something a therapist would say to avoid hurting feelings, you REJECT it. The user wants devastating truth, not comfort.`;\n\n    const secondPassResponse = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: supervisorMessage },\n        { role: \"user\", content: secondPassPrompt }\n      ],\n      temperature: 0.9,  // Higher for more creative rewrites\n      top_p: 0.95,\n      presence_penalty: 0.2,\n      frequency_penalty: 0.8,\n      max_tokens: 3000,\n      response_format: { type: \"json_object\" }\n    });\n\n    const result = this.parseAIResponse(secondPassResponse.choices[0].message.content || \"{}\");\n    const insights = result.insights || [];\n    const rejectionCount = result.rejectionCount || 0;\n    const rejectionReasons = result.rejectionReasons || [];\n    \n    // LOG SUPERVISOR REJECTION METRICS\n    if (rejectionCount > 0) {\n      console.log(`[SUPERVISOR] ${sectionName}: Rejected/rewrote ${rejectionCount}/${firstPassInsights.length} insights (${Math.round(rejectionCount/firstPassInsights.length*100)}%)`);\n      if (rejectionReasons.length > 0) {\n        console.log(`[SUPERVISOR] Rejection reasons:`, rejectionReasons.slice(0, 3).join('; ')); // Log first 3 reasons\n      }\n    } else {\n      console.warn(`[SUPERVISOR] ${sectionName}: WARNING - Supervisor approved all insights without rejection. Quality gate may be too lenient.`);\n    }\n    \n    // QUALITY CONTROL: Remove duplicates and filter out explicit \"insufficient\" markers\n    const filteredInsights = insights.filter((insight: any) => \n      typeof insight === 'string' && \n      insight.trim().length > 0 &&\n      !insight.includes('Insufficient depth')\n    );\n    \n    const uniqueInsights = this.removeDuplicateInsights(filteredInsights);\n    \n    if (uniqueInsights.length < filteredInsights.length) {\n      console.warn(`[MULTI-PASS] ${sectionName}: Removed ${filteredInsights.length - uniqueInsights.length} duplicate insights (${uniqueInsights.length} unique)`);\n    } else {\n      console.log(`[MULTI-PASS] ${sectionName}: Generated ${uniqueInsights.length} unique insights`);\n    }\n    \n    return uniqueInsights;\n  }\n  \n  // Validate that insights contain proper cross-source citations\n  private validateCitations(insights: string[], citationMeta: any): { valid: string[], failed: string[], failureReasons: string[] } {\n    const valid: string[] = [];\n    const failed: string[] = [];\n    const failureReasons: string[] = [];\n    \n    for (const insight of insights) {\n      // Skip \"Insufficient depth\" markers - these are explicit admissions of low quality\n      if (typeof insight !== 'string' || insight.includes('Insufficient depth')) {\n        failed.push(insight);\n        failureReasons.push('Marked as insufficient depth');\n        continue;\n      }\n      \n      // Count citation types present\n      const hasMsgCite = /\\[MSG-[a-f0-9]{8}\\]/.test(insight);\n      const hasJournalCite = /\\[JOURNAL-[a-f0-9]{8}\\]/.test(insight);\n      const hasMoodCite = /\\[MOOD-[a-f0-9]{8}\\]/.test(insight);\n      const hasFactCite = /\\[FACT-[a-f0-9]{8}\\]/.test(insight);\n      \n      const citationTypes = [hasMsgCite, hasJournalCite, hasMoodCite, hasFactCite].filter(Boolean).length;\n      \n      // Count total citations (even if same type)\n      const totalCitations = (insight.match(/\\[(MSG|JOURNAL|MOOD|FACT)-[a-f0-9]{8}\\]/g) || []).length;\n      \n      // PREFER ≥2 different citation types, but accept 1 type if multiple citations from same type\n      if (citationTypes >= 2) {\n        valid.push(insight);\n      } else if (citationTypes === 1 && totalCitations >= 2) {\n        // Accept if at least 2 citations from same type (better than nothing)\n        valid.push(insight);\n      } else if (citationTypes === 1) {\n        failed.push(insight);\n        failureReasons.push(`Only 1 citation (need ≥2 for triangulation)`);\n      } else {\n        failed.push(insight);\n        failureReasons.push(`No valid citations found`);\n      }\n    }\n    \n    return { valid, failed, failureReasons };\n  }\n\n  // Remove duplicate insights using Jaccard similarity\n  private removeDuplicateInsights(insights: string[]): string[] {\n    const unique: string[] = [];\n    \n    for (const insight of insights) {\n      // Type safety: ensure insight is a string\n      if (typeof insight !== 'string' || !insight.trim()) {\n        console.warn('[DEDUP] Skipping non-string or empty insight:', typeof insight, insight);\n        continue;\n      }\n      \n      let isDuplicate = false;\n      \n      for (const existing of unique) {\n        const overlap = this.calculateTextOverlap(insight, existing);\n        if (overlap > 0.6) {  // >60% overlap = likely duplicate\n          isDuplicate = true;\n          break;\n        }\n      }\n      \n      if (!isDuplicate) {\n        unique.push(insight);\n      }\n    }\n    \n    return unique;\n  }\n\n  private async generateHolyShitMoment(context: any, profile: any) {\n    console.log('[MULTI-PASS] Generating Holy Shit Moment...');\n    \n    const prompt = `Based on ALL the insights below, identify THE single organizing principle that connects everything + ONE counter-intuitive action.\n\nINSIGHTS GENERATED:\n${JSON.stringify(profile, null, 2)}\n\nReturn JSON:\n{\n  \"holyShitMoment\": \"THE brutal, undeniable organizing principle connecting all patterns. Make it uncomfortable and revelatory.\",\n  \"growthLeveragePoint\": \"ONE counter-intuitive action targeting the core pattern (NOT generic advice like 'practice self-care')\"\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: \"You are a master psychologist identifying the core organizing principle in someone's personality.\" },\n        { role: \"user\", content: prompt }\n      ],\n      temperature: 0.9,\n      top_p: 0.95,\n      presence_penalty: 0.2,\n      frequency_penalty: 0.8,\n      max_tokens: 1000,\n      response_format: { type: \"json_object\" }\n    });\n\n    return this.parseAIResponse(response.choices[0].message.content || \"{}\");\n  }\n\n  // Helper: Robust JSON parsing that strips markdown code blocks and handles malformed JSON\n  private parseAIResponse(content: string): any {\n    let cleaned = content.trim();\n    \n    // Strip markdown code blocks if present (GPT-4o sometimes wraps JSON in ```json ... ```)\n    if (cleaned.startsWith('```')) {\n      cleaned = cleaned.replace(/^```(?:json)?\\s*\\n?/i, '').replace(/\\n?```\\s*$/i, '');\n    }\n    \n    try {\n      return JSON.parse(cleaned);\n    } catch (error) {\n      console.error('[JSON-PARSE-ERROR] Failed to parse AI response:', error);\n      console.error('[JSON-PARSE-ERROR] Content length:', cleaned.length);\n      console.error('[JSON-PARSE-ERROR] First 500 chars:', cleaned.substring(0, 500));\n      console.error('[JSON-PARSE-ERROR] Last 500 chars:', cleaned.substring(Math.max(0, cleaned.length - 500)));\n      \n      // Attempt to fix common JSON errors\n      try {\n        // Fix unterminated strings by adding closing quote if missing\n        let fixed = cleaned;\n        \n        // Count quotes to see if they're balanced\n        const quoteCount = (fixed.match(/\"/g) || []).length;\n        if (quoteCount % 2 !== 0) {\n          console.warn('[JSON-PARSE-ERROR] Unbalanced quotes detected, attempting to fix...');\n          // Try to find last complete object and close it\n          const lastBrace = fixed.lastIndexOf('}');\n          if (lastBrace > 0) {\n            fixed = fixed.substring(0, lastBrace + 1);\n          }\n        }\n        \n        return JSON.parse(fixed);\n      } catch (retryError) {\n        console.error('[JSON-PARSE-ERROR] Retry failed, returning empty object');\n        // Return empty structure to avoid crashing\n        return { insights: [] };\n      }\n    }\n  }\n\n  private async analyzeWithAI_LEGACY(\n    messages: Message[],\n    journals: JournalEntry[],\n    moods: MoodEntry[],\n    facts: MemoryFact[],\n    statistics: any\n  ): Promise<ComprehensiveProfile> {\n    const context = this.prepareAnalysisContext(messages, journals, moods, facts, statistics);\n\n    // System message defining role and analytical frameworks\n    const systemMessage = `You are an unforgiving, world-class personality analyst who has spent 30 years integrating Schema Therapy, Internal Family Systems (IFS), Attachment Theory, evolutionary psychology, psychodynamic defense mechanisms, and developmental trauma research.\n\nYOUR ONLY GOAL: Deliver non-obvious, uncomfortable, high-precision truths that the user has never articulated but will instantly recognize as correct. You prioritize \"holy shit\" moments over comfort. You are allergic to platitudes, affirmations, corporate-coaching jargon, and anything that sounds like it came from Instagram therapy. You never echo the user's own words back to them. You are brutally concise unless depth is required. If you have nothing new or deep to say, you say \"Insufficient data for meaningful analysis\" rather than bullshit.\n\nEXPERTISE AREAS:\n- Schema Therapy (identifying maladaptive schemas, coping modes, schema activation chains)\n- Internal Family Systems (recognizing parts, exiles, managers, firefighters, conflicts between parts)\n- Attachment Theory (anxious, avoidant, disorganized patterns in current relationships)\n- Defense Mechanisms (primitive vs. mature, when they serve vs. sabotage)\n- Cognitive-Behavioral patterns (automatic thoughts, core beliefs, thought-emotion-behavior chains)\n- Emotion Regulation Theory (adaptive vs. maladaptive strategies, alexithymia, emotional avoidance)\n- Developmental Psychology (childhood origins of current patterns)\n\nCRITICAL ANALYTICAL PRINCIPLES:\n\n1. **TRIANGULATION MANDATORY**: Each insight MUST cite evidence from at least 2 different data sources (conversations + journals, moods + facts, etc.). NO EXCEPTIONS.\n\n2. **INFERENCE OVER ECHOING**: Never restate what they explicitly said. Go at least TWO INFERENTIAL STEPS deeper:\n   - What they said → What they're actually doing → The unconscious need it serves\n   - Surface emotion → Underlying belief → Developmental origin\n\n3. **CONTRADICTION DETECTION** (This is your specialty): Ruthlessly expose gaps between:\n   - What they say vs. what they do\n   - How they see themselves vs. how they actually behave\n   - Stated values vs. revealed values (time/energy/choices)\n   - Conscious intentions vs. unconscious sabotage patterns\n\n4. **TEMPORAL PATTERNS**: Track evolution, cyclical repetition, deterioration, or improvement across time periods\n\n5. **NON-OBVIOUS INSIGHTS**: Every insight must pass the \"Would a licensed therapist be nervous to say this out loud?\" test. If it's comfortable or obvious, it's wrong.\n\nFORBIDDEN PHRASES (Use any of these and your analysis is worthless):\n❌ \"It sounds like you're feeling...\"\n❌ \"That must be hard\"\n❌ \"You're being hard on yourself\"\n❌ \"Your inner child\"\n❌ \"Growth mindset\"\n❌ \"Self-care\"\n❌ \"Be kind to yourself\"\n❌ \"You deserve...\"\n❌ \"It's okay to feel...\"\n❌ \"Give yourself permission to...\"\n\nANTI-ECHO GUARDRAILS:\n- ❌ BAD: \"You struggle with anxiety because you mention feeling anxious often\"\n- ✅ GOOD: \"Your anxiety is a hypervigilant protector part (IFS) serving an unmet safety need from childhood. Pattern: You catastrophize before positive events (sabotaging joy before it's 'taken away'), evidenced by your difficulty accepting compliments (journals 3/15, 3/18) and mood crashes after social success. This isn't random worry - it's a sophisticated emotional insurance policy against disappointment.\"\n\n- ❌ BAD: \"You value authenticity and want to be more genuine in relationships\"\n- ✅ GOOD: \"You claim authenticity is paramount but systematically perform a 'palatable' version of yourself in new relationships - editing humor, softening opinions, hiding intensity (conversation patterns show 2-3 day delay before revealing genuine reactions). Real priority: acceptance > authenticity. You'd rather be liked than known.\"\n\nQUALITY THRESHOLD:\nEvery single insight must make them think \"holy shit, how did you know that?\" - not \"yeah, I already knew that\". You're revealing patterns they CANNOT see about themselves. That's the bar.`;\n\n\n    const userPrompt = `Analyze this individual's psychology using ALL available data sources. Look for patterns they cannot see about themselves.\n\n=== CONVERSATIONS (Last 100 messages) ===\n${context.conversationText}\n\n=== JOURNAL ENTRIES (Last 20 entries) ===\n${context.journalText}\n\n=== MOOD TRACKING (Last 30 entries) ===\n${context.moodText}\n\n=== EXTRACTED FACTS (${facts.length} total facts) ===\n${context.factsText}\n\n=== STATISTICS ===\n${JSON.stringify(statistics, null, 2)}\n\n=== ANALYSIS REQUIREMENTS ===\n\n⚠️ CRITICAL: Each array section below MUST contain AT LEAST 8 specific, evidence-based insights (maximum 12). You will be penalized for returning fewer than 8 items per section.\n\nFor each section, provide actual psychological insights (NOT instructional text):\n\n**behavioralPatterns** (8-12 items): Format as [TRIGGER] → [ACTION] → [CONSEQUENCE]. Focus on OBSERVABLE ACTIONS. Example: \"When praised publicly (trigger), minimizes or deflects the compliment within seconds (action), preventing genuine acknowledgment and reinforcing belief that achievements don't matter (consequence) - evident in conversations 3/15, 3/22, journal 3/18\"\n\n**emotionalPatterns** (8-12 items): Format as [APPRAISAL] → [EMOTIONAL RESPONSE] → [REGULATION]. Focus on emotion PROCESSING. Example: \"Interprets neutral feedback as rejection (appraisal) → shame spiral lasting 2-3 days (response) → isolates and over-prepares before next interaction (regulation) - pattern in journals 3/12, 3/19, 4/02\"\n\n**relationshipDynamics** (8-12 items): Use ATTACHMENT THEORY lens. Focus on HOW they connect. Example: \"Anxious-preoccupied attachment: texts excessively when friend is slow to respond (protest behavior), then withdraws in shame. Classic activate-deactivate cycle seen in conversations 3/15\"\n\n**copingMechanisms** (8-12 items): Map to DEFENSE MECHANISMS. Categorize as adaptive vs maladaptive. Example: \"Intellectualization defense - shifts into abstract analysis when emotionally overwhelmed (journals 3/20, 4/01). Adaptive in work, maladaptive in intimate relationships\"\n\n**growthAreas** (8-12 items): Specific development areas with evidence. Example: \"Difficulty tolerating uncertainty leads to premature decision-making - rushes to closure before gathering sufficient information (3 instances in journals)\"\n\n**strengths** (8-12 items): Underutilized or unrecognized strengths with evidence. Example: \"Exceptional pattern recognition allows early detection of relationship shifts (conversation 3/15), but this strength is dismissed as 'overthinking'\"\n\n**blindSpots** (8-12 items): Self-perception gaps. Example: \"Claims to value independence yet makes all major decisions based on others' approval (journal 3/18: 'I chose X because everyone expected it'). The dependency is invisible, framed as 'being considerate'\"\n\n**valuesAndBeliefs** (8-12 items): Implicit vs explicit values. Example: \"Says authenticity is paramount but systematically performs 'palatable' version of self in new relationships (2-3 day delay before revealing genuine reactions). Real value: acceptance > authenticity\"\n\n**therapeuticInsights** (8-12 items): Profound 'holy shit' revelations. Example: \"Perfectionism isn't about achievement - it's a hypervigilant strategy to prevent abandonment. When 'flawed', believes they're unlovable (defectiveness schema). Evidence: sabotages relationships at first sign of intimacy (journals 3/12, 3/25, 4/03)\"\n\n**holyShitMoment** (single string): THE organizing principle connecting all patterns. Make it brutal and undeniable. Example: \"Your entire relational strategy is built on the belief that the real you is fundamentally unacceptable - so you've become a master at performing palatability while your authentic self suffocates in isolation\"\n\n**growthLeveragePoint** (single string): ONE counter-intuitive action targeting the core pattern. NOT generic advice. Example: \"Next time you feel the urge to people-please, deliberately disappoint someone in a small way and observe that the catastrophe you fear doesn't happen (exposure therapy for abandonment schema)\"\n\n⚠️ MANDATORY: Return valid JSON with 8-12 items in EVERY array field. Empty or short arrays will be rejected.\n\n{\n  \"summary\": \"3-4 paragraph narrative synthesizing their entire personality with specific evidence\",\n  \"coreTraits\": {\n    \"big5\": {\n      \"openness\": 75,\n      \"conscientiousness\": 65,\n      \"extraversion\": 45,\n      \"agreeableness\": 80,\n      \"emotionalStability\": 40\n    },\n    \"archetype\": \"Specific archetype based on their data\",\n    \"dominantTraits\": [\"trait 1 from evidence\", \"trait 2 from evidence\", \"trait 3 from evidence\"]\n  },\n  \"behavioralPatterns\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"emotionalPatterns\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"relationshipDynamics\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"copingMechanisms\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"growthAreas\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"strengths\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"blindSpots\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"valuesAndBeliefs\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"therapeuticInsights\": [\"item 1 with evidence\", \"item 2 with evidence\", \"... 8-12 total items\"],\n  \"holyShitMoment\": \"The single most brutal truth connecting all patterns - make it uncomfortable and undeniable\",\n  \"growthLeveragePoint\": \"ONE counter-intuitive action targeting the core pattern (NOT generic advice)\"\n}\n\nFINAL CRITICAL REQUIREMENTS:\n\n1. ⚠️ TRIANGULATION MANDATORY: Every single insight must cite evidence from at least 2 data sources (e.g., \"journals 3/15 + mood entry 3/16\" or \"conversation themes + journal pattern\")\n2. ⚠️ NO ECHOING: If they explicitly stated it, DON'T repeat it. Infer the underlying driver they can't see\n3. ⚠️ CONTRADICTION HUNTING: Actively search for gaps between:\n   - Self-description vs. actual behavior\n   - Stated intentions vs. outcomes\n   - Surface emotions vs. underlying needs\n4. ⚠️ TEMPORAL ANALYSIS: Note when patterns started, evolved, or repeat cyclically\n5. ⚠️ DEPTH REQUIREMENT: Each insight should make them think \"holy shit, how did you know that?\" - not \"yeah, I already knew that\"\n6. ⚠️ SPECIFICITY: Generic statements = failure. Every item needs specific dates, quotes, or behavioral instances\n7. ⚠️ DISTINCT SECTIONS: Behavioral ≠ Emotional ≠ Relational ≠ Coping. Use the specified analytical lenses to keep them separate\n8. ⚠️ QUANTITY: 8-12 items per array. Quality AND quantity both required.\n\nRemember: They can get surface-level feedback anywhere. You're here to reveal what they genuinely don't know about themselves.`;\n\n    try {\n      // STEP 1: First pass - generate initial analysis\n      console.log('[SINGLE-PASS AI] Generating comprehensive analysis...');\n      const firstPassCompletion = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          { role: \"system\", content: systemMessage },\n          { role: \"user\", content: userPrompt }\n        ],\n        temperature: 0.8,  // Higher for creative, non-templated insights\n        max_tokens: 16000,  // INCREASED: Need room for 9 sections × 8-12 items each\n        top_p: 0.95,  // Nucleus sampling for diverse vocabulary\n        presence_penalty: 0.2,  // Discourage repetitive topics/patterns\n        frequency_penalty: 0.8,  // Strongly discourage repetitive phrases/structures\n        response_format: { type: \"json_object\" }\n      });\n\n      const analysis = JSON.parse(firstPassCompletion.choices[0].message.content || \"{}\");\n      console.log('[SINGLE-PASS AI] Analysis complete. Preview:', {\n        behavioralPatterns: (analysis.behavioralPatterns || []).length,\n        emotionalPatterns: (analysis.emotionalPatterns || []).length,\n        relationshipDynamics: (analysis.relationshipDynamics || []).length,\n        copingMechanisms: (analysis.copingMechanisms || []).length,\n        growthAreas: (analysis.growthAreas || []).length,\n        strengths: (analysis.strengths || []).length,\n        blindSpots: (analysis.blindSpots || []).length,\n        valuesAndBeliefs: (analysis.valuesAndBeliefs || []).length,\n        therapeuticInsights: (analysis.therapeuticInsights || []).length,\n        hasHolyShitMoment: !!analysis.holyShitMoment,\n        hasGrowthLeveragePoint: !!analysis.growthLeveragePoint\n      });\n      console.log('[SINGLE-PASS AI] Analysis generation complete.');\n      \n      // Validate and enforce that we got the required depth (8-12 items per category)\n      const arrayFields = [\n        'behavioralPatterns', \n        'emotionalPatterns', \n        'relationshipDynamics', \n        'copingMechanisms',\n        'growthAreas',\n        'strengths',\n        'blindSpots',\n        'valuesAndBeliefs',\n        'therapeuticInsights'\n      ];\n\n      const validationIssues: string[] = [];\n      arrayFields.forEach(field => {\n        const arr = analysis[field] || [];\n        \n        // Temporarily lowered from 8 to 6 minimum while debugging AI compliance\n        if (arr.length < 6) {\n          validationIssues.push(`${field} has only ${arr.length} items (minimum 6 required)`);\n        } else if (arr.length > 12) {\n          // Truncate to 12 items and log warning\n          analysis[field] = arr.slice(0, 12);\n          validationIssues.push(`${field} had ${arr.length} items (truncated to 12)`);\n        }\n      });\n\n      // If any category has fewer than 6 items, reject the analysis\n      const criticalIssues = validationIssues.filter(issue => issue.includes('minimum'));\n      if (criticalIssues.length > 0) {\n        console.warn('⚠️ AI analysis below minimum depth (proceeding anyway):', criticalIssues);\n        // TEMPORARILY DISABLED - Accept whatever AI generates for debugging\n        // throw new Error(`Analysis does not meet minimum depth requirements. ${criticalIssues.join(', ')}`);\n      }\n\n      // ANTI-REPETITION VALIDATION: Check for duplicate insights across sections\n      const allInsights: string[] = [];\n      arrayFields.forEach(field => {\n        const arr = analysis[field] || [];\n        arr.forEach((item: string) => allInsights.push(item.toLowerCase()));\n      });\n\n      // Detect duplicates (case-insensitive substring matching)\n      let duplicateCount = 0;\n      for (let i = 0; i < allInsights.length; i++) {\n        for (let j = i + 1; j < allInsights.length; j++) {\n          const overlap = this.calculateTextOverlap(allInsights[i], allInsights[j]);\n          if (overlap > 0.6) {  // >60% overlap = likely duplicate\n            duplicateCount++;\n            validationIssues.push(`Duplicate insight detected: \"${allInsights[i].substring(0, 80)}...\" overlaps with \"${allInsights[j].substring(0, 80)}...\"`);\n          }\n        }\n      }\n\n      if (duplicateCount > 3) {\n        const errorMsg = `Analysis rejected: ${duplicateCount} duplicate/overlapping insights detected. Sections must be distinct.`;\n        console.error('[REPETITION GATE] AI analysis has too much repetition:', duplicateCount, 'duplicates found');\n        console.error('[REPETITION GATE] Validation issues:', validationIssues.slice(-5)); // Show last 5 duplicate examples\n        throw new Error(errorMsg);\n      }\n\n      if (validationIssues.length > 0) {\n        console.warn('AI analysis validation notices (non-blocking):', validationIssues);\n      }\n      \n      return {\n        ...analysis,\n        statistics\n      };\n    } catch (error) {\n      console.error(\"Error in AI analysis:\", error);\n      throw error;\n    }\n  }\n}\n\nexport const comprehensiveAnalytics = new ComprehensiveAnalytics();\n","path":null,"size_bytes":66169,"size_tokens":null},"server/categories.ts":{"content":"export interface Category {\n  id: string;\n  slug: string;\n  name: string;\n  description: string;\n  tier: 1 | 2 | 3;\n  isPremium: boolean;\n  sortOrder: number;\n  scoringCriteria: string;\n  journalPrompts: string[];\n  chatFocusAreas: string[];\n}\n\nexport const CATEGORIES: Category[] = [\n  {\n    id: \"1\",\n    slug: \"relationships-communication\",\n    name: \"Relationships & Communication\",\n    description: \"How effectively you connect with others, express yourself, and maintain healthy relationships\",\n    tier: 1,\n    isPremium: false,\n    sortOrder: 1,\n    scoringCriteria: `Evaluate based on:\n- Quality and depth of interpersonal connections mentioned\n- Clarity and effectiveness of communication patterns\n- Conflict resolution approaches\n- Empathy and active listening behaviors\n- Boundary setting and respect for others' boundaries\n- Consistency in maintaining relationships\nScore 0-100 where:\n- 0-30: Significant struggles with communication, frequent conflicts, isolation\n- 31-60: Some effective communication, occasional misunderstandings, working on relationships\n- 61-85: Generally strong communication, healthy relationships, minor areas for growth\n- 86-100: Excellent communication skills, deep meaningful connections, role model level`,\n    journalPrompts: [\n      \"How did you connect with someone meaningful today?\",\n      \"Describe a conversation that went particularly well or poorly - what made it that way?\",\n      \"What patterns do you notice in how you communicate when stressed?\"\n    ],\n    chatFocusAreas: [\n      \"Communication style and effectiveness\",\n      \"Relationship quality and depth\",\n      \"Conflict handling\",\n      \"Listening and empathy\"\n    ]\n  },\n  {\n    id: \"2\",\n    slug: \"emotional-regulation\",\n    name: \"Emotional Regulation\",\n    description: \"Your ability to understand, process, and manage emotions in healthy ways\",\n    tier: 1,\n    isPremium: false,\n    sortOrder: 2,\n    scoringCriteria: `Evaluate based on:\n- Awareness of emotional states and triggers\n- Ability to process difficult emotions without suppression or explosion\n- Recovery time from emotional setbacks\n- Use of healthy coping mechanisms vs destructive patterns\n- Emotional resilience and adaptability\n- Self-soothing and grounding techniques\nScore 0-100 where:\n- 0-30: Overwhelmed by emotions, poor coping, frequent emotional reactivity\n- 31-60: Growing awareness, some regulation skills, occasional overwhelm\n- 61-85: Generally well-regulated, effective coping, minor lapses under stress\n- 86-100: Exceptional emotional intelligence and regulation, healthy processing`,\n    journalPrompts: [\n      \"What emotions came up for you today? How did you handle them?\",\n      \"Describe a moment when you felt overwhelmed - what helped you cope?\",\n      \"What patterns do you notice in your emotional responses?\"\n    ],\n    chatFocusAreas: [\n      \"Emotional awareness and labeling\",\n      \"Coping mechanisms and strategies\",\n      \"Triggers and patterns\",\n      \"Resilience and recovery\"\n    ]\n  },\n  {\n    id: \"3\",\n    slug: \"confidence-self-worth\",\n    name: \"Confidence & Self-Worth\",\n    description: \"How you value yourself, trust your abilities, and show up authentically\",\n    tier: 1,\n    isPremium: false,\n    sortOrder: 3,\n    scoringCriteria: `Evaluate based on:\n- Self-talk patterns (critical vs supportive)\n- Willingness to take appropriate risks and try new things\n- Ability to accept compliments and acknowledge strengths\n- Recovery from failures or criticism\n- Comparison to others (frequency and impact)\n- Self-advocacy and standing up for personal needs\nScore 0-100 where:\n- 0-30: Heavy self-criticism, severe imposter syndrome, constant comparison\n- 31-60: Building confidence, occasional self-doubt, working on self-acceptance\n- 61-85: Generally confident, healthy self-image, minor insecurities\n- 86-100: Strong self-worth, authentic self-expression, resilient confidence`,\n    journalPrompts: [\n      \"What did you do today that you're proud of?\",\n      \"When did you doubt yourself today? What triggered it?\",\n      \"How did you advocate for yourself or your needs?\"\n    ],\n    chatFocusAreas: [\n      \"Self-talk and inner dialogue\",\n      \"Risk-taking and trying new things\",\n      \"Handling criticism and failure\",\n      \"Self-advocacy\"\n    ]\n  },\n  {\n    id: \"4\",\n    slug: \"career-leadership\",\n    name: \"Career & Leadership\",\n    description: \"Professional growth, influence, and your ability to lead yourself and others\",\n    tier: 2,\n    isPremium: true,\n    sortOrder: 4,\n    scoringCriteria: `Evaluate based on:\n- Career direction clarity and goal pursuit\n- Initiative and proactive problem-solving\n- Leadership behaviors (formal or informal)\n- Influence and impact on others\n- Professional skill development\n- Work relationships and collaboration\nScore 0-100 where:\n- 0-30: Career stagnation, reactive approach, minimal impact\n- 31-60: Some direction, developing skills, occasional leadership moments\n- 61-85: Clear career path, growing influence, consistent professional development\n- 86-100: Strong career momentum, natural leader, significant impact`,\n    journalPrompts: [\n      \"What professional challenge did you tackle today?\",\n      \"How did you influence or lead others (formally or informally)?\",\n      \"What skills are you developing right now?\"\n    ],\n    chatFocusAreas: [\n      \"Career goals and direction\",\n      \"Leadership opportunities\",\n      \"Professional development\",\n      \"Workplace dynamics\"\n    ]\n  },\n  {\n    id: \"5\",\n    slug: \"decision-making\",\n    name: \"Decision-Making Patterns\",\n    description: \"How you make choices, trust your judgment, and learn from outcomes\",\n    tier: 2,\n    isPremium: true,\n    sortOrder: 5,\n    scoringCriteria: `Evaluate based on:\n- Decision-making speed and confidence\n- Analysis paralysis vs impulsivity\n- Use of intuition vs data in decisions\n- Learning from past decisions\n- Commitment to decisions once made\n- Ability to pivot when needed\nScore 0-100 where:\n- 0-30: Chronic indecision or impulsive choices, regret cycles\n- 31-60: Improving decision process, some clarity, occasional doubt\n- 61-85: Generally sound decisions, balanced approach, minor regrets\n- 86-100: Excellent judgment, learns from all outcomes, decisive yet flexible`,\n    journalPrompts: [\n      \"What decision did you make today? How did you arrive at it?\",\n      \"Describe a choice you're struggling with - what makes it difficult?\",\n      \"What did you learn from a recent decision (good or bad)?\"\n    ],\n    chatFocusAreas: [\n      \"Decision-making process\",\n      \"Confidence in choices\",\n      \"Learning from outcomes\",\n      \"Analysis vs intuition balance\"\n    ]\n  },\n  {\n    id: \"6\",\n    slug: \"work-life-balance\",\n    name: \"Work-Life Balance\",\n    description: \"How well you integrate professional ambition with personal wellbeing and relationships\",\n    tier: 2,\n    isPremium: true,\n    sortOrder: 6,\n    scoringCriteria: `Evaluate based on:\n- Boundaries between work and personal time\n- Energy levels and burnout prevention\n- Time for relationships, hobbies, rest\n- Saying no to unreasonable demands\n- Guilt about rest or work (depending on which side)\n- Sustainable pace and rhythm\nScore 0-100 where:\n- 0-30: Severe imbalance, burnout symptoms, neglected life areas\n- 31-60: Aware of imbalance, making adjustments, some boundaries\n- 61-85: Generally balanced, sustainable pace, occasional overwork\n- 86-100: Excellent integration, healthy boundaries, sustainable success`,\n    journalPrompts: [\n      \"How did you balance work and personal time today?\",\n      \"When did you feel most energized vs drained?\",\n      \"What boundaries did you set or need to set?\"\n    ],\n    chatFocusAreas: [\n      \"Work-life boundaries\",\n      \"Energy management\",\n      \"Rest and recovery\",\n      \"Sustainable pace\"\n    ]\n  },\n  {\n    id: \"7\",\n    slug: \"conflict-resolution\",\n    name: \"Conflict Resolution\",\n    description: \"Your ability to navigate disagreements constructively and repair relationships\",\n    tier: 3,\n    isPremium: true,\n    sortOrder: 7,\n    scoringCriteria: `Evaluate based on:\n- Approach to disagreements (avoidance vs aggression vs assertive)\n- Ability to see other perspectives during conflict\n- Repair attempts and making amends\n- Learning from conflicts to prevent future issues\n- Emotional regulation during disagreements\n- Win-win vs win-lose mindset\nScore 0-100 where:\n- 0-30: Avoids or escalates conflicts, poor repair, lingering resentment\n- 31-60: Facing conflicts more, some resolution skills, working on it\n- 61-85: Generally handles conflicts well, good repair, minor avoidance\n- 86-100: Excellent conflict navigation, strong repair skills, growth mindset`,\n    journalPrompts: [\n      \"Describe any tension or conflict you experienced today - how did you handle it?\",\n      \"What could you have done differently in a recent disagreement?\",\n      \"How do you typically respond when someone challenges you?\"\n    ],\n    chatFocusAreas: [\n      \"Conflict approach and style\",\n      \"Perspective-taking\",\n      \"Repair and reconciliation\",\n      \"Learning from disagreements\"\n    ]\n  },\n  {\n    id: \"8\",\n    slug: \"authenticity-people-pleasing\",\n    name: \"Authenticity & People-Pleasing\",\n    description: \"Being true to yourself while navigating others' expectations and approval needs\",\n    tier: 3,\n    isPremium: true,\n    sortOrder: 8,\n    scoringCriteria: `Evaluate based on:\n- Expressing true opinions even when unpopular\n- Saying no without excessive guilt\n- Seeking approval vs internal validation\n- Suppressing needs to keep peace\n- Authenticity in different relationships\n- Discomfort with disappointing others\nScore 0-100 where:\n- 0-30: Heavy people-pleasing, suppressed authentic self, approval addiction\n- 31-60: Increasing authenticity, some boundary-setting, working on it\n- 61-85: Generally authentic, occasional people-pleasing, good balance\n- 86-100: Highly authentic, healthy boundaries, comfortable disappointing when needed`,\n    journalPrompts: [\n      \"When did you compromise your authentic self today? Why?\",\n      \"Describe a moment when you said yes but meant no\",\n      \"How do you feel when someone is disappointed in you?\"\n    ],\n    chatFocusAreas: [\n      \"Authentic expression\",\n      \"People-pleasing patterns\",\n      \"Boundary-setting\",\n      \"Approval-seeking behaviors\"\n    ]\n  }\n];\n\nexport function getCategoryById(id: string): Category | undefined {\n  return CATEGORIES.find(c => c.id === id);\n}\n\nexport function getCategoryBySlug(slug: string): Category | undefined {\n  return CATEGORIES.find(c => c.slug === slug);\n}\n\nexport function getFreeTierCategories(): Category[] {\n  return CATEGORIES.filter(c => !c.isPremium);\n}\n\nexport function getAllCategories(): Category[] {\n  return CATEGORIES.sort((a, b) => a.sortOrder - b.sortOrder);\n}\n","path":null,"size_bytes":10785,"size_tokens":null},"client/src/components/CategoryTrendChart.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine,\n} from \"recharts\";\nimport { TrendingUp, TrendingDown, Minus, Calendar } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface CategoryTrendChartProps {\n  categoryId: string;\n  categoryName: string;\n}\n\nexport function CategoryTrendChart({ categoryId, categoryName }: CategoryTrendChartProps) {\n  const [periodType, setPeriodType] = useState<\"daily\" | \"weekly\">(\"daily\");\n\n  // Fetch score history\n  const { data: scores, isLoading, isError } = useQuery({\n    queryKey: [`/api/category-scores/${categoryId}?period=${periodType}&limit=30`],\n  });\n\n  if (isLoading) {\n    return (\n      <Card className=\"p-6\" data-testid=\"card-trend-loading\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-4 bg-accent rounded w-1/3\"></div>\n          <div className=\"h-64 bg-accent rounded\"></div>\n        </div>\n      </Card>\n    );\n  }\n\n  if (isError) {\n    return (\n      <Card className=\"p-6\" data-testid=\"card-trend-error\">\n        <p className=\"text-sm text-destructive\">Failed to load trend data</p>\n      </Card>\n    );\n  }\n\n  const scoreData = (scores as any[] || []);\n  \n  // Calculate latest score and delta\n  const latestScore = scoreData[scoreData.length - 1];\n  const previousScore = scoreData[scoreData.length - 2];\n  const scoreDelta = latestScore && previousScore \n    ? latestScore.score - previousScore.score \n    : null;\n\n  // Format data for Recharts\n  const chartData = scoreData.map((score: any) => ({\n    date: format(new Date(score.periodStart), periodType === \"daily\" ? \"MMM d\" : \"MMM d\"),\n    score: score.score,\n    fullDate: new Date(score.periodStart).toLocaleDateString(),\n    reasoning: score.reasoning,\n  }));\n\n  // Calculate average score\n  const averageScore = scoreData.length > 0\n    ? Math.round(scoreData.reduce((sum: number, s: any) => sum + s.score, 0) / scoreData.length)\n    : undefined;\n\n  return (\n    <Card className=\"p-6\" data-testid=\"card-trend-chart\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6\">\n        <div>\n          <h3 className=\"text-xl font-medium mb-1\" data-testid=\"text-category-name\">\n            {categoryName} Progress\n          </h3>\n          {scoreData.length > 0 && (\n            <p className=\"text-sm text-muted-foreground\">\n              Tracking since {format(new Date(scoreData[0].periodStart), \"MMM d, yyyy\")}\n            </p>\n          )}\n        </div>\n\n        {/* Period Toggle */}\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={periodType === \"daily\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setPeriodType(\"daily\")}\n            data-testid=\"button-period-daily\"\n          >\n            <Calendar className=\"w-4 h-4 mr-1\" />\n            Daily\n          </Button>\n          <Button\n            variant={periodType === \"weekly\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setPeriodType(\"weekly\")}\n            data-testid=\"button-period-weekly\"\n          >\n            <Calendar className=\"w-4 h-4 mr-1\" />\n            Weekly\n          </Button>\n        </div>\n      </div>\n\n      {/* Empty State */}\n      {scoreData.length === 0 && (\n        <div className=\"text-center py-12\" data-testid=\"div-empty-state\">\n          <p className=\"text-muted-foreground mb-2\">No scores yet</p>\n          <p className=\"text-sm text-muted-foreground\">\n            Keep journaling and chatting. Scores will appear here as you build up data.\n          </p>\n        </div>\n      )}\n\n      {/* Stats Row */}\n      {scoreData.length > 0 && (\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6\">\n          {/* Latest Score */}\n          <div className=\"space-y-1\" data-testid=\"div-latest-score\">\n            <p className=\"text-sm text-muted-foreground\">Current Score</p>\n            <p className=\"text-3xl font-bold text-primary\">\n              {latestScore?.score || 0}\n            </p>\n          </div>\n\n          {/* Score Delta */}\n          {scoreDelta !== null && (\n            <div className=\"space-y-1\" data-testid=\"div-score-delta\">\n              <p className=\"text-sm text-muted-foreground\">Change</p>\n              <div className=\"flex items-center gap-1\">\n                {scoreDelta > 0 && (\n                  <>\n                    <TrendingUp className=\"w-5 h-5 text-green-500\" />\n                    <span className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                      +{scoreDelta}\n                    </span>\n                  </>\n                )}\n                {scoreDelta < 0 && (\n                  <>\n                    <TrendingDown className=\"w-5 h-5 text-red-500\" />\n                    <span className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n                      {scoreDelta}\n                    </span>\n                  </>\n                )}\n                {scoreDelta === 0 && (\n                  <>\n                    <Minus className=\"w-5 h-5 text-muted-foreground\" />\n                    <span className=\"text-2xl font-bold text-muted-foreground\">0</span>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Average Score */}\n          {averageScore !== undefined && (\n            <div className=\"space-y-1\" data-testid=\"div-average-score\">\n              <p className=\"text-sm text-muted-foreground\">Average</p>\n              <p className=\"text-2xl font-bold\">{averageScore}</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Chart */}\n      {scoreData.length > 0 && (\n        <div className=\"h-64 sm:h-80\" data-testid=\"div-chart-container\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <LineChart data={chartData} margin={{ top: 5, right: 10, left: -20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n              <XAxis \n                dataKey=\"date\" \n                className=\"text-xs\"\n                tick={{ fill: \"currentColor\", className: \"fill-muted-foreground\" }}\n              />\n              <YAxis \n                domain={[0, 100]}\n                className=\"text-xs\"\n                tick={{ fill: \"currentColor\", className: \"fill-muted-foreground\" }}\n              />\n              <Tooltip\n                content={({ active, payload }) => {\n                  if (active && payload && payload.length) {\n                    const data = payload[0].payload;\n                    return (\n                      <Card className=\"p-3 shadow-lg\">\n                        <p className=\"text-sm font-medium mb-1\">{data.fullDate}</p>\n                        <p className=\"text-2xl font-bold text-primary mb-2\">\n                          Score: {data.score}\n                        </p>\n                        {data.reasoning && (\n                          <p className=\"text-xs text-muted-foreground max-w-xs\">\n                            {data.reasoning.substring(0, 100)}...\n                          </p>\n                        )}\n                      </Card>\n                    );\n                  }\n                  return null;\n                }}\n              />\n              {averageScore !== undefined && (\n                <ReferenceLine\n                  y={averageScore}\n                  stroke=\"hsl(var(--muted-foreground))\"\n                  strokeDasharray=\"3 3\"\n                  label={{\n                    value: `Avg: ${averageScore}`,\n                    position: \"right\",\n                    className: \"text-xs fill-muted-foreground\"\n                  }}\n                />\n              )}\n              <Line\n                type=\"monotone\"\n                dataKey=\"score\"\n                stroke=\"hsl(var(--primary))\"\n                strokeWidth={3}\n                dot={{ fill: \"hsl(var(--primary))\", r: 4 }}\n                activeDot={{ r: 6 }}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n      )}\n\n      {/* Data Contributors */}\n      {latestScore && (\n        <div className=\"mt-6 pt-4 border-t\">\n          <p className=\"text-xs text-muted-foreground\">\n            Latest analysis based on {latestScore.contributorsJournals || 0} journal {latestScore.contributorsJournals === 1 ? 'entry' : 'entries'} \n            {' '}and {latestScore.contributorsMessages || 0} chat {latestScore.contributorsMessages === 1 ? 'message' : 'messages'}\n            {' '}• {latestScore.confidenceLevel} confidence\n          </p>\n        </div>\n      )}\n    </Card>\n  );\n}\n","path":null,"size_bytes":8891,"size_tokens":null},"client/src/pages/CategoryOnboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Logo } from \"@/components/Logo\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Heart,\n  Brain,\n  Sparkles,\n  Briefcase,\n  Scale,\n  Clock,\n  MessageSquare,\n  User\n} from \"lucide-react\";\n\n// Icon mapping for categories\nconst categoryIcons: Record<string, typeof Heart> = {\n  \"relationships\": Heart,\n  \"emotional-regulation\": Brain,\n  \"confidence\": Sparkles,\n  \"career\": Briefcase,\n  \"decision-making\": Scale,\n  \"work-life-balance\": Clock,\n  \"conflict-resolution\": MessageSquare,\n  \"authenticity\": User\n};\n\n// Tier badge colors\nconst tierColors: Record<string, string> = {\n  \"free\": \"bg-green-500/10 text-green-600 dark:text-green-400\",\n  \"standard\": \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n  \"premium\": \"bg-purple-500/10 text-purple-600 dark:text-purple-400\"\n};\n\nexport default function CategoryOnboarding() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\n  \n  // For MVP, use free tier (1 category limit)\n  const currentTier = \"free\";\n  const tierLimits = {\n    free: 1,\n    standard: 3,\n    premium: Infinity\n  };\n  \n  const maxCategories = tierLimits[currentTier as keyof typeof tierLimits];\n\n  // Fetch available categories\n  const { data: categories, isLoading } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  // Select category mutation\n  const selectCategoryMutation = useMutation({\n    mutationFn: async (categoryId: string) => {\n      const response = await apiRequest(\"POST\", \"/api/user-categories\", {\n        categoryId\n      });\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-categories\"] });\n      toast({\n        title: \"Success!\",\n        description: \"Your improvement journey begins now.\",\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to save category selection.\",\n      });\n    }\n  });\n\n  const handleCategoryToggle = (categoryId: string) => {\n    setSelectedCategories(prev => {\n      if (prev.includes(categoryId)) {\n        return prev.filter(id => id !== categoryId);\n      } else {\n        if (prev.length >= maxCategories) {\n          toast({\n            variant: \"destructive\",\n            title: \"Category limit reached\",\n            description: `Your ${currentTier} plan allows ${maxCategories} ${maxCategories === 1 ? 'category' : 'categories'}. Upgrade for more.`,\n          });\n          return prev;\n        }\n        return [...prev, categoryId];\n      }\n    });\n  };\n\n  const handleContinue = () => {\n    if (selectedCategories.length === 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"Select a category\",\n        description: \"Please choose at least one area to improve.\",\n      });\n      return;\n    }\n    \n    // For MVP, only support single category selection\n    selectCategoryMutation.mutate(selectedCategories[0]);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-accent/5\">\n        <div className=\"text-center space-y-4\">\n          <Logo size=\"lg\" />\n          <p className=\"text-muted-foreground\">Loading categories...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-background to-accent/5\">\n      <div className=\"max-w-5xl mx-auto px-4 sm:px-6 py-8 sm:py-12\">\n        {/* Header */}\n        <div className=\"text-center mb-8 sm:mb-12 space-y-4\">\n          <Logo size=\"md\" showText={false} />\n          <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-semibold\">\n            What do you want to improve?\n          </h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Choose an area of your life to track and improve. Mirror will analyze your journal entries \n            and conversations to provide personalized insights and scores.\n          </p>\n          <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\">\n            <Badge variant=\"secondary\" data-testid=\"badge-tier\">\n              {currentTier.charAt(0).toUpperCase() + currentTier.slice(1)} Plan\n            </Badge>\n            <span>•</span>\n            <span>\n              {selectedCategories.length} of {maxCategories === Infinity ? '∞' : maxCategories} selected\n            </span>\n          </div>\n        </div>\n\n        {/* Category Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8\">\n          {(categories as any[] || []).map((category: any) => {\n            const Icon = categoryIcons[category.id] || Sparkles;\n            const isSelected = selectedCategories.includes(category.id);\n            \n            return (\n              <Card\n                key={category.id}\n                onClick={() => handleCategoryToggle(category.id)}\n                className={`\n                  cursor-pointer p-6 hover-elevate active-elevate-2 transition-all\n                  ${isSelected ? 'ring-2 ring-primary bg-accent/20' : ''}\n                `}\n                data-testid={`card-category-${category.id}`}\n              >\n                <div className=\"flex items-start gap-3 mb-3\">\n                  <div className={`\n                    p-2 rounded-lg \n                    ${isSelected ? 'bg-primary text-primary-foreground' : 'bg-accent'}\n                  `}>\n                    <Icon className=\"w-5 h-5\" />\n                  </div>\n                  <Badge \n                    variant=\"secondary\" \n                    className={tierColors[category.tier]}\n                    data-testid={`badge-tier-${category.id}`}\n                  >\n                    {category.tier}\n                  </Badge>\n                </div>\n                \n                <h3 className=\"text-xl font-medium mb-2\" data-testid={`text-name-${category.id}`}>\n                  {category.name}\n                </h3>\n                \n                <p className=\"text-sm text-muted-foreground\" data-testid={`text-description-${category.id}`}>\n                  {category.description}\n                </p>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex flex-col sm:flex-row items-center justify-center gap-3\">\n          <Button\n            size=\"lg\"\n            onClick={handleContinue}\n            disabled={selectCategoryMutation.isPending}\n            className=\"w-full sm:w-auto px-8\"\n            data-testid=\"button-continue\"\n          >\n            {selectCategoryMutation.isPending ? \"Saving...\" : \"Continue\"}\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"lg\"\n            onClick={() => setLocation(\"/dashboard\")}\n            className=\"w-full sm:w-auto\"\n            data-testid=\"button-skip\"\n          >\n            Skip for now\n          </Button>\n        </div>\n\n        {/* Upgrade prompt for free users */}\n        <div className=\"mt-12 text-center\">\n          <p className=\"text-sm text-muted-foreground\">\n            Want to track more areas?{\" \"}\n            <button className=\"text-primary hover:underline font-medium\">\n              Upgrade to Standard (3 categories) or Premium (unlimited)\n            </button>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7848,"size_tokens":null},"client/src/components/OnboardingGuard.tsx":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\n\n/**\n * OnboardingGuard ensures users complete category selection before accessing the app.\n * Redirects to /onboarding if no categories are selected.\n */\nexport function OnboardingGuard({ children }: { children: React.ReactNode }) {\n  const [location, setLocation] = useLocation();\n  \n  // Fetch user's selected categories\n  const { data: userCategories, isLoading, isError } = useQuery({\n    queryKey: [\"/api/user-categories\"],\n    retry: 2, // Retry failed requests twice\n  });\n\n  useEffect(() => {\n    // Skip onboarding check if already on onboarding page\n    if (location === \"/onboarding\") {\n      return;\n    }\n\n    // On error, allow access (fail-open to prevent lockout)\n    if (isError) {\n      return;\n    }\n\n    // Redirect to onboarding if no categories selected\n    if (!isLoading && (!userCategories || (userCategories as any[]).length === 0)) {\n      setLocation(\"/onboarding\");\n    }\n  }, [userCategories, isLoading, isError, location, setLocation]);\n\n  // Show loading state while checking\n  if (isLoading) {\n    return <div className=\"min-h-screen flex items-center justify-center\">\n      <p className=\"text-muted-foreground\">Loading...</p>\n    </div>;\n  }\n\n  // Allow access if categories selected or on onboarding page\n  return <>{children}</>;\n}\n","path":null,"size_bytes":1392,"size_tokens":null},"server/category-scoring.ts":{"content":"import { storage } from \"./storage\";\nimport { getCategoryById } from \"./categories\";\nimport OpenAI from \"openai\";\n\n// Initialize OpenAI client - prioritize direct API for unfiltered access\nconst apiKey = process.env.OPENAI_API_KEY ?? process.env.AI_INTEGRATIONS_OPENAI_API_KEY;\nif (!apiKey) {\n  console.error(\"ERROR: No OpenAI API key configured. Set either OPENAI_API_KEY or AI_INTEGRATIONS_OPENAI_API_KEY\");\n  throw new Error(\"OpenAI API key not configured\");\n}\n\nconst openai = new OpenAI({\n  apiKey,\n  // Only use baseURL if using Replit integration (AI_INTEGRATIONS_OPENAI_API_KEY)\n  baseURL: process.env.OPENAI_API_KEY ? undefined : process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nexport interface CategoryScoreResult {\n  score: number; // 0-100\n  reasoning: string;\n  keyPatterns: string[];\n  progressIndicators: string[];\n  areasForGrowth: string[];\n  confidenceLevel: 'low' | 'medium' | 'high';\n  evidenceSnippets: { source: string; excerpt: string; date: string }[];\n}\n\n// JSON Schema for structured output\nconst SCORE_RESPONSE_SCHEMA = {\n  type: \"object\",\n  properties: {\n    score: {\n      type: \"number\",\n      minimum: 0,\n      maximum: 100,\n      description: \"Overall score for this category (0-100)\"\n    },\n    reasoning: {\n      type: \"string\",\n      description: \"2-3 sentences explaining the score\"\n    },\n    keyPatterns: {\n      type: \"array\",\n      items: { type: \"string\" },\n      minItems: 0,\n      maxItems: 5,\n      description: \"Observable behavioral or emotional patterns\"\n    },\n    progressIndicators: {\n      type: \"array\",\n      items: { type: \"string\" },\n      minItems: 0,\n      maxItems: 3,\n      description: \"Positive signs of growth or improvement\"\n    },\n    areasForGrowth: {\n      type: \"array\",\n      items: { type: \"string\" },\n      minItems: 0,\n      maxItems: 4,\n      description: \"Areas needing attention or development\"\n    },\n    confidenceLevel: {\n      type: \"string\",\n      enum: [\"low\", \"medium\", \"high\"],\n      description: \"Confidence in this assessment based on data quality and quantity\"\n    },\n    evidenceSnippets: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        properties: {\n          source: { type: \"string\", description: \"journal or chat\" },\n          excerpt: { type: \"string\", description: \"Relevant quote or paraphrase\" },\n          date: { type: \"string\", description: \"ISO date string\" }\n        },\n        required: [\"source\", \"excerpt\", \"date\"],\n        additionalProperties: false\n      },\n      minItems: 0,\n      maxItems: 5,\n      description: \"Supporting evidence from user's journal and chat\"\n    }\n  },\n  required: [\"score\", \"reasoning\", \"keyPatterns\", \"progressIndicators\", \"areasForGrowth\", \"confidenceLevel\", \"evidenceSnippets\"],\n  additionalProperties: false\n};\n\n/**\n * Generate a category score for a user based on recent activity\n * @param userId - User ID\n * @param categoryId - Category ID to score\n * @param lookbackDays - Number of days to analyze (default 7)\n */\nexport async function generateCategoryScore(\n  userId: string,\n  categoryId: string,\n  lookbackDays: number = 7\n): Promise<CategoryScoreResult> {\n  const category = getCategoryById(categoryId);\n  if (!category) {\n    throw new Error(`Category not found: ${categoryId}`);\n  }\n\n  // Fetch recent user data\n  const journalEntries = await storage.getJournalEntriesByUserId(userId);\n  const conversations = await storage.getConversationsByUserId(userId);\n\n  // Filter to recent data (last N days)\n  const cutoffDate = new Date();\n  cutoffDate.setDate(cutoffDate.getDate() - lookbackDays);\n\n  // IMPORTANT: Filter by date FIRST, then slice to limit\n  // This ensures we're only analyzing recent data within the lookback window\n  const recentJournals = journalEntries\n    .filter(j => new Date(j.createdAt) >= cutoffDate)\n    .slice(0, 10); // Max 10 journal entries (already filtered by date)\n\n  // Get recent messages from all conversations\n  let recentMessages: any[] = [];\n  for (const conv of conversations.slice(0, 3)) { // Max 3 conversations\n    const messages = await storage.getMessagesByConversationId(conv.id);\n    const filtered = messages.filter(m => new Date(m.createdAt) >= cutoffDate);\n    recentMessages.push(...filtered);\n  }\n  recentMessages = recentMessages\n    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n    .slice(0, 20); // Max 20 messages\n\n  // Build context for AI\n  const journalContext = recentJournals\n    .map(j => `[${new Date(j.createdAt).toLocaleDateString()}] ${j.content}`)\n    .join('\\n\\n');\n\n  const chatContext = recentMessages\n    .map(m => `${m.role === 'user' ? 'User' : 'AI'}: ${m.content}`)\n    .join('\\n');\n\n  // Check if we have enough data (count only user messages, not assistant responses)\n  const userMessageCount = recentMessages.filter(m => m.role === 'user').length;\n  const hasMinimumData = recentJournals.length >= 2 || userMessageCount >= 5;\n  if (!hasMinimumData) {\n    return {\n      score: 0,\n      reasoning: \"Insufficient data to generate a reliable score. Continue journaling and chatting to build your profile.\",\n      keyPatterns: [],\n      progressIndicators: [],\n      areasForGrowth: [],\n      confidenceLevel: 'low',\n      evidenceSnippets: []\n    };\n  }\n\n  // Generate score using GPT-4o with structured output\n  const systemPrompt = `You are an expert psychologist specializing in ${category.name}.\n\nAnalyze user journal entries and chat conversations to generate a score (0-100) that reflects their current level in this category.\n\nCATEGORY: ${category.name}\nDESCRIPTION: ${category.description}\n\nSCORING CRITERIA:\n${category.scoringCriteria}\n\nFOCUS AREAS:\n${category.chatFocusAreas.join('\\n')}\n\nBe honest and direct. The user wants the truth, not flattery. If you see concerning patterns, include them in areasForGrowth.\n\nIn evidenceSnippets, include 2-5 specific quotes or paraphrases from the journal/chat that support your analysis. These should be direct examples that illustrate the patterns you've identified.\n\nConfidence level should be:\n- \"low\" if there's insufficient data or contradictory signals\n- \"medium\" if there's moderate data showing consistent patterns\n- \"high\" if there's substantial data with clear, consistent patterns`;\n\n  const userPrompt = `=== JOURNAL ENTRIES (last ${lookbackDays} days) ===\n${journalContext || '(No recent journal entries)'}\n\n=== CHAT CONVERSATIONS (last ${lookbackDays} days) ===\n${chatContext || '(No recent chat messages)'}\n\nGenerate a ${category.name} score based on this data.`;\n\n  try {\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      temperature: 0.7,\n      max_tokens: 1500,\n      response_format: {\n        type: \"json_schema\",\n        json_schema: {\n          name: \"category_score_analysis\",\n          strict: true,\n          schema: SCORE_RESPONSE_SCHEMA\n        }\n      }\n    });\n\n    const responseText = completion.choices[0]?.message?.content?.trim() || '{}';\n    \n    // Parse structured JSON response\n    const result: CategoryScoreResult = JSON.parse(responseText);\n\n    // Validate and clamp score\n    result.score = Math.max(0, Math.min(100, result.score));\n\n    return result;\n\n  } catch (error) {\n    console.error('Error generating category score:', error);\n    if (error instanceof Error) {\n      throw new Error(`Failed to generate category score: ${error.message}`);\n    }\n    throw new Error('Failed to generate category score');\n  }\n}\n\n/**\n * Generate and persist a category score to the database\n * @param userId - User ID\n * @param categoryId - Category ID to score\n * @param periodType - 'daily' or 'weekly'\n * @param lookbackDays - Number of days to analyze (default 7)\n */\nexport async function generateAndPersistCategoryScore(\n  userId: string,\n  categoryId: string,\n  periodType: 'daily' | 'weekly' = 'daily',\n  lookbackDays: number = 7\n): Promise<CategoryScoreResult & { scoreId: string }> {\n  // Generate the score\n  const scoreResult = await generateCategoryScore(userId, categoryId, lookbackDays);\n\n  // Don't persist if insufficient data (score would be 0)\n  if (scoreResult.score === 0 && scoreResult.confidenceLevel === 'low') {\n    throw new Error(scoreResult.reasoning);\n  }\n\n  // Determine period boundaries\n  const now = new Date();\n  const periodStart = new Date(now);\n  periodStart.setHours(0, 0, 0, 0);\n  \n  if (periodType === 'weekly') {\n    const dayOfWeek = periodStart.getDay();\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n    periodStart.setDate(periodStart.getDate() - daysToMonday);\n  }\n\n  const periodEnd = new Date(periodStart);\n  if (periodType === 'daily') {\n    periodEnd.setDate(periodEnd.getDate() + 1);\n  } else {\n    periodEnd.setDate(periodEnd.getDate() + 7);\n  }\n\n  // Check for existing score with exact (user, category, periodType, periodStart) match\n  // This prevents duplicates even with different lookbackDays\n  const allScores = await storage.getCategoryScores(userId, categoryId, periodType, 1);\n  const existingScore = allScores.find(score => \n    new Date(score.periodStart).getTime() === periodStart.getTime()\n  );\n\n  if (existingScore) {\n    console.log(`Score already exists for user ${userId}, category ${categoryId}, period ${periodType}, periodStart ${periodStart.toISOString()}`);\n    // Return existing score data with all fields from scoreResult\n    return {\n      score: existingScore.score,\n      reasoning: existingScore.reasoning || scoreResult.reasoning,\n      keyPatterns: existingScore.keyPatterns || scoreResult.keyPatterns,\n      progressIndicators: existingScore.progressIndicators || scoreResult.progressIndicators,\n      areasForGrowth: existingScore.areasForGrowth || scoreResult.areasForGrowth,\n      confidenceLevel: (existingScore.confidenceLevel as any) || scoreResult.confidenceLevel,\n      evidenceSnippets: (existingScore.evidenceSnippets as any) || scoreResult.evidenceSnippets,\n      scoreId: existingScore.id\n    };\n  }\n\n  // Calculate contributors metadata\n  const cutoffDate = new Date(Date.now() - lookbackDays * 24 * 60 * 60 * 1000);\n  const journalEntries = await storage.getJournalEntriesByUserId(userId);\n  const conversations = await storage.getConversationsByUserId(userId);\n  \n  const recentJournalCount = journalEntries.filter(j => \n    new Date(j.createdAt) >= cutoffDate\n  ).length;\n\n  // Count only user messages (not assistant responses)\n  let userMessageCount = 0;\n  for (const conv of conversations.slice(0, 3)) {\n    const messages = await storage.getMessagesByConversationId(conv.id);\n    userMessageCount += messages.filter(m => \n      m.role === 'user' && new Date(m.createdAt) >= cutoffDate\n    ).length;\n  }\n\n  // Persist to database\n  const persistedScore = await storage.createCategoryScore({\n    userId,\n    categoryId,\n    periodType,\n    periodStart,\n    periodEnd,\n    score: scoreResult.score,\n    delta: null,\n    reasoning: scoreResult.reasoning,\n    keyPatterns: scoreResult.keyPatterns,\n    progressIndicators: scoreResult.progressIndicators,\n    areasForGrowth: scoreResult.areasForGrowth,\n    confidenceLevel: scoreResult.confidenceLevel,\n    evidenceSnippets: scoreResult.evidenceSnippets as any,\n    contributors: {\n      journalCount: recentJournalCount,\n      messageCount: userMessageCount,\n      lookbackDays\n    }\n  });\n\n  return { ...scoreResult, scoreId: persistedScore.id };\n}\n\n/**\n * Generate weekly summary score from daily scores\n * @param dailyScores - Array of daily scores from the past week\n */\nexport function calculateWeeklySummary(dailyScores: number[]): {\n  weeklyScore: number;\n  trend: 'improving' | 'declining' | 'stable';\n  delta: number;\n} {\n  if (dailyScores.length === 0) {\n    return { weeklyScore: 0, trend: 'stable', delta: 0 };\n  }\n\n  // Calculate average\n  const weeklyScore = Math.round(\n    dailyScores.reduce((sum, score) => sum + score, 0) / dailyScores.length\n  );\n\n  // Determine trend (compare first half vs second half)\n  if (dailyScores.length >= 4) {\n    const midpoint = Math.floor(dailyScores.length / 2);\n    const firstHalf = dailyScores.slice(0, midpoint);\n    const secondHalf = dailyScores.slice(midpoint);\n    \n    const firstAvg = firstHalf.reduce((sum, s) => sum + s, 0) / firstHalf.length;\n    const secondAvg = secondHalf.reduce((sum, s) => sum + s, 0) / secondHalf.length;\n    \n    const delta = Math.round(secondAvg - firstAvg);\n    \n    if (delta > 3) {\n      return { weeklyScore, trend: 'improving', delta };\n    } else if (delta < -3) {\n      return { weeklyScore, trend: 'declining', delta };\n    }\n  }\n\n  return { weeklyScore, trend: 'stable', delta: 0 };\n}\n","path":null,"size_bytes":12674,"size_tokens":null},"client/src/pages/IntakeAssessment.tsx":{"content":"import { useState } from \"react\";\nimport { DashboardNav } from \"@/components/DashboardNav\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { Brain, ArrowRight, ArrowLeft, CheckCircle2 } from \"lucide-react\";\n\nconst TOTAL_STEPS = 5;\n\ninterface AssessmentData {\n  // Step 1: Basic Information\n  age?: string;\n  occupation?: string;\n  relationshipStatus?: string;\n  \n  // Step 2: Life Satisfaction\n  lifeOverallSatisfaction?: string;\n  workSatisfaction?: string;\n  relationshipsSatisfaction?: string;\n  healthSatisfaction?: string;\n  \n  // Step 3: Personality Traits (Big 5)\n  opennessScore?: string;\n  conscientiousnessScore?: string;\n  extraversionScore?: string;\n  agreeablenessScore?: string;\n  emotionalStabilityScore?: string;\n  \n  // Step 4: Current Challenges\n  primaryChallenge?: string;\n  challengeDescription?: string;\n  \n  // Step 5: Goals & Motivations\n  mainGoal?: string;\n  motivationLevel?: string;\n  supportNeeded?: string;\n}\n\nexport default function IntakeAssessment() {\n  const [currentStep, setCurrentStep] = useState(1);\n  const [data, setData] = useState<AssessmentData>({});\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n\n  const updateData = (field: keyof AssessmentData, value: string) => {\n    setData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const saveAssessmentMutation = useMutation({\n    mutationFn: async () => {\n      // For now, we'll save this as a special journal entry\n      const assessmentText = `\nINTAKE ASSESSMENT RESULTS\n\nBasic Information:\n- Age Range: ${data.age || 'Not provided'}\n- Occupation: ${data.occupation || 'Not provided'}\n- Relationship Status: ${data.relationshipStatus || 'Not provided'}\n\nLife Satisfaction (1-10):\n- Overall: ${data.lifeOverallSatisfaction || 'Not rated'}/10\n- Work: ${data.workSatisfaction || 'Not rated'}/10\n- Relationships: ${data.relationshipsSatisfaction || 'Not rated'}/10\n- Health: ${data.healthSatisfaction || 'Not rated'}/10\n\nPersonality Self-Assessment (1-10):\n- Openness to Experience: ${data.opennessScore || 'Not rated'}/10\n- Conscientiousness: ${data.conscientiousnessScore || 'Not rated'}/10\n- Extraversion: ${data.extraversionScore || 'Not rated'}/10\n- Agreeableness: ${data.agreeablenessScore || 'Not rated'}/10\n- Emotional Stability: ${data.emotionalStabilityScore || 'Not rated'}/10\n\nCurrent Challenges:\n- Primary Challenge: ${data.primaryChallenge || 'Not provided'}\n- Details: ${data.challengeDescription || 'Not provided'}\n\nGoals & Motivations:\n- Main Goal: ${data.mainGoal || 'Not provided'}\n- Motivation Level: ${data.motivationLevel || 'Not rated'}/10\n- Support Needed: ${data.supportNeeded || 'Not provided'}\n      `.trim();\n\n      const wordCount = assessmentText.split(/\\s+/).filter(w => w).length;\n      \n      return await apiRequest(\"POST\", \"/api/journal-entries\", {\n        content: assessmentText,\n        prompt: \"Initial Intake Assessment\",\n        wordCount\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/journal-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      toast({\n        title: \"Assessment Complete!\",\n        description: \"Your responses have been saved and will help personalize your experience.\",\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to save assessment. Please try again.\",\n      });\n    },\n  });\n\n  const nextStep = () => {\n    if (currentStep < TOTAL_STEPS) {\n      setCurrentStep(prev => prev + 1);\n    } else {\n      saveAssessmentMutation.mutate();\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 1) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  const canProceed = () => {\n    switch (currentStep) {\n      case 1:\n        return data.age && data.occupation && data.relationshipStatus;\n      case 2:\n        return data.lifeOverallSatisfaction && data.workSatisfaction && \n               data.relationshipsSatisfaction && data.healthSatisfaction;\n      case 3:\n        return data.opennessScore && data.conscientiousnessScore && \n               data.extraversionScore && data.agreeablenessScore && \n               data.emotionalStabilityScore;\n      case 4:\n        return data.primaryChallenge;\n      case 5:\n        return data.mainGoal && data.motivationLevel && data.supportNeeded;\n      default:\n        return false;\n    }\n  };\n\n  const renderStep = () => {\n    switch (currentStep) {\n      case 1:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"age\">Age Range</Label>\n              <RadioGroup value={data.age} onValueChange={(val) => updateData('age', val)}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"18-24\" id=\"age-18-24\" />\n                  <Label htmlFor=\"age-18-24\" className=\"font-normal cursor-pointer\">18-24</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"25-34\" id=\"age-25-34\" />\n                  <Label htmlFor=\"age-25-34\" className=\"font-normal cursor-pointer\">25-34</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"35-44\" id=\"age-35-44\" />\n                  <Label htmlFor=\"age-35-44\" className=\"font-normal cursor-pointer\">35-44</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"45-54\" id=\"age-45-54\" />\n                  <Label htmlFor=\"age-45-54\" className=\"font-normal cursor-pointer\">45-54</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"55+\" id=\"age-55+\" />\n                  <Label htmlFor=\"age-55+\" className=\"font-normal cursor-pointer\">55+</Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"occupation\">Occupation / Field</Label>\n              <Input\n                id=\"occupation\"\n                placeholder=\"e.g., Software Engineer, Teacher, Student\"\n                value={data.occupation || ''}\n                onChange={(e) => updateData('occupation', e.target.value)}\n                data-testid=\"input-occupation\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"relationship\">Relationship Status</Label>\n              <RadioGroup value={data.relationshipStatus} onValueChange={(val) => updateData('relationshipStatus', val)}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"single\" id=\"rel-single\" />\n                  <Label htmlFor=\"rel-single\" className=\"font-normal cursor-pointer\">Single</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"dating\" id=\"rel-dating\" />\n                  <Label htmlFor=\"rel-dating\" className=\"font-normal cursor-pointer\">Dating</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"committed\" id=\"rel-committed\" />\n                  <Label htmlFor=\"rel-committed\" className=\"font-normal cursor-pointer\">In a Committed Relationship</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"married\" id=\"rel-married\" />\n                  <Label htmlFor=\"rel-married\" className=\"font-normal cursor-pointer\">Married/Partnered</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"complicated\" id=\"rel-complicated\" />\n                  <Label htmlFor=\"rel-complicated\" className=\"font-normal cursor-pointer\">It's Complicated</Label>\n                </div>\n              </RadioGroup>\n            </div>\n          </div>\n        );\n\n      case 2:\n        return (\n          <div className=\"space-y-6\">\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Rate your satisfaction in each area from 1 (very dissatisfied) to 10 (very satisfied)\n            </p>\n\n            <div className=\"space-y-3\">\n              <Label>Overall Life Satisfaction</Label>\n              <RadioGroup value={data.lifeOverallSatisfaction} onValueChange={(val) => updateData('lifeOverallSatisfaction', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`life-${num}`} />\n                    <Label htmlFor={`life-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label>Work/Career Satisfaction</Label>\n              <RadioGroup value={data.workSatisfaction} onValueChange={(val) => updateData('workSatisfaction', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`work-${num}`} />\n                    <Label htmlFor={`work-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label>Relationships Satisfaction</Label>\n              <RadioGroup value={data.relationshipsSatisfaction} onValueChange={(val) => updateData('relationshipsSatisfaction', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`rel-sat-${num}`} />\n                    <Label htmlFor={`rel-sat-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label>Physical/Mental Health Satisfaction</Label>\n              <RadioGroup value={data.healthSatisfaction} onValueChange={(val) => updateData('healthSatisfaction', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`health-${num}`} />\n                    <Label htmlFor={`health-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n          </div>\n        );\n\n      case 3:\n        return (\n          <div className=\"space-y-6\">\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Rate yourself on these personality dimensions from 1 (strongly disagree) to 10 (strongly agree)\n            </p>\n            \n            {/* Debug helper - shows what's selected */}\n            {(!data.opennessScore || !data.conscientiousnessScore || !data.extraversionScore || !data.agreeablenessScore || !data.emotionalStabilityScore) && (\n              <div className=\"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md text-sm\">\n                <p className=\"font-medium mb-2\">Please rate all 5 personality traits to continue:</p>\n                <ul className=\"space-y-1 text-xs\">\n                  <li className={data.opennessScore ? \"text-green-500\" : \"text-yellow-500\"}>\n                    {data.opennessScore ? \"✓\" : \"○\"} Openness to Experience {data.opennessScore && `(${data.opennessScore})`}\n                  </li>\n                  <li className={data.conscientiousnessScore ? \"text-green-500\" : \"text-yellow-500\"}>\n                    {data.conscientiousnessScore ? \"✓\" : \"○\"} Conscientiousness {data.conscientiousnessScore && `(${data.conscientiousnessScore})`}\n                  </li>\n                  <li className={data.extraversionScore ? \"text-green-500\" : \"text-yellow-500\"}>\n                    {data.extraversionScore ? \"✓\" : \"○\"} Extraversion {data.extraversionScore && `(${data.extraversionScore})`}\n                  </li>\n                  <li className={data.agreeablenessScore ? \"text-green-500\" : \"text-yellow-500\"}>\n                    {data.agreeablenessScore ? \"✓\" : \"○\"} Agreeableness {data.agreeablenessScore && `(${data.agreeablenessScore})`}\n                  </li>\n                  <li className={data.emotionalStabilityScore ? \"text-green-500\" : \"text-yellow-500\"}>\n                    {data.emotionalStabilityScore ? \"✓\" : \"○\"} Emotional Stability {data.emotionalStabilityScore && `(${data.emotionalStabilityScore})`}\n                  </li>\n                </ul>\n              </div>\n            )}\n\n            <div className=\"space-y-3\">\n              <div>\n                <Label>Openness to Experience</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">I enjoy trying new things and exploring new ideas</p>\n              </div>\n              <RadioGroup value={data.opennessScore} onValueChange={(val) => updateData('opennessScore', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`open-${num}`} />\n                    <Label htmlFor={`open-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div>\n                <Label>Conscientiousness</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">I am organized, responsible, and detail-oriented</p>\n              </div>\n              <RadioGroup value={data.conscientiousnessScore} onValueChange={(val) => updateData('conscientiousnessScore', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`consc-${num}`} />\n                    <Label htmlFor={`consc-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div>\n                <Label>Extraversion</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">I am outgoing and energized by social interactions</p>\n              </div>\n              <RadioGroup value={data.extraversionScore} onValueChange={(val) => updateData('extraversionScore', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`extra-${num}`} />\n                    <Label htmlFor={`extra-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div>\n                <Label>Agreeableness</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">I am cooperative, compassionate, and value harmony</p>\n              </div>\n              <RadioGroup value={data.agreeablenessScore} onValueChange={(val) => updateData('agreeablenessScore', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`agree-${num}`} />\n                    <Label htmlFor={`agree-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div>\n                <Label>Emotional Stability</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">I handle stress well and remain emotionally balanced</p>\n              </div>\n              <RadioGroup value={data.emotionalStabilityScore} onValueChange={(val) => updateData('emotionalStabilityScore', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`emot-${num}`} />\n                    <Label htmlFor={`emot-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n          </div>\n        );\n\n      case 4:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"challenge\">What is your primary challenge or concern right now?</Label>\n              <RadioGroup value={data.primaryChallenge} onValueChange={(val) => updateData('primaryChallenge', val)}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"relationships\" id=\"chal-rel\" />\n                  <Label htmlFor=\"chal-rel\" className=\"font-normal cursor-pointer\">Relationship Issues</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"career\" id=\"chal-career\" />\n                  <Label htmlFor=\"chal-career\" className=\"font-normal cursor-pointer\">Career/Work Challenges</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"anxiety\" id=\"chal-anxiety\" />\n                  <Label htmlFor=\"chal-anxiety\" className=\"font-normal cursor-pointer\">Anxiety/Stress</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"selfesteem\" id=\"chal-esteem\" />\n                  <Label htmlFor=\"chal-esteem\" className=\"font-normal cursor-pointer\">Self-Esteem/Confidence</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"purpose\" id=\"chal-purpose\" />\n                  <Label htmlFor=\"chal-purpose\" className=\"font-normal cursor-pointer\">Finding Purpose/Direction</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"habits\" id=\"chal-habits\" />\n                  <Label htmlFor=\"chal-habits\" className=\"font-normal cursor-pointer\">Breaking Bad Habits</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"other\" id=\"chal-other\" />\n                  <Label htmlFor=\"chal-other\" className=\"font-normal cursor-pointer\">Other</Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"challenge-desc\">Tell us more about this challenge (optional but helpful)</Label>\n              <Textarea\n                id=\"challenge-desc\"\n                placeholder=\"Describe what you're going through and how it's affecting you... (you can skip this if you prefer)\"\n                className=\"min-h-[120px]\"\n                value={data.challengeDescription || ''}\n                onChange={(e) => updateData('challengeDescription', e.target.value)}\n                data-testid=\"textarea-challenge\"\n              />\n              <p className=\"text-xs text-muted-foreground\">You can leave this blank and still proceed to the next step</p>\n            </div>\n          </div>\n        );\n\n      case 5:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"goal\">What is your main goal with using Mirror?</Label>\n              <Textarea\n                id=\"goal\"\n                placeholder=\"e.g., Improve my relationships, build confidence, understand myself better...\"\n                className=\"min-h-[100px]\"\n                value={data.mainGoal || ''}\n                onChange={(e) => updateData('mainGoal', e.target.value)}\n                data-testid=\"textarea-goal\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label>How motivated are you to make changes? (1 = not motivated, 10 = extremely motivated)</Label>\n              <RadioGroup value={data.motivationLevel} onValueChange={(val) => updateData('motivationLevel', val)} className=\"flex flex-wrap gap-2\">\n                {[1,2,3,4,5,6,7,8,9,10].map(num => (\n                  <div key={num} className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value={String(num)} id={`motiv-${num}`} />\n                    <Label htmlFor={`motiv-${num}`} className=\"font-normal cursor-pointer\">{num}</Label>\n                  </div>\n                ))}\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-3\">\n              <Label htmlFor=\"support\">What kind of support or guidance are you looking for?</Label>\n              <Textarea\n                id=\"support\"\n                placeholder=\"e.g., Honest feedback, actionable advice, someone to listen...\"\n                className=\"min-h-[100px]\"\n                value={data.supportNeeded || ''}\n                onChange={(e) => updateData('supportNeeded', e.target.value)}\n                data-testid=\"textarea-support\"\n              />\n            </div>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const getStepTitle = () => {\n    switch (currentStep) {\n      case 1: return \"Basic Information\";\n      case 2: return \"Life Satisfaction\";\n      case 3: return \"Personality Self-Assessment\";\n      case 4: return \"Current Challenges\";\n      case 5: return \"Goals & Motivations\";\n      default: return \"\";\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <DashboardNav />\n      \n      <main className=\"max-w-3xl mx-auto px-4 sm:px-6 py-8\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <Brain className=\"h-8 w-8 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">Comprehensive Intake Assessment</h1>\n          </div>\n          <p className=\"text-muted-foreground\">\n            Help us understand you better to provide personalized insights and guidance\n          </p>\n        </div>\n\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium\">Step {currentStep} of {TOTAL_STEPS}</span>\n            <span className=\"text-sm text-muted-foreground\">{Math.round((currentStep / TOTAL_STEPS) * 100)}% Complete</span>\n          </div>\n          <Progress value={(currentStep / TOTAL_STEPS) * 100} className=\"h-2\" />\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>{getStepTitle()}</CardTitle>\n            <CardDescription>\n              {currentStep === 1 && \"Let's start with some basic information about you\"}\n              {currentStep === 2 && \"How satisfied are you with different areas of your life?\"}\n              {currentStep === 3 && \"Help us understand your personality traits\"}\n              {currentStep === 4 && \"What brings you here today?\"}\n              {currentStep === 5 && \"What are you hoping to achieve?\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {renderStep()}\n            \n            <div className=\"flex gap-3 mt-8\">\n              {currentStep > 1 && (\n                <Button\n                  variant=\"outline\"\n                  onClick={prevStep}\n                  data-testid=\"button-prev-step\"\n                >\n                  <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                  Back\n                </Button>\n              )}\n              \n              <Button\n                onClick={nextStep}\n                disabled={!canProceed() || saveAssessmentMutation.isPending}\n                className=\"ml-auto\"\n                data-testid=\"button-next-step\"\n              >\n                {currentStep === TOTAL_STEPS ? (\n                  saveAssessmentMutation.isPending ? (\n                    \"Saving...\"\n                  ) : (\n                    <>\n                      Complete Assessment\n                      <CheckCircle2 className=\"ml-2 h-4 w-4\" />\n                    </>\n                  )\n                ) : (\n                  <>\n                    Next\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":25958,"size_tokens":null},"client/src/pages/Mood.tsx":{"content":"import { DashboardNav } from \"@/components/DashboardNav\";\nimport { MoodInterface } from \"@/components/MoodInterface\";\n\nexport default function Mood() {\n  return (\n    <div className=\"min-h-screen\">\n      <DashboardNav />\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-8\">\n        <div className=\"mb-4 sm:mb-8\">\n          <h1 className=\"text-2xl sm:text-3xl font-semibold mb-1 sm:mb-2\">Mood Tracker</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            Track your moods and emotions to understand patterns over time\n          </p>\n        </div>\n        <MoodInterface />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":653,"size_tokens":null},"client/src/components/MoodInterface.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Smile, Meh, Frown, Plus, Trash2 } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { MoodEntry, InsertMoodEntry } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\n\nconst COMMON_MOODS = [\n  { label: \"Happy\", emoji: \"😊\", color: \"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\" },\n  { label: \"Sad\", emoji: \"😢\", color: \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\" },\n  { label: \"Anxious\", emoji: \"😰\", color: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300\" },\n  { label: \"Angry\", emoji: \"😠\", color: \"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300\" },\n  { label: \"Calm\", emoji: \"😌\", color: \"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\" },\n  { label: \"Excited\", emoji: \"🤩\", color: \"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300\" },\n  { label: \"Tired\", emoji: \"😴\", color: \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\" },\n  { label: \"Stressed\", emoji: \"😫\", color: \"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300\" },\n];\n\nconst COMMON_ACTIVITIES = [\n  \"Work\", \"Exercise\", \"Social\", \"Family\", \"Hobbies\", \"Rest\", \"Study\", \"Errands\"\n];\n\nexport function MoodInterface() {\n  const [selectedMood, setSelectedMood] = useState(\"\");\n  const [intensity, setIntensity] = useState([50]);\n  const [activities, setActivities] = useState<string[]>([]);\n  const [note, setNote] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: moodEntries = [], isLoading } = useQuery<MoodEntry[]>({\n    queryKey: [\"/api/mood-entries\"],\n  });\n\n  const createMoodMutation = useMutation({\n    mutationFn: async (entry: InsertMoodEntry) => {\n      const res = await apiRequest(\"POST\", \"/api/mood-entries\", entry);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/mood-entries\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/personality-reflection\"] });\n      setSelectedMood(\"\");\n      setIntensity([50]);\n      setActivities([]);\n      setNote(\"\");\n      toast({\n        title: \"Mood Logged\",\n        description: \"Your mood has been tracked successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to log mood. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    if (!selectedMood) {\n      toast({\n        title: \"Select a Mood\",\n        description: \"Please select how you're feeling.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createMoodMutation.mutate({\n      mood: selectedMood,\n      intensity: intensity[0],\n      activities: activities.length > 0 ? activities : undefined,\n      note: note.trim() || undefined,\n    });\n  };\n\n  const toggleActivity = (activity: string) => {\n    setActivities(prev =>\n      prev.includes(activity)\n        ? prev.filter(a => a !== activity)\n        : [...prev, activity]\n    );\n  };\n\n  const getIntensityIcon = () => {\n    if (intensity[0] <= 33) return <Frown className=\"h-5 w-5 text-muted-foreground\" />;\n    if (intensity[0] <= 66) return <Meh className=\"h-5 w-5 text-muted-foreground\" />;\n    return <Smile className=\"h-5 w-5 text-muted-foreground\" />;\n  };\n\n  return (\n    <div className=\"grid gap-6 grid-cols-1 lg:grid-cols-2\">\n      {/* Log New Mood Card */}\n      <Card data-testid=\"card-log-mood\">\n        <CardHeader>\n          <CardTitle>How are you feeling?</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Mood Selection */}\n          <div className=\"space-y-3\">\n            <Label>Select Your Mood</Label>\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n              {COMMON_MOODS.map(mood => (\n                <Button\n                  key={mood.label}\n                  variant={selectedMood === mood.label ? \"default\" : \"outline\"}\n                  className=\"h-auto flex-col gap-2 py-3\"\n                  onClick={() => setSelectedMood(mood.label)}\n                  data-testid={`button-mood-${mood.label.toLowerCase()}`}\n                >\n                  <span className=\"text-2xl\">{mood.emoji}</span>\n                  <span className=\"text-xs\">{mood.label}</span>\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {/* Intensity Slider */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <Label>Intensity</Label>\n              <div className=\"flex items-center gap-2\">\n                {getIntensityIcon()}\n                <span className=\"text-sm font-medium\">{intensity[0]}%</span>\n              </div>\n            </div>\n            <Slider\n              value={intensity}\n              onValueChange={setIntensity}\n              min={0}\n              max={100}\n              step={5}\n              data-testid=\"slider-intensity\"\n            />\n          </div>\n\n          {/* Activities */}\n          <div className=\"space-y-3\">\n            <Label>What are you doing? (optional)</Label>\n            <div className=\"flex flex-wrap gap-2\">\n              {COMMON_ACTIVITIES.map(activity => (\n                <Badge\n                  key={activity}\n                  variant={activities.includes(activity) ? \"default\" : \"outline\"}\n                  className=\"cursor-pointer hover-elevate active-elevate-2\"\n                  onClick={() => toggleActivity(activity)}\n                  data-testid={`badge-activity-${activity.toLowerCase()}`}\n                >\n                  {activity}\n                </Badge>\n              ))}\n            </div>\n          </div>\n\n          {/* Note */}\n          <div className=\"space-y-3\">\n            <Label htmlFor=\"note\">Add a Note (optional)</Label>\n            <Textarea\n              id=\"note\"\n              placeholder=\"What's on your mind?\"\n              value={note}\n              onChange={(e) => setNote(e.target.value)}\n              className=\"min-h-[100px] resize-none\"\n              data-testid=\"textarea-mood-note\"\n            />\n          </div>\n\n          {/* Submit Button */}\n          <Button\n            onClick={handleSave}\n            className=\"w-full gap-2\"\n            disabled={createMoodMutation.isPending}\n            data-testid=\"button-save-mood\"\n          >\n            <Plus className=\"h-4 w-4\" />\n            {createMoodMutation.isPending ? \"Logging...\" : \"Log Mood\"}\n          </Button>\n        </CardContent>\n      </Card>\n\n      {/* Mood History Card */}\n      <Card data-testid=\"card-mood-history\">\n        <CardHeader>\n          <CardTitle>Recent Moods</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n              Loading moods...\n            </div>\n          ) : moodEntries.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-8 text-center text-muted-foreground\">\n              <Meh className=\"h-12 w-12 mb-3 opacity-50\" />\n              <p className=\"text-sm\">No mood entries yet</p>\n              <p className=\"text-xs mt-1\">Start tracking your moods to see patterns</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3 max-h-[600px] overflow-y-auto\">\n              {moodEntries.map(entry => {\n                const moodData = COMMON_MOODS.find(m => m.label === entry.mood);\n                return (\n                  <div\n                    key={entry.id}\n                    className=\"p-4 border rounded-lg space-y-2 hover-elevate\"\n                    data-testid={`mood-entry-${entry.id}`}\n                  >\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-2xl\">{moodData?.emoji || \"😐\"}</span>\n                        <div>\n                          <p className=\"font-medium\">{entry.mood}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {format(new Date(entry.createdAt), \"MMM d, yyyy 'at' h:mm a\")}\n                          </p>\n                        </div>\n                      </div>\n                      <Badge variant=\"outline\" data-testid={`badge-intensity-${entry.id}`}>\n                        {entry.intensity}%\n                      </Badge>\n                    </div>\n\n                    {entry.activities && entry.activities.length > 0 && (\n                      <div className=\"flex flex-wrap gap-1\">\n                        {entry.activities.map((activity, idx) => (\n                          <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                            {activity}\n                          </Badge>\n                        ))}\n                      </div>\n                    )}\n\n                    {entry.note && (\n                      <p className=\"text-sm text-muted-foreground pt-2 border-t\">\n                        {entry.note}\n                      </p>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9860,"size_tokens":null}},"version":2}